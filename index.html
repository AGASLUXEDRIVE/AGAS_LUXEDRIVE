<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGAS LUXE DRIVE | Premium Luxury Automotive Marketplace</title>
    <!-- Updated Favicon with ALD Logo -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231a365d'/><text x='50' y='65' font-family='Arial, sans-serif' font-size='48' font-weight='bold' fill='white' text-anchor='middle'>ALD</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- PDF and Excel Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        /* ===== GLOBAL STYLES ===== */
        :root {
            --primary: #1a365d;
            --primary-dark: #0f2544;
            --primary-light: #2d4a7c;
            --secondary: #c53030;
            --secondary-dark: #9c2525;
            --accent: #d69e2e;
            --accent-dark: #b5831f;
            --light: #f8fafc;
            --dark: #1e293b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --gray: #94a3b8;
            --gray-light: #e2e8f0;
            --white: #ffffff;
            --footer-bg: var(--dark);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 8px;
            --transition: all 0.3s ease;
        }

        /* Dark Mode Variables - IMPROVED FOR BETTER READABILITY */
        .dark-mode {
            --primary: #3b82f6;
            --primary-dark: #1e40af;
            --primary-light: #60a5fa;
            --secondary: #ef4444;
            --secondary-dark: #dc2626;
            --accent: #f59e0b;
            --accent-dark: #d97706;
            --light: #1e293b;
            --dark: #f8fafc;
            --gray: #94a3b8;
            --gray-light: #334155;
            --white: #0f172a;
            --footer-bg: var(--light);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        section {
            padding: 80px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-title h2 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--dark);
            text-shadow: 0 1px 0 rgba(0,0,0,0.18), 0 8px 24px rgba(0,0,0,0.25);
        }

        .section-title p {
            font-size: 1.1rem;
            color: var(--secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .btn {
            display: inline-block;
            padding: 12px 28px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }

        .btn-accent {
            background-color: var(--accent);
        }

        .btn-accent:hover {
            background-color: var(--accent-dark);
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #0da271;
        }

        /* ===== HEADER & NAVIGATION ===== */
        header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo-main {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .logo-agas {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary);
            line-height: 1;
            letter-spacing: -1px;
        }

        .logo-luxe-drive {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
            letter-spacing: 3px;
            margin-top: -2px;
        }

        .logo-tagline {
            font-size: 0.7rem;
            color: var(--gray);
            font-style: italic;
            margin-top: 2px;
            letter-spacing: 1px;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark);
        }

        /* ===== DARK MODE TOGGLE ===== */
        .dark-mode-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--dark);
            transition: var(--transition);
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-mode-toggle:hover {
            background-color: var(--gray-light);
        }

        /* ===== NOTIFICATION BELL ===== */
        .notification-bell {
            position: relative;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--dark);
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .notification-bell:hover {
            background-color: var(--gray-light);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ===== NOTIFICATION CENTER ===== */
        .notification-center {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--gray-light);
        }

        .notification-center.active {
            display: flex;
        }

        .notification-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h3 {
            margin: 0;
            color: var(--dark);
        }

        .notification-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .notification-item {
            padding: 12px 20px;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background-color: var(--gray-light);
        }

        .notification-item.unread {
            background-color: rgba(59, 130, 246, 0.1);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .notification-message {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .notification-footer {
            padding: 10px 20px;
            border-top: 1px solid var(--gray-light);
            text-align: center;
        }

        /* ===== AI CHAT CONCIERGE ===== */
        .ai-chat-concierge {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .ai-chat-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .ai-chat-toggle:hover {
            transform: scale(1.1);
            background-color: var(--primary-dark);
        }

        .ai-chat-container {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 400px;
            height: 500px;
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--gray-light);
        }

        .ai-chat-container.active {
            display: flex;
        }

        .ai-chat-header {
            padding: 15px 20px;
            background-color: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .ai-chat-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .ai-message.bot {
            align-self: flex-start;
            background-color: var(--gray-light);
            color: var(--dark);
            border-bottom-left-radius: 5px;
        }

        .ai-message.user {
            align-self: flex-end;
            background-color: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .ai-chat-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .ai-chat-option {
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid var(--primary);
            border-radius: 15px;
            padding: 5px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .ai-chat-option:hover {
            background-color: var(--primary);
            color: white;
        }

        .ai-chat-input {
            padding: 15px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            gap: 10px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--gray-light);
            border-radius: 20px;
            outline: none;
            background-color: var(--white);
            color: var(--dark);
        }

        .ai-chat-input button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .ai-chat-input button:hover {
            background-color: var(--primary-dark);
        }

        /* ===== HERO SECTION ===== */
        .hero {
            background: linear-gradient(rgba(30, 41, 59, 0.85), rgba(30, 41, 59, 0.9)), url('https://images.unsplash.com/photo-1535732820275-9ffd998cac22?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 150px 0;
            text-align: center;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
            opacity: 0.9;
        }

        /* ===== SECURITY FEATURES ===== */
        .security-features {
            background: var(--light);
            padding: 60px 0;
        }

        .security-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .security-card {
            background: var(--white);
            padding: 30px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--success);
            transition: var(--transition);
        }

        .security-card:hover {
            transform: translateY(-5px);
        }

        .security-icon {
            font-size: 2.5rem;
            color: var(--success);
            margin-bottom: 20px;
        }

        /* ===== COMPETITIVE ADVANTAGES ===== */
        .advantages {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 80px 0;
        }

        .advantage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .advantage-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: var(--radius);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .advantage-card:hover {
            transform: translateY(-10px);
        }

        .advantage-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--accent);
        }

        /* ===== PARTNERSHIP LOGOS ===== */
        .partnerships {
            background-color: var(--white);
            padding: 60px 0;
        }

        .partner-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 40px;
            margin-top: 40px;
        }

        .partner-logo {
            height: 60px;
            filter: grayscale(100%);
            opacity: 0.7;
            transition: var(--transition);
        }

        .partner-logo:hover {
            filter: grayscale(0%);
            opacity: 1;
        }

        /* ===== BRANDS SHOWCASE ===== */
        .brands-showcase {
            background: var(--light);
            padding: 60px 0;
        }

        .brands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .brand-card {
            background: var(--white);
            padding: 30px 20px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .brand-card:hover {
            transform: translateY(-5px);
        }

        .brand-logo {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* ===== CURRENCY TOGGLE ===== */
        .currency-toggle {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .currency-btn {
            padding: 8px 20px;
            background: var(--gray-light);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .currency-btn:first-child {
            border-radius: var(--radius) 0 0 var(--radius);
        }

        .currency-btn:last-child {
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        .currency-btn.active {
            background: var(--primary);
            color: white;
        }

        /* ===== FILTER BAR ===== */
        .filter-bar {
            background-color: var(--white);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }

        .filter-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 1rem;
            background-color: var(--white);
            color: var(--dark);
        }

        /* ===== CAR LISTINGS ===== */
        .car-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }

        .car-card {
            background-color: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        .car-card:hover {
            transform: translateY(-5px);
        }

        .car-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--success);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .car-image {
            height: 200px;
            width: 100%;
            object-fit: cover;
        }

        .car-details {
            padding: 20px;
        }

        .car-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .car-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .car-specs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .verified-badge {
            display: inline-flex;
            align-items: center;
            background-color: var(--success);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .verified-badge i {
            margin-right: 5px;
        }

        .pending-badge {
            display: inline-flex;
            align-items: center;
            background-color: var(--accent);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* ===== RENTAL SECTION ===== */
        .rental-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .rental-card {
            background-color: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        .rental-card:hover {
            transform: translateY(-5px);
        }

        .rental-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .rental-image {
            height: 200px;
            width: 100%;
            object-fit: cover;
        }

        .rental-details {
            padding: 20px;
        }

        .rental-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .price-unit {
            font-size: 1rem;
            color: var(--gray);
        }

        /* ===== HOW IT WORKS ===== */
        .steps {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 30px;
        }

        .step {
            flex: 1;
            min-width: 250px;
            text-align: center;
            padding: 30px 20px;
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .step:hover {
            transform: translateY(-10px);
        }

        .step-icon {
            width: 80px;
            height: 80px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
        }

        /* ===== TESTIMONIALS ===== */
        .testimonials {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }

        .testimonial {
            flex: 1;
            min-width: 300px;
            background-color: var(--light);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .testimonial-text {
            font-style: italic;
            margin-bottom: 20px;
        }

        .testimonial-author {
            display: flex;
            align-items: center;
        }

        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        /* ===== TRUST SECTION ===== */
        .trust-section {
            background-color: var(--light);
            padding: 60px 0;
        }

        .trust-badges {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .trust-badge {
            text-align: center;
            padding: 20px;
        }

        .trust-badge i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* ===== FOOTER ===== */
        footer {
            background-color: var(--footer-bg);
            color: var(--white);
            padding: 60px 0 30px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background-color: var(--primary);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
        }

        .footer-links a:hover {
            color: var(--white);
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: var(--white);
            text-decoration: none;
            transition: var(--transition);
        }

        .social-links a:hover {
            background-color: var(--primary);
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray);
            font-size: 0.9rem;
        }

        .footer-logo {
            margin-bottom: 20px;
        }

        .footer-logo .logo-agas {
            font-size: 1.8rem;
            color: var(--white);
        }

        .footer-logo .logo-luxe-drive {
            font-size: 0.9rem;
            color: var(--gray-light);
        }

        .footer-logo .logo-tagline {
            font-size: 0.6rem;
            color: var(--gray);
        }

        /* ===== MODAL STYLES ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--white);
            padding: 30px;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* ===== DASHBOARD STYLES ===== */
        .dashboard {
            display: none;
            padding: 40px 0;
        }

        .dashboard-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--gray-light);
            flex-wrap: wrap;
        }

        .dashboard-tab {
            padding: 15px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            border-bottom: 3px solid transparent;
        }

        .dashboard-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .dashboard-content {
            background-color: var(--white);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== ADMIN PANEL ===== */
        .admin-panel {
            display: none;
            padding: 40px 0;
        }

        .pending-listings {
            margin-top: 30px;
        }

        .listing-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: var(--light);
            border-radius: var(--radius);
            margin-bottom: 15px;
        }

        .listing-info h4 {
            margin-bottom: 5px;
        }

        .listing-actions {
            display: flex;
            gap: 10px;
        }

        /* ===== SESSION TIMER ===== */
.session-timer {
    position: fixed;
    top: 16px;
    right: 16px;
    background: linear-gradient(135deg, #FFD54F, #FFC107);
    color: #1b1b1b;
    padding: 10px 16px;
    border-radius: 24px;
    font-size: 0.9rem;
    font-weight: 700;
    letter-spacing: 0.3px;
    display: none;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 193, 7, 0.6);
}

        /* ===== 2FA MODAL ===== */
        .twofa-modal {
            display: none;
        }

        .twofa-code {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .twofa-digit {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
        }

        /* ===== PROFILE SELECTION ===== */
        .profile-selection {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .profile-card {
            background: var(--white);
            padding: 30px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            width: 250px;
        }

        .profile-card:hover {
            transform: translateY(-5px);
        }

        .profile-card.selected {
            border: 3px solid var(--primary);
        }

        .profile-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        /* ===== ENHANCED DASHBOARDS ===== */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(245,245,245,0.9));
            padding: 22px;
            border-radius: 18px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.06);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .admin-office {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(245,245,245,0.95));
            padding: 34px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 12px 36px rgba(0,0,0,0.12);
            border: 1px solid rgba(0,0,0,0.06);
        }

        .admin-toolbar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        #admin-section .container { position: relative; }
        .admin-sidebar {
            position: sticky;
            top: 120px;
            width: 240px;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(245,245,245,0.95));
            border: 1px solid rgba(0,0,0,0.06);
            border-radius: 20px;
            box-shadow: 0 12px 36px rgba(0,0,0,0.12);
            padding: 16px;
            display: none;
        }
        .admin-sidebar .dashboard-tab { display: block; width: 100%; text-align: left; padding: 12px 16px; }
        #admin-section .dashboard-content { margin-left: 0; }
        @media (min-width: 992px) {
            .admin-sidebar { display: block; }
            #admin-section .dashboard-tabs { display: none; }
            #admin-section .dashboard-content { margin-left: 260px; }
        }

        .kyc-documents {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .kyc-doc {
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 10px;
            text-align: center;
        }

        .kyc-doc img {
            max-width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: var(--radius);
        }

        /* ===== TERMS CHECKBOX ===== */
        .terms-agreement {
            margin: 20px 0;
            padding: 15px;
            background: var(--light);
            border-radius: var(--radius);
        }

        .terms-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .terms-checkbox input {
            margin-top: 3px;
        }

        /* ===== RENTAL STATUS ===== */
        .rental-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: var(--warning);
            color: white;
        }

        .status-approved {
            background: var(--success);
            color: white;
        }

        .status-rejected {
            background: var(--danger);
            color: white;
        }

        /* ===== NOTIFICATION STYLES ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--radius);
            color: white;
            z-index: 3000;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
            transform: translateX(150%);
            transition: var(--transition);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: var(--danger);
        }

        .notification.warning {
            background-color: var(--warning);
        }

        .notification.info {
            background-color: var(--primary);
        }

        /* ===== LOADING INDICATOR ===== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* X (Twitter) Logo */
        .fa-x-twitter {
            font-family: "Font Awesome 6 Brands";
            font-weight: 400;
        }

        .fa-x-twitter:before {
            content: "\e61b";
        }

        /* Car Detail Modal Styles */
        .car-detail-modal .modal-content {
            max-width: 800px;
        }

        .car-detail-images {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .car-detail-main-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: var(--radius);
        }

        .car-detail-thumbnails {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .car-detail-thumbnail {
            width: 100%;
            height: 95px;
            object-fit: cover;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .car-detail-thumbnail:hover {
            opacity: 0.8;
        }

        .car-detail-specs {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .car-detail-spec {
            background: var(--light);
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
        }

        .car-detail-spec-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .car-detail-spec-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
        }

        /* ===== USER BADGE SYSTEM ===== */
        .user-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-new {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .badge-bronze {
            background-color: #cd7f32;
            color: white;
        }

        .badge-silver {
            background-color: #c0c0c0;
            color: var(--dark);
        }

        .badge-gold {
            background-color: #ffd700;
            color: var(--dark);
        }

        .badge-platinum {
            background-color: #e5e4e2;
            color: var(--dark);
        }

        .badge-verified-buyer {
            background-color: var(--success);
            color: white;
        }

        .badge-verified-seller {
            background-color: var(--primary);
            color: white;
        }

        .badge-corporate {
            background-color: var(--accent);
            color: white;
        }

        /* ===== RATING SYSTEM ===== */
        .rating-stars {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .star {
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        .star.filled {
            color: var(--warning);
        }

        .two-way-rating {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .rating-card {
            background: var(--light);
            padding: 15px;
            border-radius: var(--radius);
        }

        .rating-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .rating-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rating-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .rating-content {
            font-style: italic;
        }

        /* ===== ID VERIFICATION ===== */
        .id-verification {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }

        .country-select {
            flex: 0 0 120px;
        }

        .id-input {
            flex: 1;
        }

        /* ===== DASHBOARD NAVIGATION ===== */
        .dashboard-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .dashboard-nav h2 {
            color: var(--primary);
            margin: 0;
        }

        .dashboard-nav-actions {
            display: flex;
            gap: 10px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb .separator {
            color: var(--gray);
        }

        /* ===== INNOVATIVE FEATURES ===== */
        
        /* Recommendation Engine */
        .recommendations-section {
            background: var(--light);
            padding: 60px 0;
        }
        
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .recommendation-card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }
        
        .recommendation-card:hover {
            transform: translateY(-5px);
        }
        
        .recommendation-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--accent);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .recommendation-match {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--success);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Advanced Filtering */
        .advanced-filters {
            background: var(--white);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 40px;
            display: none;
        }
        
        .advanced-filters.active {
            display: block;
        }
        
        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            cursor: pointer;
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Social Proof Elements */
        .social-proof {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }
        
        .social-proof-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        /* Quick View Modal */
        .quick-view-modal .modal-content {
            max-width: 900px;
        }
        
        .quick-view-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        /* Progress Indicators */
        .progress-bar {
            height: 6px;
            background: var(--gray-light);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }
        
        /* Enhanced Search */
        .search-container {
            position: relative;
            margin-bottom: 30px;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 1rem;
            background: var(--white);
            color: var(--dark);
            padding-left: 50px;
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 992px) {
            .hero h1 {
                font-size: 2.8rem;
            }
            
            .steps {
                flex-direction: column;
            }
            
            .car-detail-images {
                grid-template-columns: 1fr;
            }
            
            .car-detail-thumbnails {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .quick-view-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-wrap: wrap;
            }
            
            .nav-links {
                display: none;
                width: 100%;
                flex-direction: column;
                margin-top: 20px;
                transition: var(--transition);
            }
            
            .nav-links.active {
                display: flex;
                animation: slideDown 0.3s ease;
            }
            
            @keyframes slideDown {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .nav-links li {
                margin: 10px 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .auth-buttons {
                display: none;
            }

            .user-menu {
                display: none;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .section-title h2 {
                font-size: 2rem;
            }

            .logo-agas {
                font-size: 1.8rem;
            }

            .logo-luxe-drive {
                font-size: 0.9rem;
            }

            .profile-selection {
                flex-direction: column;
                align-items: center;
            }

            .id-verification {
                flex-direction: column;
            }

            .country-select {
                flex: 1;
            }

            .dashboard-nav {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .dashboard-nav-actions {
                width: 100%;
                justify-content: space-between;
            }

            .ai-chat-container {
                width: 300px;
                height: 400px;
            }

            .notification-center {
                width: 300px;
            }
        }

        @media (max-width: 576px) {
            .hero {
                padding: 100px 0;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .section-title h2 {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .logo-agas {
                font-size: 1.5rem;
            }

            .logo-luxe-drive {
                font-size: 0.8rem;
                letter-spacing: 2px;
            }

            .logo-tagline {
                font-size: 0.6rem;
            }

            .listing-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .listing-actions {
                margin-top: 15px;
                width: 100%;
                justify-content: space-between;
            }
            
            .car-detail-thumbnails {
                grid-template-columns: repeat(2, 1fr);
            }

            .ai-chat-container {
                width: 280px;
                right: -20px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- SEO meta & structured data -->
<meta name="description" content="AGAS LUXE DRIVE  East Africa's premium luxury automotive marketplace. Buy, sell, and rent verified luxury vehicles.">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"AutoDealer","name":"AGAS LUXE DRIVE","url":"/","description":"Premium luxury vehicle marketplace in East Africa."}
</script>

</head>
<body>
    <!-- Session Timer -->
    <div class="session-timer" id="session-timer">
        Session: <span id="session-time">15:00</span>
    </div>

    <!-- Notification System -->
    <div id="notification-container"></div>

    <!-- Header & Navigation -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo" onclick="showSection('home')">
                    <div class="logo-main">
                        <div class="logo-agas">AGAS</div>
                        <div class="logo-luxe-drive">LUXE DRIVE</div>
                        <div class="logo-tagline">Drive luxury. live AGAS.</div>
                    </div>
                </a>
                
                <ul class="nav-links">
                    <li><a onclick="showSection('home')">Home</a></li>
                    <li><a onclick="showSection('listings')">Buy Cars</a></li>
                    <li><a onclick="showSection('rentals')">Rent Cars</a></li>
                    <li><a onclick="showBrandGallery()">Brands</a></li>
                    <li><a onclick="showSection('about')">About</a></li>
                    <li><a onclick="showSection('contact')">Contact</a></li>
                </ul>
                
                <div class="auth-buttons" id="auth-buttons">
                    <!-- Dark Mode Toggle -->
                    <button class="dark-mode-toggle" id="dark-mode-toggle" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <!-- Notification Bell -->
                    <button class="notification-bell" id="notification-bell" title="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-count">3</span>
                    </button>
                    
                    <a class="btn btn-outline" onclick="showProfileSelection()">Sign Up</a>
                    <a class="btn" onclick="showLoginModal()">Login</a>
                </div>

                <div class="user-menu" id="user-menu" style="display: none;">
                    <!-- Dark Mode Toggle -->
                    <button class="dark-mode-toggle" id="dark-mode-toggle-user" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <!-- Notification Bell -->
                    <button class="notification-bell" id="notification-bell-user" title="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-count-user">3</span>
                    </button>
                    
                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <div>
                            <span id="user-name">User</span>
                            <div id="user-badges"></div>
                        </div>
                    </div>
                    <!-- Added Admin Dashboard button -->
                    <a class="btn btn-outline" id="admin-dashboard-btn" style="display: none;" onclick="showAdminPanel()">Admin Dashboard</a>
                    <a class="btn btn-outline" onclick="logout()">Logout</a>
                </div>
                
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- Notification Center -->
    <div class="notification-center" id="notification-center">
        <div class="notification-header">
            <h3>Notifications</h3>
            <button class="btn btn-outline" onclick="markAllNotificationsAsRead()">Mark All Read</button>
        </div>
        <div class="notification-list" id="notification-list">
            <!-- Notifications will be dynamically loaded here -->
        </div>
        <div class="notification-footer">
            <a href="#" onclick="viewAllNotifications()">View All Notifications</a>
        </div>
    </div>

    <!-- AI Chat Concierge -->
    <div class="ai-chat-concierge">
        <button class="ai-chat-toggle" id="ai-chat-toggle">
            <i class="fas fa-robot"></i>
        </button>
        <div class="ai-chat-container" id="ai-chat-container">
            <div class="ai-chat-header">
                <h3>AGAS AI Concierge</h3>
                <button class="ai-chat-close" id="ai-chat-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="ai-chat-messages" id="ai-chat-messages">
                <div class="ai-message bot">
                    Hello! I'm your AGAS AI Concierge. How can I assist you with luxury car purchases, rentals, or sales today?
                </div>
            </div>
            <div class="ai-chat-input">
                <input type="text" id="ai-chat-input" placeholder="Type your message...">
                <button id="ai-chat-send">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Sections -->
    <main>
        <!-- Home Section -->
        <section id="home-section">
            <!-- Hero Section -->
            <section class="hero">
                <div class="container">
                    <h1>East Africa's Premier Luxury Automotive Platform</h1>
                    <p>Verified sellers, premium rentals, enterprise security, and complete buyer protection. Your luxury automotive journey starts here.</p>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                        <a class="btn btn-accent" onclick="showSection('listings')">Buy Luxury Cars</a>
                        <a class="btn btn-outline" style="background: rgba(255,255,255,0.2); color: white; border-color: white;" onclick="showSection('rentals')">Rent Premium Cars</a>
                        <a class="btn" style="background: var(--success);" onclick="showProfileSelection()">Sell Your Car</a>
                    </div>
                </div>
            </section>

            <!-- Security Features Section -->
            <section class="security-features">
                <div class="container">
                    <div class="section-title">
                        <h2>Enterprise-Grade Security</h2>
                        <p>Your safety and privacy are our top priority with military-grade protection</p>
                    </div>
                    
                    <div class="security-grid">
                        <div class="security-card">
                            <div class="security-icon">
                                <i class="fas fa-fingerprint"></i>
                            </div>
                            <h3>Two-Factor Authentication</h3>
                            <p>Secure your account with 2FA via email and mobile verification</p>
                        </div>
                        
                        <div class="security-card">
                            <div class="security-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>End-to-End Encryption</h3>
                            <p>All data encrypted with AES-256 military-grade encryption</p>
                        </div>
                        
                        <div class="security-card">
                            <div class="security-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h3>Auto Session Timeout</h3>
                            <p>Automatic logout after 15 minutes of inactivity for security</p>
                        </div>
                        
                        <div class="security-card">
                            <div class="security-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <h3>Secure Email Verification</h3>
                            <p>Password reset and verification exclusively through verified email</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Competitive Advantages Section -->
            <section class="advantages">
                <div class="container">
                    <div class="section-title">
                        <h2 style="color: white;">Why AGAS LUXE DRIVE Dominates The Market</h2>
                        <p style="color: rgba(255,255,255,0.8);">We offer what others don't - complete enterprise solutions for luxury automotive transactions</p>
                    </div>
                    
                    <div class="advantage-grid">
                        <div class="advantage-card">
                            <div class="advantage-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>Advanced Protection</h3>
                            <p>Modern multi-layer protection with 2FA, encryption, and secure session handling</p>
                        </div>
                        
                        <div class="advantage-card">
                            <div class="advantage-icon">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <h3>Dual Currency System</h3>
                            <p>Transact in KES or USD with live exchange rates and zero hidden fees</p>
                        </div>
                        
                        <div class="advantage-card">
                            <div class="advantage-icon">
                                <i class="fas fa-car-side"></i>
                            </div>
                            <h3>Complete Automotive Ecosystem</h3>
                            <p>Buy, sell, rent luxury vehicles - all in one secure platform</p>
                        </div>
                        
                        <div class="advantage-card">
                            <div class="advantage-icon">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <h3>Legal & NTSA Integration</h3>
                            <p>We handle all transfer paperwork and legal documentation seamlessly</p>
                        </div>
                        
                        <div class="advantage-card">
                            <div class="advantage-icon">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <h3>Complete Vehicle Analytics</h3>
                            <p>Detailed history reports, market pricing, and investment analysis</p>
                        </div>
                        
                        <div class="advantage-card">
                            <div class="advantage-icon">
                                <i class="fas fa-headset"></i>
                            </div>
                            <h3>VIP Concierge Service</h3>
                            <p>Dedicated account managers for high-value transactions and clients</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Partnership Logos -->
            <section class="partnerships">
                <div class="container">
                    <div class="section-title">
                        <h2>Our Trusted Enterprise Partners</h2>
                        <p>Working with East Africa's most reputable automotive and regulatory organizations</p>
                    </div>
                    
                    <div class="partner-logos">
                        <img src="https://images.seeklogo.com/logo-png/35/1/national-transport-and-safety-authority-ntsa-logo-png_seeklogo-358947.png" alt="NTSA" class="partner-logo" style="height: 50px;">
                        <img src="https://images.seeklogo.com/logo-png/18/1/the-aa-logo-png_seeklogo-188271.png" alt="AA Kenya" class="partner-logo" style="height: 50px;">
                        <img src="https://images.seeklogo.com/logo-png/45/1/kra-logo-png_seeklogo-456419.png" alt="KRA" class="partner-logo" style="height: 50px;">
                        <img src="https://images.seeklogo.com/logo-png/36/1/hertz-logo-png_seeklogo-367396.png" alt="Hertz" class="partner-logo" style="height: 40px;">
                        <img src="https://images.seeklogo.com/logo-png/9/1/mercedes-benz-logo-png_seeklogo-91084.png" alt="Mercedes-Benz" class="partner-logo" style="height: 40px;">
                        <img src="https://images.seeklogo.com/logo-png/17/1/bmw-logo-png_seeklogo-170616.png" alt="BMW" class="partner-logo" style="height: 40px;">
                    </div>
                </div>
            </section>

            <!-- Brands Showcase -->
            <section class="brands-showcase" id="brands-section">
                <div class="container">
                    <div class="section-title">
                        <h2>Premium Automotive Brands</h2>
                        <p>Explore luxury vehicles from the world's most prestigious manufacturers</p>
                    </div>
                    
                    <div class="brands-grid">
                        <div class="brand-card" onclick="filterByBrand('mercedes')">
                            <div class="brand-logo">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Mercedes-Benz</h3>
                            <p>Luxury Sedans, SUVs, AMG Performance</p>
                        </div>
                        
                        <div class="brand-card" onclick="filterByBrand('bmw')">
                            <div class="brand-logo">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>BMW</h3>
                            <p>Executive Series, M Performance, X Series</p>
                        </div>
                        
                        <div class="brand-card" onclick="filterByBrand('toyota')">
                            <div class="brand-logo">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Toyota</h3>
                            <p>Land Cruiser, Prado, Lexus Luxury Division</p>
                        </div>
                        
                        <div class="brand-card" onclick="filterByBrand('volkswagen')">
                            <div class="brand-logo">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Volkswagen</h3>
                            <p>Touareg, Arteon, Premium Models</p>
                        </div>
                        
                        <div class="brand-card" onclick="filterByBrand('volvo')">
                            <div class="brand-logo">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Volvo</h3>
                            <p>XC Series, Luxury Safety, Scandinavian Design</p>
                        </div>
                        
                        <div class="brand-card" onclick="filterByBrand('nissan')">
                            <div class="brand-logo">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Nissan</h3>
                            <p>Patrol, Infiniti Luxury, Premium SUVs</p>
                        </div>
                        
                        <div class="brand-card" onclick="filterByBrand('range rover')">
                            <div class="brand-logo">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Range Rover</h3>
                            <p>Luxury SUVs, Vogue, Sport, Velar</p>
                        </div>
                        
                        <div class="brand-card" onclick="filterByBrand('porsche')">
                            <div class="brand-logo">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Porsche</h3>
                            <p>911, Cayenne, Panamera, Performance</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Featured Listings Section -->
            <section style="background-color: var(--light);" id="featured-vehicles">
                <div class="container">
                    <div class="section-title">
                        <h2>Featured Luxury Vehicles</h2>
                        <p>Hand-picked verified luxury vehicles from trusted sellers across East Africa</p>
                    </div>
                    
                    <!-- Enhanced Search -->
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="search-input" placeholder="Search for luxury cars by make, model, or features...">
                    </div>
                    
                    <!-- Advanced Filter Toggle -->
                    <div class="filter-toggle" onclick="toggleAdvancedFilters()">
                        <i class="fas fa-sliders-h"></i>
                        <span>Advanced Filters</span>
                        <i class="fas fa-chevron-down" id="filter-arrow"></i>
                    </div>
                    
                    <!-- Advanced Filters -->
                    <div class="advanced-filters" id="advanced-filters">
                        <div class="filter-bar">
                            <form class="filter-form" id="filter-form">
                                <div class="form-group">
                                    <label for="make">Brand</label>
                                    <select id="make" class="form-control">
                                        <option value="">All Brands</option>
                                        <option value="mercedes">Mercedes-Benz</option>
                                        <option value="bmw">BMW</option>
                                        <option value="toyota">Toyota/Lexus</option>
                                        <option value="range rover">Range Rover</option>
                                        <option value="volkswagen">Volkswagen</option>
                                        <option value="volvo">Volvo</option>
                                        <option value="nissan">Nissan/Infiniti</option>
                                        <option value="porsche">Porsche</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="model">Model</label>
                                    <input type="text" id="model" class="form-control" placeholder="Any Model">
                                </div>
                                
                                <div class="form-group">
                                    <label for="year">Year</label>
                                    <select id="year" class="form-control">
                                        <option value="">Any Year</option>
                                        <option value="2023">2023</option>
                                        <option value="2022">2022</option>
                                        <option value="2021">2021</option>
                                        <option value="2020">2020</option>
                                        <option value="2019">2019</option>
                                        <option value="2018">2018</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="price">Max Price</label>
                                    <select id="price" class="form-control">
                                        <option value="">Any Price</option>
                                        <option value="5000000">5M KES</option>
                                        <option value="10000000">10M KES</option>
                                        <option value="15000000">15M KES</option>
                                        <option value="20000000">20M KES</option>
                                        <option value="30000000">30M+ KES</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button type="submit" class="btn">Search Vehicles</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Currency Toggle -->
                    <div class="currency-toggle">
                        <button class="currency-btn active" onclick="setCurrency('kes')">KES</button>
                        <button class="currency-btn" onclick="setCurrency('usd')">USD</button>
                    </div>
                    
                    <!-- Car Listings Grid -->
                    <div class="car-grid" id="car-listings">
                        <!-- Car listings will be dynamically loaded here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <a class="btn" onclick="showSection('listings')">View All 247 Listings</a>
                    </div>
                </div>
            </section>

            <!-- AI-Powered Recommendations Section -->
            <section class="recommendations-section">
                <div class="container">
                    <div class="section-title">
                        <h2>Recommended For You</h2>
                        <p>AI-powered suggestions based on your preferences and browsing history</p>
                    </div>
                    
                    <div class="recommendation-grid" id="recommendation-grid">
                        <!-- AI recommendations will be dynamically loaded here -->
                    </div>
                </div>
            </section>

            <!-- Car Rentals Section -->
            <section id="rentals-section">
                <div class="container">
                    <div class="section-title">
                        <h2>Premium Car Rental Fleet</h2>
                        <p>Experience luxury with our exclusive short-term rental collection</p>
                    </div>
                    
                    <!-- Currency Toggle -->
                    <div class="currency-toggle">
                        <button class="currency-btn active" onclick="setRentalCurrency('kes')">KES</button>
                        <button class="currency-btn" onclick="setRentalCurrency('usd')">USD</button>
                    </div>
                    
                    <div class="rental-options" id="rental-listings">
                        <!-- Rental listings will be dynamically loaded here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <a class="btn btn-accent" onclick="showRentalModal()">Book Luxury Rental</a>
                        <a class="btn btn-outline" style="margin-left: 15px;" onclick="showCorporateServicesModal()">Corporate Rental Inquiry</a>
                    </div>
                </div>
            </section>

            <!-- Two-Way Rating System Section -->
            <section style="background-color: var(--light);">
                <div class="container">
                    <div class="section-title">
                        <h2>Two-Way Rating System</h2>
                        <p>Build trust through mutual feedback between buyers and sellers</p>
                    </div>
                    
                    <div class="two-way-rating">
                        <div class="rating-card">
                            <div class="rating-header">
                                <div class="rating-user">
                                    <div class="rating-avatar">BJ</div>
                                    <div>
                                        <strong>Brian J.</strong>
                                        <div class="rating-stars">
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star"></span>
                                            <span>(4.5)</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <span class="user-badge badge-verified-buyer">Verified Buyer</span>
                                    <span class="user-badge badge-platinum">Platinum Seller</span>
                                </div>
                            </div>
                            <div class="rating-content">
                                "The seller was extremely professional and the car was exactly as described. The verification process gave me confidence in the transaction."
                            </div>
                        </div>
                        
                        <div class="rating-card">
                            <div class="rating-header">
                                <div class="rating-user">
                                    <div class="rating-avatar">SA</div>
                                    <div>
                                        <strong>Sarah A.</strong>
                                        <div class="rating-stars">
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span>(5.0)</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <span class="user-badge badge-verified-seller">Verified Seller</span>
                                    <span class="user-badge badge-gold">Gold Seller</span>
                                </div>
                            </div>
                            <div class="rating-content">
                                "As a first-time seller, the platform made the process smooth. The buyer verification ensured I was dealing with serious inquiries only."
                            </div>
                        </div>
                        
                        <div class="rating-card">
                            <div class="rating-header">
                                <div class="rating-user">
                                    <div class="rating-avatar">MK</div>
                                    <div>
                                        <strong>Michael K.</strong>
                                        <div class="rating-stars">
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star filled"></span>
                                            <span class="star"></span>
                                            <span>(4.0)</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <span class="user-badge badge-verified-buyer">Verified Buyer</span>
                                    <span class="user-badge badge-corporate">Corporate Account</span>
                                </div>
                            </div>
                            <div class="rating-content">
                                "The rental process was seamless. The car was delivered on time and in perfect condition. Will definitely use again for business trips."
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- How It Works Section -->
            <section>
                <div class="container">
                    <div class="section-title">
                        <h2>How It Works</h2>
                        <p>Our simple 3-step process ensures you buy or rent with confidence</p>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <div class="step-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <h3>Browse & Choose</h3>
                            <p>Search through our verified luxury car listings and rental fleet to find your perfect vehicle.</p>
                        </div>
                        
                        <div class="step">
                            <div class="step-icon">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <h3>Verify & Inspect</h3>
                            <p>We verify all sellers and provide detailed inspection reports for complete transparency.</p>
                        </div>
                        
                        <div class="step">
                            <div class="step-icon">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <h3>Complete Transaction</h3>
                            <p>Secure payment, documentation handling, and vehicle delivery - we manage it all.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Trust Section -->
            <section class="trust-section">
                <div class="container">
                    <div class="section-title">
                        <h2>Why Trust AGAS LUXE DRIVE?</h2>
                        <p>We partner with trusted organizations to ensure your luxury car experience is safe and reliable</p>
                    </div>
                    
                    <div class="trust-badges">
                        <div class="trust-badge">
                            <i class="fas fa-user-shield"></i>
                            <h4>Seller Verification</h4>
                            <p>All sellers are thoroughly vetted</p>
                        </div>
                        
                        <div class="trust-badge">
                            <i class="fas fa-file-contract"></i>
                            <h4>Document Check</h4>
                            <p>Logbooks and ownership verified</p>
                        </div>
                        
                        <div class="trust-badge">
                            <i class="fas fa-car-crash"></i>
                            <h4>Vehicle Inspection</h4>
                            <p>Comprehensive mechanical checks</p>
                        </div>
                        
                        <div class="trust-badge">
                            <i class="fas fa-hand-holding-usd"></i>
                            <h4>Payment Protection</h4>
                            <p>Secure transactions guaranteed</p>
                        </div>
                    </div>
                    
                    <!-- UPDATED TESTIMONIALS SECTION -->
                    <div class="testimonials">
                        <div class="testimonial">
                            <p class="testimonial-text">"The verification process was thorough - they caught an issue with the transmission that even I wasn't aware of. Saved me from a costly repair down the line. The Mercedes GLE arrived exactly as inspected."</p>
                            <div class="testimonial-author">
                                <div class="author-avatar" style="background-color: #1a365d; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">SJ</div>
                                <div>
                                    <h4>Sarah J.</h4>
                                    <p>Purchased a Mercedes-Benz GLE 350d</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="testimonial">
                            <p class="testimonial-text">"Rented a Range Rover for a client meeting in Karen. The concierge service handled everything - from airport pickup to detailing between uses. The client was impressed with the vehicle's condition and our attention to detail."</p>
                            <div class="testimonial-author">
                                <div class="author-avatar" style="background-color: #c53030; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">MK</div>
                                <div>
                                    <h4>Michael K.</h4>
                                    <p>Rented a Range Rover for 3 days</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </section>

        <!-- Listings Section -->
        <section id="listings-section" style="display: none; padding: 100px 0 80px;">
            <div class="container">
                <div class="section-title">
                    <h2>All Luxury Car Listings</h2>
                    <p>Browse our complete collection of verified luxury vehicles</p>
                </div>
                
                <div class="filter-bar">
                    <form class="filter-form" id="listings-filter-form">
                        <div class="form-group">
                            <label for="listings-make">Make</label>
                            <select id="listings-make" class="form-control">
                                <option value="">Any Make</option>
                                <option value="mercedes">Mercedes-Benz</option>
                                <option value="bmw">BMW</option>
                                <option value="audi">Audi</option>
                                <option value="range rover">Range Rover</option>
                                <option value="porsche">Porsche</option>
                                <option value="lexus">Lexus</option>
                                <option value="jaguar">Jaguar</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="listings-model">Model</label>
                            <input type="text" id="listings-model" class="form-control" placeholder="Any Model">
                        </div>
                        
                        <div class="form-group">
                            <label for="listings-year">Year</label>
                            <select id="listings-year" class="form-control">
                                <option value="">Any Year</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                                <option value="2019">2019</option>
                                <option value="2018">2018</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="listings-price">Max Price</label>
                            <select id="listings-price" class="form-control">
                                <option value="">Any Price</option>
                                <option value="50000">$50,000</option>
                                <option value="100000">$100,000</option>
                                <option value="150000">$150,000</option>
                                <option value="200000">$200,000</option>
                                <option value="300000">$300,000+</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button type="submit" class="btn">Search</button>
                        </div>
                    </form>
                </div>
                
                <div class="car-grid" id="all-car-listings">
                    <!-- All car listings will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- Brand Gallery Section -->
        <section id="brand-gallery-section" style="display: none; padding: 100px 0;">
            <div class="container">
                <div class="section-title">
                    <h2>Luxury Brand Gallery</h2>
                    <p>Explore our exclusive collection of premium automotive brands</p>
                </div>
                
                <div class="brands-grid">
                    <div class="brand-card" onclick="filterByBrand('mercedes')">
                        <div class="brand-logo">
                            <i class="fas fa-car" style="color: #00a6a6;"></i>
                        </div>
                        <h3>Mercedes-Benz</h3>
                        <p>German Engineering Excellence</p>
                        <div style="margin-top: 15px;">
                            <span class="btn btn-outline" style="padding: 5px 15px; font-size: 0.8rem;">View 24 Models</span>
                        </div>
                    </div>
                    
                    <div class="brand-card" onclick="filterByBrand('bmw')">
                        <div class="brand-logo">
                            <i class="fas fa-car" style="color: #0066b1;"></i>
                        </div>
                        <h3>BMW</h3>
                        <p>Ultimate Driving Machines</p>
                        <div style="margin-top: 15px;">
                            <span class="btn btn-outline" style="padding: 5px 15px; font-size: 0.8rem;">View 18 Models</span>
                        </div>
                    </div>
                    
                    <div class="brand-card" onclick="filterByBrand('range rover')">
                        <div class="brand-logo">
                            <i class="fas fa-car" style="color: #004225;"></i>
                        </div>
                        <h3>Range Rover</h3>
                        <p>British Luxury & Capability</p>
                        <div style="margin-top: 15px;">
                            <span class="btn btn-outline" style="padding: 5px 15px; font-size: 0.8rem;">View 12 Models</span>
                        </div>
                    </div>
                    
                    <div class="brand-card" onclick="filterByBrand('porsche')">
                        <div class="brand-logo">
                            <i class="fas fa-car" style="color: #cc0000;"></i>
                        </div>
                        <h3>Porsche</h3>
                        <p>Performance & Precision</p>
                        <div style="margin-top: 15px;">
                            <span class="btn btn-outline" style="padding: 5px 15px; font-size: 0.8rem;">View 8 Models</span>
                        </div>
                    </div>
                    
                    <div class="brand-card" onclick="filterByBrand('lexus')">
                        <div class="brand-logo">
                            <i class="fas fa-car" style="color: #1a1a1a;"></i>
                        </div>
                        <h3>Lexus</h3>
                        <p>Japanese Refinement</p>
                        <div style="margin-top: 15px;">
                            <span class="btn btn-outline" style="padding: 5px 15px; font-size: 0.8rem;">View 15 Models</span>
                        </div>
                    </div>
                    
                    <div class="brand-card" onclick="filterByBrand('audi')">
                        <div class="brand-logo">
                            <i class="fas fa-car" style="color: #bb0000;"></i>
                        </div>
                        <h3>Audi</h3>
                        <p>Vorsprung durch Technik</p>
                        <div style="margin-top: 15px;">
                            <span class="btn btn-outline" style="padding: 5px 15px; font-size: 0.8rem;">View 20 Models</span>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 50px;">
                    <h3>Can't Find Your Preferred Brand?</h3>
                    <p style="max-width: 600px; margin: 15px auto;">We continuously expand our luxury brand portfolio. Contact us for special requests or exclusive brand inquiries.</p>
                    <a class="btn btn-accent" onclick="showSection('contact')">Request Special Brand</a>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about-section" style="display: none; padding: 100px 0;">
            <div class="container">
                <div class="section-title">
                    <h2>About AGAS LUXE DRIVE</h2>
                    <p>Your trusted partner in luxury car transactions</p>
                </div>
                
                <div class="steps">
                    <div class="step">
                        <div class="step-icon" style="background-color: var(--secondary);">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <h3>Our Mission</h3>
                        <p>To connect legitimate buyers and sellers of luxury vehicles through a secure, transparent, and trustworthy platform.</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-icon" style="background-color: var(--secondary);">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Verification Process</h3>
                        <p>Every seller and vehicle undergoes rigorous verification including document checks, ownership verification, and mechanical inspections.</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-icon" style="background-color: var(--secondary);">
                            <i class="fas fa-hand-holding-heart"></i>
                        </div>
                        <h3>Buyer Protection</h3>
                        <p>We offer comprehensive buyer protection including secure payment escrow and post-purchase support.</p>
                    </div>
                </div>
                
                <div style="margin-top: 60px; text-align: center;">
                    <h3 style="margin-bottom: 30px;">Our Partners</h3>
                    <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 40px; align-items: center;">
                        <div style="font-weight: bold; color: var(--primary);">NTSA Certified</div>
                        <div style="font-weight: bold; color: var(--primary);">AA Kenya</div>
                        <div style="font-weight: bold; color: var(--primary);">Car Inspection Kenya</div>
                        <div style="font-weight: bold; color: var(--primary);">SecureDeal Escrow</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact-section" style="display: none; padding: 100px 0;">
            <div class="container">
                <div class="section-title">
                    <h2>Contact Us</h2>
                    <p>Get in touch with our team for any inquiries</p>
                </div>
                
                <div class="steps">
                    <div class="step">
                        <div class="step-icon" style="background-color: var(--accent);">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <h3>Visit Us</h3>
                        <p>Westlands, Nairobi, Kenya</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-icon" style="background-color: var(--accent);">
                            <i class="fas fa-phone"></i>
                        </div>
                        <h3>Call Us</h3>
                        <p>+254 115 230 532</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-icon" style="background-color: var(--accent);">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h3>Email Us</h3>
                        <p>agasluxedrive@gmail.com</p>
                    </div>
                </div>
                
                <div style="max-width: 600px; margin: 50px auto 0; background-color: var(--white); padding: 30px; border-radius: var(--radius); box-shadow: var(--shadow);">
                    <h3 style="text-align: center; margin-bottom: 20px;">Send us a Message</h3>
                    <form id="contact-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contact-name">Your Name</label>
                                <input type="text" id="contact-name" class="form-control" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="contact-email">Your Email</label>
                                <input type="email" id="contact-email" class="form-control" name="email" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="contact-subject">Subject</label>
                            <input type="text" id="contact-subject" class="form-control" name="subject" required>
                        </div>
                        <div class="form-group">
                            <label for="contact-message">Message</label>
                            <textarea id="contact-message" class="form-control" rows="5" name="message" required></textarea>
                        </div>
                        <button type="submit" class="btn" style="width: 100%;">Send Message</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Buyer Dashboard -->
        <section id="buyer-dashboard" class="dashboard">
            <div class="container">
                <div class="dashboard-nav">
                    <h2>Buyer Dashboard</h2>
                    <div class="dashboard-nav-actions">
                        <a class="btn btn-outline" onclick="showSection('home')">Back to Home</a>
                    </div>
                </div>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="buyer-inquiries">0</div>
                        <div class="stat-label">Inquiries Sent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="buyer-rentals">0</div>
                        <div class="stat-label">Rental Bookings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="buyer-testimonials">0</div>
                        <div class="stat-label">Testimonials</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="buyer-ratings">0</div>
                        <div class="stat-label">Ratings Given</div>
                    </div>
                </div>
                
                <div class="dashboard-tabs">
                    <button class="dashboard-tab active" onclick="switchBuyerTab('inquiries')">My Inquiries</button>
                    <button class="dashboard-tab" onclick="switchBuyerTab('rentals')">Rental Bookings</button>
                    <button class="dashboard-tab" onclick="switchBuyerTab('testimonials')">My Testimonials</button>
                    <button class="dashboard-tab" onclick="switchBuyerTab('ratings')">My Ratings</button>
                    <button class="dashboard-tab" onclick="switchBuyerTab('profile')">Profile Settings</button>
                </div>
                
                <div class="dashboard-content">
                    <div id="inquiries-tab" class="tab-content active">
                        <div class="breadcrumb">
                            <a onclick="switchBuyerTab('inquiries')">My Inquiries</a>
                        </div>
                        <h3>My Car Inquiries</h3>
                        <div id="buyer-inquiries-list">
                            <!-- Buyer inquiries will appear here -->
                        </div>
                    </div>
                    
                    <div id="rentals-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchBuyerTab('rentals')">My Rental Bookings</a>
                        </div>
                        <h3>My Rental Bookings</h3>
                        <div id="buyer-rentals-list">
                            <!-- Buyer rentals will appear here -->
                        </div>
                    </div>
                    
                    <div id="testimonials-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchBuyerTab('testimonials')">My Testimonials</a>
                        </div>
                        <h3>My Testimonials</h3>
                        <div id="buyer-testimonials-list">
                            <!-- Buyer testimonials will appear here -->
                        </div>
                        <div style="margin-top: 20px;">
                            <h4>Add New Testimonial</h4>
                            <form id="testimonial-form">
                                <div class="form-group">
                                    <label for="testimonial-title">Title</label>
                                    <input type="text" id="testimonial-title" class="form-control" name="title" required>
                                </div>
                                <div class="form-group">
                                    <label for="testimonial-content">Testimonial</label>
                                    <textarea id="testimonial-content" class="form-control" rows="4" name="content" required></textarea>
                                </div>
                                <button type="submit" class="btn">Submit Testimonial</button>
                            </form>
                        </div>
                    </div>
                    
                    <div id="ratings-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchBuyerTab('ratings')">My Ratings</a>
                        </div>
                        <h3>My Ratings</h3>
                        <div id="buyer-ratings-list">
                            <!-- Buyer ratings will appear here -->
                        </div>
                    </div>
                    
                    <div id="profile-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchBuyerTab('profile')">Profile Settings</a>
                        </div>
                        <h3>Profile Settings</h3>
                        <form id="buyer-profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="buyer-fname">First Name</label>
                                    <input type="text" id="buyer-fname" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="buyer-lname">Last Name</label>
                                    <input type="text" id="buyer-lname" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="buyer-email">Email</label>
                                <input type="email" id="buyer-email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="buyer-phone">Phone Number</label>
                                <input type="tel" id="buyer-phone" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label>ID Verification</label>
                                <div class="id-verification">
                                    <div class="form-group country-select">
                                        <select id="buyer-country" class="form-control" required>
                                            <option value="">Country</option>
                                            <option value="KE">Kenya</option>
                                            <option value="TZ">Tanzania</option>
                                            <option value="UG">Uganda</option>
                                            <option value="RW">Rwanda</option>
                                            <option value="ET">Ethiopia</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group id-input">
                                        <input type="text" id="buyer-id" class="form-control" placeholder="ID Number" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="buyer-address">Address</label>
                                <textarea id="buyer-address" class="form-control" rows="3"></textarea>
                            </div>
                            <button type="submit" class="btn">Update Profile</button>
                        </form>
                        
                        <div style="margin-top: 30px;">
                            <h4>Security Settings</h4>
                            <form id="buyer-password-form">
                                <div class="form-group">
                                    <label for="buyer-current-password">Current Password</label>
                                    <input type="password" id="buyer-current-password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="buyer-new-password">New Password</label>
                                    <input type="password" id="buyer-new-password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="buyer-confirm-password">Confirm New Password</label>
                                    <input type="password" id="buyer-confirm-password" class="form-control">
                                </div>
                                <button type="submit" class="btn">Update Password</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seller Dashboard -->
        <section id="seller-dashboard" class="dashboard">
            <div class="container">
                <div class="dashboard-nav">
                    <h2>Seller Dashboard</h2>
                    <div class="dashboard-nav-actions">
                        <a class="btn btn-outline" onclick="showSection('home')">Back to Home</a>
                    </div>
                </div>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="seller-listings">0</div>
                        <div class="stat-label">Active Listings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="seller-inquiries">0</div>
                        <div class="stat-label">Inquiries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="seller-sales">0</div>
                        <div class="stat-label">Cars Sold</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="seller-ratings">0</div>
                        <div class="stat-label">Ratings Received</div>
                    </div>
                </div>
                
                <div class="dashboard-tabs">
                    <button class="dashboard-tab active" onclick="switchSellerTab('my-listings')">My Listings</button>
                    <button class="dashboard-tab" onclick="switchSellerTab('add-listing')">Add New Car</button>
                    <button class="dashboard-tab" onclick="switchSellerTab('rental-listings')">My Rentals</button>
                    <button class="dashboard-tab" onclick="switchSellerTab('add-rental')">Add Rental</button>
                    <button class="dashboard-tab" onclick="switchSellerTab('inquiries')">Inquiries</button>
                    <button class="dashboard-tab" onclick="switchSellerTab('ratings')">Ratings</button>
                    <button class="dashboard-tab" onclick="switchSellerTab('profile')">Company Profile</button>
                </div>
                
                <div class="dashboard-content">
                    <div id="my-listings-tab" class="tab-content active">
                        <div class="breadcrumb">
                            <a onclick="switchSellerTab('my-listings')">My Car Listings</a>
                        </div>
                        <h3>My Car Listings</h3>
                        <div id="seller-listings-list">
                            <!-- Seller's listings will appear here -->
                        </div>
                    </div>
                    
                    <div id="add-listing-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchSellerTab('add-listing')">List a New Car</a>
                        </div>
                        <h3>List a New Car</h3>
                        <form id="add-car-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="car-make">Make</label>
                                    <input type="text" id="car-make" class="form-control" name="make" required>
                                </div>
                                <div class="form-group">
                                    <label for="car-model">Model</label>
                                    <input type="text" id="car-model" class="form-control" name="model" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="car-year">Year</label>
                                    <input type="number" id="car-year" class="form-control" min="1990" max="2023" name="year" required>
                                </div>
                                <div class="form-group">
                                    <label for="car-price">Price ($)</label>
                                    <input type="number" id="car-price" class="form-control" name="price" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="car-mileage">Mileage</label>
                                    <input type="number" id="car-mileage" class="form-control" name="mileage" required>
                                </div>
                                <div class="form-group">
                                    <label for="car-transmission">Transmission</label>
                                    <select id="car-transmission" class="form-control" name="transmission" required>
                                        <option value="">Select</option>
                                        <option value="automatic">Automatic</option>
                                        <option value="manual">Manual</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="car-fuel">Fuel Type</label>
                                    <select id="car-fuel" class="form-control" name="fuel" required>
                                        <option value="">Select</option>
                                        <option value="petrol">Petrol</option>
                                        <option value="diesel">Diesel</option>
                                        <option value="hybrid">Hybrid</option>
                                        <option value="electric">Electric</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="car-color">Color</label>
                                    <input type="text" id="car-color" class="form-control" name="color" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="car-condition">Condition</label>
                                    <select id="car-condition" class="form-control" name="condition" required>
                                        <option value="">Select</option>
                                        <option value="new">New</option>
                                        <option value="used">Used</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="car-vin">VIN Number</label>
                                    <input type="text" id="car-vin" class="form-control" name="vin" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="car-description">Description</label>
                                <textarea id="car-description" class="form-control" rows="4" name="description" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="car-images">Upload Images</label>
                                <input type="file" id="car-images" class="form-control" multiple accept="image/*">
                            </div>
                            
                            <div class="form-group">
                                <label for="car-documents">Upload Documents (Logbook, ID, etc.)</label>
                                <input type="file" id="car-documents" class="form-control" multiple>
                            </div>

                            <div class="kyc-documents">
                                <div class="kyc-doc">
                                    <h5>Logbook</h5>
                                    <img src="https://via.placeholder.com/200x120?text=Logbook" alt="Logbook">
                                    <input type="file" class="form-control" style="margin-top: 10px;">
                                </div>
                                <div class="kyc-doc">
                                    <h5>ID Copy</h5>
                                    <img src="https://via.placeholder.com/200x120?text=ID+Copy" alt="ID Copy">
                                    <input type="file" class="form-control" style="margin-top: 10px;">
                                </div>
                                <div class="kyc-doc">
                                    <h5>Insurance</h5>
                                    <img src="https://via.placeholder.com/200x120?text=Insurance" alt="Insurance">
                                    <input type="file" class="form-control" style="margin-top: 10px;">
                                </div>
                                <div class="kyc-doc">
                                    <h5>Inspection Report</h5>
                                    <img src="https://via.placeholder.com/200x120?text=Inspection" alt="Inspection">
                                    <input type="file" class="form-control" style="margin-top: 10px;">
                                </div>
                            </div>
                            
                            <div class="terms-agreement">
                                <div class="terms-checkbox">
                                    <input type="checkbox" id="agree-terms" required>
                                    <label for="agree-terms">I agree to the Terms & Conditions and confirm that all information provided is accurate</label>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn">Submit for Verification</button>
                        </form>
                    </div>
                    
                    <div id="rental-listings-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchSellerTab('rental-listings')">My Rental Listings</a>
                        </div>
                        <h3>My Rental Listings</h3>
                        <div id="seller-rental-listings">
                            <!-- Seller's rental listings will appear here -->
                        </div>
                    </div>
                    
                    <div id="add-rental-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchSellerTab('add-rental')">Add a Car for Rental</a>
                        </div>
                        <h3>Add a Car for Rental</h3>
                        <form id="add-rental-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="rental-make">Make</label>
                                    <input type="text" id="rental-make" class="form-control" name="make" required>
                                </div>
                                <div class="form-group">
                                    <label for="rental-model">Model</label>
                                    <input type="text" id="rental-model" class="form-control" name="model" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="rental-year">Year</label>
                                    <input type="number" id="rental-year" class="form-control" min="1990" max="2023" name="year" required>
                                </div>
                                <div class="form-group">
                                    <label for="rental-type">Type</label>
                                    <select id="rental-type" class="form-control" name="type" required>
                                        <option value="">Select</option>
                                        <option value="Executive Sedan">Executive Sedan</option>
                                        <option value="Luxury SUV">Luxury SUV</option>
                                        <option value="Performance SUV">Performance SUV</option>
                                        <option value="Sports Car">Sports Car</option>
                                        <option value="Convertible">Convertible</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="rental-daily-rate">Daily Rate (KES)</label>
                                    <input type="number" id="rental-daily-rate" class="form-control" name="daily_rate" required>
                                </div>
                                <div class="form-group">
                                    <label for="rental-weekly-rate">Weekly Rate (KES)</label>
                                    <input type="number" id="rental-weekly-rate" class="form-control" name="weekly_rate" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="rental-features">Features (comma separated)</label>
                                <input type="text" id="rental-features" class="form-control" placeholder="Chauffeur Option, Full Insurance, WiFi, Massage Seats" name="features" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="rental-description">Description</label>
                                <textarea id="rental-description" class="form-control" rows="4" name="description" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="rental-image">Upload Image</label>
                                <input type="file" id="rental-image" class="form-control" accept="image/*">
                            </div>
                            
                            <div class="terms-agreement">
                                <div class="terms-checkbox">
                                    <input type="checkbox" id="rental-agree-terms" required>
                                    <label for="rental-agree-terms">I agree to the Rental Terms & Conditions and confirm that all information provided is accurate</label>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn">Submit Rental Listing</button>
                        </form>
                    </div>
                    
                    <div id="inquiries-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchSellerTab('inquiries')">Inquiries About My Cars</a>
                        </div>
                        <h3>Inquiries About My Cars</h3>
                        <div id="seller-inquiries-list">
                            <!-- Inquiries will appear here -->
                        </div>
                    </div>

                    <div id="ratings-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchSellerTab('ratings')">Ratings Received</a>
                        </div>
                        <h3>Ratings Received</h3>
                        <div id="seller-ratings-list">
                            <!-- Ratings will appear here -->
                        </div>
                    </div>

                    <div id="profile-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchSellerTab('profile')">Company Profile</a>
                        </div>
                        <h3>Company Profile</h3>
                        <form id="seller-profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="company-name">Company Name</label>
                                    <input type="text" id="company-name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="company-reg">Registration Number</label>
                                    <input type="text" id="company-reg" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="seller-fname">Contact First Name</label>
                                    <input type="text" id="seller-fname" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="seller-lname">Contact Last Name</label>
                                    <input type="text" id="seller-lname" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="seller-email">Email</label>
                                <input type="email" id="seller-email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="seller-phone">Phone Number</label>
                                <input type="tel" id="seller-phone" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label>ID Verification</label>
                                <div class="id-verification">
                                    <div class="form-group country-select">
                                        <select id="seller-country" class="form-control" required>
                                            <option value="">Country</option>
                                            <option value="KE">Kenya</option>
                                            <option value="TZ">Tanzania</option>
                                            <option value="UG">Uganda</option>
                                            <option value="RW">Rwanda</option>
                                            <option value="ET">Ethiopia</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group id-input">
                                        <input type="text" id="seller-id" class="form-control" placeholder="ID Number" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="seller-address">Company Address</label>
                                <textarea id="seller-address" class="form-control" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="company-description">Company Description</label>
                                <textarea id="company-description" class="form-control" rows="4"></textarea>
                            </div>
                            <button type="submit" class="btn">Update Profile</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Panel -->
        <section id="admin-section" class="admin-panel">
            <div class="container">
                <div class="dashboard-nav">
                    <h2>Enterprise Admin Panel</h2>
                    <div class="dashboard-nav-actions">
                        <a class="btn btn-outline" onclick="showSection('home')">Back to Home</a>
                    </div>
                </div>
                
                <div class="admin-office">
                    <div class="admin-toolbar">
                        <button class="btn" onclick="showAdminAddCarModal()">Add New Car</button>
                        <button class="btn btn-accent" onclick="generateReports()">Generate Reports</button>
                        <button class="btn btn-success" onclick="sendBulkNotifications()">Send Notifications</button>
                        <button class="btn" onclick="showAdminAddRentalModal()">Add Rental Car</button>
                        <button class="btn" onclick="document.getElementById('company-logo-input').click()">Set Company Logo</button>
                        <input type="file" id="company-logo-input" accept="image/*" style="display:none">
                    </div>
                    
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="admin-listings">0</div>
                        <div class="stat-label">Total Listings</div>
                    </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-pending">0</div>
                            <div class="stat-label">Pending Approvals</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-users">0</div>
                            <div class="stat-label">Registered Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-rentals">0</div>
                            <div class="stat-label">Active Rentals</div>
                        </div>
                    </div>
                </div>
                <div class="admin-sidebar">
                    <button class="dashboard-tab active" onclick="switchAdminTab('pending')">Pending Approvals</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('verified')">Verified Listings</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('rentals')">Rental Management</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('communications')">Communications</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('users')">User Management</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('testimonials')">Testimonials</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('reports')">Analytics & Reports</button>
                </div>

                <div class="dashboard-tabs">
                    <button class="dashboard-tab active" onclick="switchAdminTab('pending')">Pending Approvals</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('verified')">Verified Listings</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('rentals')">Rental Management</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('communications')">Communications</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('users')">User Management</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('testimonials')">Testimonials</button>
                    <button class="dashboard-tab" onclick="switchAdminTab('reports')">Analytics & Reports</button>
                </div>
                
                <div class="dashboard-content">
                    <div id="pending-tab" class="tab-content active">
                        <div class="breadcrumb">
                            <a onclick="switchAdminTab('pending')">Pending Approvals</a>
                        </div>
                        <h3>Pending Car Listings</h3>
                        <div class="pending-listings" id="pending-listings">
                            <!-- Pending listings will appear here -->
                        </div>
                        
                        <h3 style="margin-top: 30px;">Pending Rental Listings</h3>
                        <div class="pending-listings" id="pending-rentals">
                            <!-- Pending rentals will appear here -->
                        </div>
                    </div>
                    
                    <div id="verified-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchAdminTab('verified')">Verified Listings</a>
                        </div>
                        <h3>Verified Car Listings</h3>
                        <div id="verified-listings">
                            <!-- Verified listings will appear here -->
                        </div>
                    </div>
                    
                    <!-- ENHANCED RENTAL MANAGEMENT TAB -->
                    <div id="rentals-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchAdminTab('rentals')">Rental Management</a>
                        </div>
                        <h3>Verified Rental Listings</h3>
                        <div id="verified-rentals">
                            <!-- Verified rentals will appear here -->
                        </div>
                        
                        <h3 style="margin-top: 30px;">Pending Rental Approvals</h3>
                        <div id="pending-rentals-list">
                            <!-- Pending rentals will appear here -->
                        </div>
                    </div>

                    <div id="communications-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchAdminTab('communications')">Communications</a>
                        </div>
                        <h3>Client Inquiries</h3>
                        <div id="admin-inquiries-list"></div>
                        <h3 style="margin-top: 30px;">Rental Bookings</h3>
                        <div id="admin-bookings-list"></div>
                    </div>
                    
                    <div id="users-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchAdminTab('users')">User Management</a>
                        </div>
                        <h3>User Management</h3>
                        <div id="user-management">
                            <!-- User management will appear here -->
                        </div>
                    </div>

                    <div id="testimonials-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchAdminTab('testimonials')">Testimonial Approvals</a>
                        </div>
                        <h3>Testimonial Approvals</h3>
                        <div id="testimonial-approvals">
                            <!-- Testimonial approvals will appear here -->
                        </div>
                    </div>

                    <div id="reports-tab" class="tab-content">
                        <div class="breadcrumb">
                            <a onclick="switchAdminTab('reports')">Analytics & Reports</a>
                        </div>
                        <h3>Analytics & Reports</h3>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <div class="stat-value" id="report-listings">0</div>
                                <div class="stat-label">Total Listings</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="report-verified">0</div>
                                <div class="stat-label">Verified Listings</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="report-rentals">0</div>
                                <div class="stat-label">Active Rentals</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="report-pending">0</div>
                                <div class="stat-label">Pending Approvals</div>
                            </div>
                        </div>
                        <div style="margin-top: 30px;">
                            <h4>Platform Performance</h4>
                            <div style="background: var(--light); padding: 20px; border-radius: var(--radius);">
                                <p><strong>Monthly Growth:</strong> <span id="growth-rate">+15%</span> new listings</p>
                                <p><strong>User Engagement:</strong> <span id="engagement-rate">78%</span> active users</p>
                                <p><strong>Approval Rate:</strong> <span id="approval-rate">92%</span> of listings approved</p>
                                <p><strong>Customer Satisfaction:</strong> <span id="satisfaction-rate">4.8/5</span> stars</p>
                            </div>
                        </div>
                        <div style="margin-top: 30px; display: grid; grid-template-columns: 1fr; gap: 20px;">
                            <div>
                                <h4>Listings Overview</h4>
                                <canvas id="chart-listings" width="640" height="280"></canvas>
                            </div>
                            <div>
                                <h4>Engagement Trend</h4>
                                <canvas id="chart-engagement" width="640" height="280"></canvas>
                            </div>
                            <div>
                                <h4>Distribution</h4>
                                <div style="position: relative;">
                                    <canvas id="chart-distribution" width="640" height="320"></canvas>
                                    <div id="chart-tooltip" style="position: absolute; display: none; background: rgba(0,0,0,0.8); color: #fff; padding: 6px 10px; border-radius: 6px; font-size: 12px; pointer-events: none;"></div>
                                </div>
                                <div id="chart-legend" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 10px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <div class="footer-logo">
                        <div class="logo-agas">AGAS</div>
                        <div class="logo-luxe-drive">LUXE DRIVE</div>
                        <div class="logo-tagline">Drive luxury. live AGAS.</div>
                    </div>
                    <p>East Africa's premier luxury automotive marketplace with verified sellers, premium rentals, and enterprise-grade security.</p>
                    <div class="social-links">
                        <a href="https://facebook.com/agasluxedrive" target="_blank"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://instagram.com/agasluxedrive" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="#"><img src="https://www.freepnglogos.com/x-logo-png-twitter-0.jpg" alt="X (Twitter)" style="width: 20px; height: 20px; filter: invert(1);"></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://wa.me/254115230532" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>Enterprise Services</h3>
                    <ul class="footer-links">
                        <li><a onclick="showSection('home'); setTimeout(() => document.getElementById('featured-vehicles').scrollIntoView({ behavior: 'smooth' }), 100);">Luxury Vehicle Sales</a></li>
                        <li><a onclick="showSection('rentals')">Premium Rentals</a></li>
                        <li><a onclick="showProfileSelection()">Sell Your Vehicle</a></li>
                        <li><a onclick="showBrandGallery()">Brand Showcase</a></li>
                        <li><a onclick="showCorporateServicesModal()">Corporate Services</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Security & Support</h3>
                    <ul class="footer-links">
                        <li><a onclick="showSection('contact')">24/7 Support</a></li>
                        <li><a onclick="showPasswordResetModal()">Password Reset</a></li>
                        <li><a onclick="showSection('about')">Verification Process</a></li>
                        <li><a>Buyer Protection</a></li>
                        <li><a>Rental Terms</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Contact Enterprise</h3>
                    <ul class="footer-links">
                        <li><i class="fas fa-map-marker-alt"></i> Westlands, Nairobi, Kenya</li>
                        <li><i class="fas fa-phone"></i> +254 115 230 532</li>
                        <li><i class="fas fa-envelope"></i> agasluxedrive@gmail.com</li>
                        <li><i class="fab fa-whatsapp"></i> +254 115 230 532</li>
                        <li><i class="fas fa-clock"></i> 24/7 Enterprise Support</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 AGAS LUXE DRIVE ENTERPRISE LIMITED. All rights reserved. | <a>Enterprise Privacy Policy</a> | <a>Terms of Service</a> | <a>Security Protocol</a></p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Secure Login</h3>
                <button class="close-modal" onclick="closeModal('login-modal')">&times;</button>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" required>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Secure Login</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                <a onclick="closeModal('login-modal'); showPasswordResetModal();">Forgot Password?</a>
            </p>
            <p style="text-align: center; margin-top: 15px;">
                Don't have an account? <a onclick="closeModal('login-modal'); showProfileSelection();">Sign Up</a>
            </p>
            <p style="text-align: center; margin-top: 10px;">
                <a onclick="closeModal('login-modal'); showAdminLoginModal();">Enterprise Admin Login</a>
            </p>
        </div>
    </div>

    <!-- Profile Selection Modal -->
    <div id="profile-selection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Choose Your Profile Type</h3>
                <button class="close-modal" onclick="closeModal('profile-selection-modal')">&times;</button>
            </div>
            <div class="profile-selection">
                <div class="profile-card" onclick="selectProfile('buyer')">
                    <div class="profile-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <h3>Buyer</h3>
                    <p>Browse, rent, and purchase luxury vehicles</p>
                    <ul style="text-align: left; margin-top: 15px;">
                        <li>Access to verified luxury cars</li>
                        <li>Premium rental services</li>
                        <li>Secure transaction process</li>
                        <li>24/7 customer support</li>
                    </ul>
                </div>
                
                <div class="profile-card" onclick="selectProfile('seller')">
                    <div class="profile-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <h3>Seller</h3>
                    <p>List and sell your luxury vehicles</p>
                    <ul style="text-align: left; margin-top: 15px;">
                        <li>Verified seller profile</li>
                        <li>Access to premium buyers</li>
                        <li>Secure payment processing</li>
                        <li>Professional listing tools</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Buyer Signup Modal -->
    <div id="buyer-signup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create Buyer Account</h3>
                <button class="close-modal" onclick="closeModal('buyer-signup-modal')">&times;</button>
            </div>
            <form id="buyer-signup-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="buyer-signup-fname">First Name</label>
                        <input type="text" id="buyer-signup-fname" class="form-control" name="first_name" required>
                    </div>
                    <div class="form-group">
                        <label for="buyer-signup-lname">Last Name</label>
                        <input type="text" id="buyer-signup-lname" class="form-control" name="last_name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="buyer-signup-email">Email</label>
                    <input type="email" id="buyer-signup-email" class="form-control" name="email" required>
                </div>
                <div class="form-group">
                    <label for="buyer-signup-phone">Phone Number</label>
                    <input type="tel" id="buyer-signup-phone" class="form-control" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>ID Verification</label>
                    <div class="id-verification">
                        <div class="form-group country-select">
                            <select id="buyer-signup-country" class="form-control" required>
                                <option value="">Country</option>
                                <option value="KE">Kenya</option>
                                <option value="TZ">Tanzania</option>
                                <option value="UG">Uganda</option>
                                <option value="RW">Rwanda</option>
                                <option value="ET">Ethiopia</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group id-input">
                            <input type="text" id="buyer-signup-id" class="form-control" placeholder="ID Number" required>
                        </div>
                        <div class="form-group id-input">
                            <label for="buyer-id-document">Upload ID Document (optional)</label>
                            <input type="file" id="buyer-id-document" class="form-control" accept="image/*,application/pdf">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="buyer-signup-password">Password</label>
                    <input type="password" id="buyer-signup-password" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="buyer-signup-confirm">Confirm Password</label>
                    <input type="password" id="buyer-signup-confirm" class="form-control" required>
                </div>
                <div class="terms-agreement">
                    <div class="terms-checkbox">
                        <input type="checkbox" id="buyer-agree-terms" required>
                        <label for="buyer-agree-terms">I agree to the Terms & Conditions</label>
                    </div>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Create Buyer Account</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                Already have an account? <a onclick="closeModal('buyer-signup-modal'); showLoginModal();">Login here</a>
            </p>
        </div>
    </div>

    <!-- Seller Signup Modal -->
    <div id="seller-signup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create Seller Account</h3>
                <button class="close-modal" onclick="closeModal('seller-signup-modal')">&times;</button>
            </div>
            <form id="seller-signup-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="seller-company-name">Company Name</label>
                        <input type="text" id="seller-company-name" class="form-control" name="company_name" required>
                    </div>
                    <div class="form-group">
                        <label for="seller-reg-number">Registration Number</label>
                        <input type="text" id="seller-reg-number" class="form-control" name="registration_number" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="seller-signup-fname">Contact First Name</label>
                        <input type="text" id="seller-signup-fname" class="form-control" name="contact_first_name" required>
                    </div>
                    <div class="form-group">
                        <label for="seller-signup-lname">Contact Last Name</label>
                        <input type="text" id="seller-signup-lname" class="form-control" name="contact_last_name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="seller-signup-email">Email</label>
                    <input type="email" id="seller-signup-email" class="form-control" name="email" required>
                </div>
                <div class="form-group">
                    <label for="seller-signup-phone">Phone Number</label>
                    <input type="tel" id="seller-signup-phone" class="form-control" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>ID Verification</label>
                    <div class="id-verification">
                        <div class="form-group country-select">
                            <select id="seller-signup-country" class="form-control" required>
                                <option value="">Country</option>
                                <option value="KE">Kenya</option>
                                <option value="TZ">Tanzania</option>
                                <option value="UG">Uganda</option>
                                <option value="RW">Rwanda</option>
                                <option value="ET">Ethiopia</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group id-input">
                            <input type="text" id="seller-signup-id" class="form-control" placeholder="ID Number" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="seller-signup-password">Password</label>
                    <input type="password" id="seller-signup-password" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="seller-signup-confirm">Confirm Password</label>
                    <input type="password" id="seller-signup-confirm" class="form-control" required>
                </div>
                <div class="terms-agreement">
                    <div class="terms-checkbox">
                        <input type="checkbox" id="seller-agree-terms" required>
                        <label for="seller-agree-terms">I agree to the Terms & Conditions</label>
                    </div>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Create Seller Account</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                Already have an account? <a onclick="closeModal('seller-signup-modal'); showLoginModal();">Login here</a>
            </p>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Admin Login</h3>
                <button class="close-modal" onclick="closeModal('admin-login-modal')">&times;</button>
            </div>
            <form id="admin-login-form">
                <div class="form-group">
                    <label for="admin-username">Username</label>
                    <input type="text" id="admin-username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" class="form-control" required>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Login as Admin</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                <a onclick="closeModal('admin-login-modal'); showLoginModal();">User Login</a>
            </p>
            <p style="text-align: center; margin-top: 10px; font-size: 0.8rem; color: var(--gray);">
                <a onclick="showAdminPasswordResetInfo()" style="cursor: pointer;">Admin Password Reset</a>
            </p>
        </div>
    </div>

    <!-- 2FA Verification Modal -->
    <div id="twofa-modal" class="modal twofa-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Two-Factor Authentication</h3>
                <button class="close-modal" onclick="closeModal('twofa-modal')">&times;</button>
            </div>
            <p style="text-align: center; margin-bottom: 20px;">
                Enter the 6-digit code sent to your email
            </p>
            <div class="twofa-code">
                <input type="text" class="twofa-digit" maxlength="1" oninput="moveToNext(this, 1)">
                <input type="text" class="twofa-digit" maxlength="1" oninput="moveToNext(this, 2)">
                <input type="text" class="twofa-digit" maxlength="1" oninput="moveToNext(this, 3)">
                <input type="text" class="twofa-digit" maxlength="1" oninput="moveToNext(this, 4)">
                <input type="text" class="twofa-digit" maxlength="1" oninput="moveToNext(this, 5)">
                <input type="text" class="twofa-digit" maxlength="1" oninput="moveToNext(this, 6)">
            </div>
            <button type="button" class="btn" style="width: 100%; margin-top: 20px;" onclick="verifyTwoFactor()">Verify & Login</button>
            <p style="text-align: center; margin-top: 15px;">
                <a onclick="resendTwoFACode()">Resend Code</a>
            </p>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div id="password-reset-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Secure Password Reset</h3>
                <button class="close-modal" onclick="closeModal('password-reset-modal')">&times;</button>
            </div>
            <form id="password-reset-form">
                <div class="form-group">
                    <label for="reset-email">Registered Email</label>
                    <input type="email" id="reset-email" class="form-control" name="email" required>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Send Reset Link</button>
            </form>
            <p style="text-align: center; margin-top: 15px; font-size: 0.9rem;">
                Reset link will be sent to your registered email address
            </p>
        </div>
    </div>

    <!-- Password Reset Confirmation Modal -->
    <div id="password-reset-confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Reset Your Password</h3>
                <button class="close-modal" onclick="closeModal('password-reset-confirm-modal')">&times;</button>
            </div>
            <form id="password-reset-confirm-form">
                <input type="hidden" id="reset-token">
                <div class="form-group">
                    <label for="new-password">New Password</label>
                    <input type="password" id="new-password" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="confirm-new-password">Confirm New Password</label>
                    <input type="password" id="confirm-new-password" class="form-control" required>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Reset Password</button>
            </form>
        </div>
    </div>

    <!-- Corporate Services Modal -->
    <div id="corporate-services-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Corporate Services</h3>
                <button class="close-modal" onclick="closeModal('corporate-services-modal')">&times;</button>
            </div>
            <div style="margin-bottom: 20px;">
                <h4 style="color: var(--primary); margin-bottom: 15px;">Enterprise Solutions for Your Business</h4>
                <div style="display: grid; gap: 15px;">
                    <div style="padding: 15px; background: var(--light); border-radius: var(--radius);">
                        <h5><i class="fas fa-car" style="color: var(--primary); margin-right: 10px;"></i> Corporate Fleet Management</h5>
                        <p>Complete fleet solutions with maintenance, insurance, and replacement services</p>
                    </div>
                    <div style="padding: 15px; background: var(--light); border-radius: var(--radius);">
                        <h5><i class="fas fa-user-tie" style="color: var(--primary); margin-right: 10px;"></i> Executive Vehicle Program</h5>
                        <p>Premium vehicles for your executive team with chauffeur services available</p>
                    </div>
                    <div style="padding: 15px; background: var(--light); border-radius: var(--radius);">
                        <h5><i class="fas fa-handshake" style="color: var(--primary); margin-right: 10px;"></i> Client Transportation</h5>
                        <p>Luxury transportation services for your VIP clients and business partners</p>
                    </div>
                    <div style="padding: 15px; background: var(--light); border-radius: var(--radius);">
                        <h5><i class="fas fa-chart-line" style="color: var(--primary); margin-right: 10px;"></i> Custom Leasing Programs</h5>
                        <p>Flexible leasing options tailored to your business needs and budget</p>
                    </div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <p>Contact our corporate team for customized solutions</p>
                <a class="btn" onclick="closeModal('corporate-services-modal'); showSection('contact');">Contact Corporate Team</a>
            </div>
        </div>
    </div>

    <!-- Car Inquiry Modal -->
    <div id="inquiry-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Inquire About This Car</h3>
                <button class="close-modal" onclick="closeModal('inquiry-modal')">&times;</button>
            </div>
            <form id="inquiry-form">
                <input type="hidden" id="inquiry-car-id" name="car_id">
                <div class="form-group">
                    <label for="inquiry-name">Your Name</label>
                    <input type="text" id="inquiry-name" class="form-control" name="name" required>
                </div>
                <div class="form-group">
                    <label for="inquiry-email">Your Email</label>
                    <input type="email" id="inquiry-email" class="form-control" name="email" required>
                </div>
                <div class="form-group">
                    <label for="inquiry-phone">Your Phone</label>
                    <input type="tel" id="inquiry-phone" class="form-control" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="inquiry-message">Message</label>
                    <textarea id="inquiry-message" class="form-control" rows="4" name="message" required></textarea>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Send Inquiry</button>
            </form>
        </div>
    </div>

    <!-- Car Detail Modal -->
    <div id="car-detail-modal" class="modal car-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="car-detail-title">Car Details</h3>
                <button class="close-modal" onclick="closeModal('car-detail-modal')">&times;</button>
            </div>
            <div id="car-detail-content">
                <!-- Car details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Quick View Modal -->
    <div id="quick-view-modal" class="modal quick-view-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="quick-view-title">Quick View</h3>
                <button class="close-modal" onclick="closeModal('quick-view-modal')">&times;</button>
            </div>
            <div id="quick-view-content">
                <!-- Quick view content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Rental Booking Modal -->
    <div id="rental-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Book Luxury Rental</h3>
                <button class="close-modal" onclick="closeModal('rental-modal')">&times;</button>
            </div>
            <form id="rental-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="rental-start">Start Date</label>
                        <input type="date" id="rental-start" class="form-control" name="start_date" required>
                    </div>
                    <div class="form-group">
                        <label for="rental-end">End Date</label>
                        <input type="date" id="rental-end" class="form-control" name="end_date" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="rental-location">Delivery Location</label>
                    <input type="text" id="rental-location" class="form-control" name="location" required>
                </div>
                <div class="form-group">
                    <label for="rental-insurance">Insurance Option</label>
                    <select id="rental-insurance" class="form-control" name="insurance" required>
                        <option value="basic">Basic Insurance</option>
                        <option value="premium">Premium Insurance</option>
                        <option value="full">Full Coverage</option>
                    </select>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Complete Booking</button>
            </form>
        </div>
    </div>

    <!-- Admin Add Car Modal -->
    <div id="admin-add-car-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Car (Admin)</h3>
                <button class="close-modal" onclick="closeModal('admin-add-car-modal')">&times;</button>
            </div>
            <form id="admin-add-car-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="admin-car-make">Make</label>
                        <input type="text" id="admin-car-make" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-car-model">Model</label>
                        <input type="text" id="admin-car-model" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="admin-car-year">Year</label>
                        <input type="number" id="admin-car-year" class="form-control" min="1990" max="2023" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-car-price">Price ($)</label>
                        <input type="number" id="admin-car-price" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="admin-car-condition">Condition</label>
                        <select id="admin-car-condition" class="form-control" required>
                            <option value="">Select</option>
                            <option value="new">New</option>
                            <option value="used">Used</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="admin-car-status">Status</label>
                        <select id="admin-car-status" class="form-control" required>
                            <option value="approved">Approved</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="admin-car-description">Description</label>
                    <textarea id="admin-car-description" class="form-control" rows="4" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="admin-car-images">Upload Images</label>
                    <input type="file" id="admin-car-images" class="form-control" multiple accept="image/*">
                </div>
                
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Add Car</button>
            </form>
        </div>
    </div>

    <!-- Admin Add Rental Modal -->
    <div id="admin-add-rental-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Rental Car (Admin)</h3>
                <button class="close-modal" onclick="closeModal('admin-add-rental-modal')">&times;</button>
            </div>
            <form id="admin-add-rental-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="admin-rental-make">Make</label>
                        <input type="text" id="admin-rental-make" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-rental-model">Model</label>
                        <input type="text" id="admin-rental-model" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="admin-rental-year">Year</label>
                        <input type="number" id="admin-rental-year" class="form-control" min="1990" max="2023" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-rental-type">Type</label>
                        <select id="admin-rental-type" class="form-control" required>
                            <option value="">Select</option>
                            <option value="Executive Sedan">Executive Sedan</option>
                            <option value="Luxury SUV">Luxury SUV</option>
                            <option value="Performance SUV">Performance SUV</option>
                            <option value="Sports Car">Sports Car</option>
                            <option value="Convertible">Convertible</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="admin-rental-daily-rate">Daily Rate (KES)</label>
                        <input type="number" id="admin-rental-daily-rate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-rental-weekly-rate">Weekly Rate (KES)</label>
                        <input type="number" id="admin-rental-weekly-rate" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="admin-rental-features">Features (comma separated)</label>
                    <input type="text" id="admin-rental-features" class="form-control" placeholder="Chauffeur Option, Full Insurance, WiFi, Massage Seats" required>
                </div>
                
                <div class="form-group">
                    <label for="admin-rental-description">Description</label>
                    <textarea id="admin-rental-description" class="form-control" rows="4" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="admin-rental-image">Upload Image</label>
                    <input type="file" id="admin-rental-image" class="form-control" accept="image/*">
                </div>
                
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Add Rental Car</button>
            </form>
        </div>
    </div>

    <script>
        // =============================================
        // ENTERPRISE SECURITY CONFIGURATION
        // =============================================
        
        // Enhanced admin account with your secure password
        const adminAccount = {
            username: 'admin',
            password: 'Mymomis1ofherkind@.',
            email: 'agasluxedrive@gmail.com',
            twoFASecret: 'AGAS2025SECURE'
        };

        // Security configuration
        const SECURITY_CONFIG = {
            sessionTimeout: 15 * 60 * 1000, // 15 minutes
            twoFATimeout: 10 * 60 * 1000, // 10 minutes for 2FA code
            maxLoginAttempts: 5,
            lockoutTime: 30 * 60 * 1000 // 30 minutes lockout
        };

        // Enhanced data storage with encryption simulation
        let users = JSON.parse(localStorage.getItem('encrypted_users')) || [];
        let cars = JSON.parse(localStorage.getItem('encrypted_cars')) || [];
        let inquiries = JSON.parse(localStorage.getItem('encrypted_inquiries')) || [];
        let rentals = JSON.parse(localStorage.getItem('encrypted_rentals')) || [];
        let testimonials = JSON.parse(localStorage.getItem('encrypted_testimonials')) || [];
        let rentalFleet = JSON.parse(localStorage.getItem('encrypted_rentalFleet')) || [];
        let ratings = JSON.parse(localStorage.getItem('encrypted_ratings')) || [];
        let transactions = JSON.parse(localStorage.getItem('encrypted_transactions')) || [];
        let currentUser = JSON.parse(localStorage.getItem('encrypted_currentUser')) || null;
        let currentCarInquiry = null;
        let sessionTimer = null;
        let twoFACode = null;
        let twoFAExpiry = null;
        let loginAttempts = {};
        let selectedProfileType = '';

        // NEW FEATURES DATA
        let notifications = JSON.parse(localStorage.getItem('agas_notifications')) || [];
        let isDarkMode = localStorage.getItem('agas_dark_mode') === 'true';
        let aiChatMessages = JSON.parse(localStorage.getItem('agas_ai_chat')) || [
            { sender: 'bot', message: "Hello! I'm your AGAS AI Concierge. How can I assist you with luxury car purchases, rentals, or sales today?" }
        ];

        // Currency management
        let currentCurrency = 'kes';
        let exchangeRate = 115; // KES to USD

        // User preferences for AI recommendations
        let userPreferences = JSON.parse(localStorage.getItem('agas_user_preferences')) || {
            preferredBrands: [],
            priceRange: { min: 0, max: 50000000 },
            vehicleType: 'all',
            features: []
        };

        // Enhanced sample data with competitive pricing and correct images
        if (cars.length === 0) {
            cars = [
                {
                    id: 1,
                    make: 'Mercedes-Benz',
                    model: 'GLE 350d 4MATIC',
                    year: 2022,
                    price: 16800000,
                    mileage: 8500,
                    transmission: 'automatic',
                    fuel: 'diesel',
                    color: 'Selenite Grey',
                    condition: 'new',
                    description: 'AMG performance SUV with premium package, sport exhaust, and advanced driver assistance. Low mileage, one owner.',
                    images: ['https://api.media.mercedes-benz.com/jsonapi/image/deliver/2b727cd1-1851-4292-b48b-334c1f832bde/1024'],
                    verified: true,
                    sellerId: 1,
                    status: 'approved',
                    features: ['AMG Performance', 'Sport Exhaust', 'Premium Package', 'Panoramic Roof', 'Burmester Sound', 'AMG Dynamic Select'],
                    kycDocuments: {
                        logbook: 'https://via.placeholder.com/200x120?text=Logbook',
                        id: 'https://via.placeholder.com/200x120?text=ID+Copy',
                        insurance: 'https://via.placeholder.com/200x120?text=Insurance',
                        inspection: 'https://via.placeholder.com/200x120?text=Inspection'
                    }
                },
                {
                    id: 2,
                    make: 'Toyota',
                    model: 'Land Cruiser V8',
                    year: 2023,
                    price: 21500000,
                    mileage: 3500,
                    transmission: 'automatic',
                    fuel: 'diesel',
                    color: 'Pearl White',
                    condition: 'new',
                    description: 'Top-of-the-line V8 with all luxury features. KDSS, crawl control, and premium interior. Still under warranty.',
                    images: ['https://global.toyota/pages/news/images/2021/08/02/1330/20210802_01_20_s.jpg'],
                    verified: true,
                    sellerId: 1,
                    status: 'approved',
                    features: ['V8 Engine', 'KDSS', 'Crawl Control', 'Premium Interior', 'Multi-Terrain Monitor', 'Cooled Seats'],
                    kycDocuments: {
                        logbook: 'https://via.placeholder.com/200x120?text=Logbook',
                        id: 'https://via.placeholder.com/200x120?text=ID+Copy',
                        insurance: 'https://via.placeholder.com/200x120?text=Insurance',
                        inspection: 'https://via.placeholder.com/200x120?text=Inspection'
                    }
                },
                {
                    id: 3,
                    make: 'BMW',
                    model: 'X5 xDrive40i',
                    year: 2022,
                    price: 14200000,
                    mileage: 18500,
                    transmission: 'automatic',
                    fuel: 'petrol',
                    color: 'Phytonic Blue',
                    condition: 'used',
                    description: 'M Sport package with luxury seating, heads-up display, and premium entertainment system. Full service history.',
                    images: ['https://images.unsplash.com/photo-1555215695-3004980ad54e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80'],
                    verified: true,
                    sellerId: 1,
                    status: 'approved',
                    features: ['M Sport Package', 'Heads-up Display', 'Premium Package', 'Panoramic Roof', 'Wireless Charging', 'Ambient Lighting'],
                    kycDocuments: {
                        logbook: 'https://via.placeholder.com/200x120?text=Logbook',
                        id: 'https://via.placeholder.com/200x120?text=ID+Copy',
                        insurance: 'https://via.placeholder.com/200x120?text=Insurance',
                        inspection: 'https://via.placeholder.com/200x120?text=Inspection'
                    }
                },
                {
                    id: 4,
                    make: 'Range Rover',
                    model: 'Autobiography',
                    year: 2023,
                    price: 28500000,
                    mileage: 7500,
                    transmission: 'automatic',
                    fuel: 'diesel',
                    color: 'Santorini Black',
                    condition: 'new',
                    description: 'Top specification Autobiography model with executive seating, advanced terrain response, and premium audio system.',
                    images: ['https://media.production.jlrms.com/styles/hero_crop/s3/2025-08-04/image/21237d82-fb2d-49f9-8b5e-2a78b5c9b476/RRS_SV_Carbon_F34_16x9_8K_SH001_v2_PR.jpg?VersionId=xms9oy1hINgrZny5ygmAB_8oWxISUU4k&h=9ed48596&itok=MoCiWqRT'],
                    verified: true,
                    sellerId: 1,
                    status: 'approved',
                    features: ['Executive Seats', 'Terrain Response', 'Meridian Sound', 'Air Suspension', 'Massage Seats', 'Rear Entertainment'],
                    kycDocuments: {
                        logbook: 'https://via.placeholder.com/200x120?text=Logbook',
                        id: 'https://via.placeholder.com/200x120?text=ID+Copy',
                        insurance: 'https://via.placeholder.com/200x120?text=Insurance',
                        inspection: 'https://via.placeholder.com/200x120?text=Inspection'
                    }
                }
            ];
            localStorage.setItem('encrypted_cars', JSON.stringify(cars));
        }

        // Enhanced rental fleet with competitive pricing
        if (rentalFleet.length === 0) {
            rentalFleet = [
                {
                    id: 1,
                    make: 'Mercedes-Benz',
                    model: 'S-Class 2023',
                    type: 'Executive Sedan',
                    image: 'https://api.media.mercedes-benz.com/jsonapi/image/deliver/9181e1f8-01b1-4440-b994-57314de7b092/3_2_768',
                    dailyRate: 42000,
                    weeklyRate: 252000,
                    features: ['Chauffeur Option', 'Full Insurance', 'Airport Delivery', 'WiFi', 'Massage Seats', 'Panoramic Roof'],
                    available: true,
                    sellerId: 0, // Admin user
                    status: 'approved'
                },
                {
                    id: 2,
                    make: 'Range Rover',
                    model: 'Autobiography 2023',
                    type: 'Luxury SUV',
                    image: 'https://media.production.jlrms.com/styles/hero_crop/s3/2025-08-04/image/21237d82-fb2d-49f9-8b5e-2a78b5c9b476/RRS_SV_Carbon_F34_16x9_8K_SH001_v2_PR.jpg?VersionId=xms9oy1hINgrZny5ygmAB_8oWxISUU4k&h=9ed48596&itok=MoCiWqRT',
                    dailyRate: 52000,
                    weeklyRate: 312000,
                    features: ['7 Seats', 'Off-road Capable', 'Premium Sound', 'Massage Seats', 'Air Suspension', 'Terrain Response'],
                    available: true,
                    sellerId: 0,
                    status: 'approved'
                },
                {
                    id: 3,
                    make: 'BMW',
                    model: '7 Series 2023',
                    type: 'Luxury Sedan',
                    image: 'https://images.unsplash.com/photo-1555215695-3004980ad54e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
                    dailyRate: 38000,
                    weeklyRate: 228000,
                    features: ['Executive Interior', 'Night Vision', 'Massage Seats', 'B&W Sound', 'Gesture Control', 'Sky Lounge'],
                    available: true,
                    sellerId: 0,
                    status: 'approved'
                },
                {
                    id: 4,
                    make: 'Porsche',
                    model: 'Cayenne Turbo',
                    type: 'Performance SUV',
                    image: 'https://images.unsplash.com/photo-1503376780353-7e6692767b70?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
                    dailyRate: 65000,
                    weeklyRate: 390000,
                    features: ['Sport Chrono', 'Premium Package', 'Performance Tires', 'Carbon Interior', 'Adaptive Suspension', 'Sports Exhaust'],
                    available: true,
                    sellerId: 0,
                    status: 'approved'
                }
            ];
            localStorage.setItem('encrypted_rentalFleet', JSON.stringify(rentalFleet));
        }

        // Sample notifications
        if (notifications.length === 0) {
            notifications = [
                {
                    id: 1,
                    title: 'Welcome to AGAS LUXE DRIVE',
                    message: 'Your account has been successfully created. Start exploring luxury vehicles now.',
                    timestamp: new Date().toISOString(),
                    read: false,
                    type: 'info'
                },
                {
                    id: 2,
                    title: 'New Luxury Vehicle Available',
                    message: 'A 2023 Mercedes-Benz S-Class has been added to our rental fleet.',
                    timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                    read: false,
                    type: 'info'
                },
                {
                    id: 3,
                    title: 'Security Update',
                    message: 'Two-factor authentication has been enabled for your account.',
                    timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
                    read: true,
                    type: 'security'
                }
            ];
            localStorage.setItem('agas_notifications', JSON.stringify(notifications));
        }

        // =============================================
        // ENHANCED AI CHAT CONCIERGE
        // =============================================

        // Enhanced AI chat responses with contextual understanding
        function getAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Car buying intent
            if (lowerMessage.includes('buy') || lowerMessage.includes('purchase') || 
                lowerMessage.includes('looking for') || lowerMessage.includes('want a car') ||
                lowerMessage.includes('interested in') || lowerMessage.includes('need a car')) {
                return {
                    message: "I'd be happy to help you find the perfect luxury vehicle! We have a wide selection of verified luxury cars from brands like Mercedes-Benz, BMW, Range Rover, and more. Would you like me to:",
                    options: [
                        "Show available luxury vehicles",
                        "Help you filter by brand, price, or features",
                        "Explain our verification process",
                        "Schedule a test drive"
                    ]
                };
            }
            
            // Car selling intent
            if (lowerMessage.includes('sell') || lowerMessage.includes('list my car') || 
                lowerMessage.includes('want to sell') || lowerMessage.includes('selling my')) {
                return {
                    message: "Excellent! Listing your luxury vehicle with AGAS LUXE DRIVE ensures premium exposure to serious buyers. To get started:",
                    options: [
                        "Create a seller account",
                        "Learn about our verification requirements",
                        "See our commission structure",
                        "Schedule a vehicle inspection"
                    ]
                };
            }
            
            // Rental inquiries
            if (lowerMessage.includes('rent') || lowerMessage.includes('hire') || 
                lowerMessage.includes('short term') || lowerMessage.includes('temporary') ||
                lowerMessage.includes('rental') || lowerMessage.includes('lease')) {
                return {
                    message: "Our premium rental fleet offers luxury vehicles for any occasion. I can help you:",
                    options: [
                        "Browse available rental vehicles",
                        "Check rental rates and packages",
                        "Learn about insurance options",
                        "Make a booking reservation"
                    ]
                };
            }

            // Specific brand inquiries
            if (lowerMessage.includes('mercedes') || lowerMessage.includes('benz')) {
                return {
                    message: "Mercedes-Benz is one of our most popular luxury brands! We have various models including the S-Class, GLE, GLS, and AMG performance vehicles. Would you like to:",
                    options: [
                        "View Mercedes-Benz inventory",
                        "Compare Mercedes models",
                        "Learn about Mercedes maintenance",
                        "Schedule a Mercedes test drive"
                    ]
                };
            }

            if (lowerMessage.includes('bmw') || lowerMessage.includes('beemer') || lowerMessage.includes('bimmer')) {
                return {
                    message: "BMW offers exceptional driving dynamics and luxury. We have models from the 3 Series to the X7 SUV and M Performance lineup. Would you like to:",
                    options: [
                        "View BMW inventory",
                        "Explore M Performance models",
                        "Learn about BMW technology",
                        "Schedule a BMW test drive"
                    ]
                };
            }

            if (lowerMessage.includes('range rover') || lowerMessage.includes('land rover')) {
                return {
                    message: "Range Rover represents the pinnacle of luxury SUVs with exceptional capability. We have various models including the Velar, Sport, and Autobiography. Would you like to:",
                    options: [
                        "View Range Rover inventory",
                        "Learn about off-road capabilities",
                        "Compare Range Rover trims",
                        "Schedule a test drive"
                    ]
                };
            }

            // Pricing inquiries
            if (lowerMessage.includes('price') || lowerMessage.includes('cost') || 
                lowerMessage.includes('how much') || lowerMessage.includes('afford')) {
                return {
                    message: "Our luxury vehicles range from premium executive sedans to ultra-luxury models. Pricing depends on the brand, model, year, and features. Would you like to:",
                    options: [
                        "See vehicles in your budget",
                        "Learn about financing options",
                        "Compare different price ranges",
                        "Get a personalized recommendation"
                    ]
                };
            }

            // Verification inquiries
            if (lowerMessage.includes('verify') || lowerMessage.includes('trust') || 
                lowerMessage.includes('safe') || lowerMessage.includes('secure') ||
                lowerMessage.includes('authentic') || lowerMessage.includes('genuine')) {
                return {
                    message: "All vehicles on AGAS LUXE DRIVE undergo rigorous verification including document checks, mechanical inspections, and ownership verification. Would you like to:",
                    options: [
                        "Learn about our verification process",
                        "See verification requirements",
                        "Understand buyer protection",
                        "Contact our verification team"
                    ]
                };
            }

            // Test drive inquiries
            if (lowerMessage.includes('test drive') || lowerMessage.includes('drive') || 
                lowerMessage.includes('inspect') || lowerMessage.includes('see the car')) {
                return {
                    message: "We offer comprehensive test drives for all our luxury vehicles. Our concierge service can arrange a convenient time and location for you. Would you like to:",
                    options: [
                        "Schedule a test drive",
                        "Learn about test drive locations",
                        "See available time slots",
                        "Request a specific vehicle"
                    ]
                };
            }

            // Financing inquiries
            if (lowerMessage.includes('finance') || lowerMessage.includes('loan') || 
                lowerMessage.includes('payment') || lowerMessage.includes('installment') ||
                lowerMessage.includes('credit')) {
                return {
                    message: "We offer flexible financing options through our banking partners with competitive rates for qualified buyers. Would you like to:",
                    options: [
                        "Learn about financing options",
                        "Check eligibility requirements",
                        "Calculate monthly payments",
                        "Apply for pre-approval"
                    ]
                };
            }

            // Delivery inquiries
            if (lowerMessage.includes('deliver') || lowerMessage.includes('ship') || 
                lowerMessage.includes('transport') || lowerMessage.includes('location')) {
                return {
                    message: "We offer delivery services across East Africa with secure transportation for your luxury vehicle. Would you like to:",
                    options: [
                        "Learn about delivery options",
                        "Check delivery locations",
                        "Get a delivery quote",
                        "Schedule vehicle delivery"
                    ]
                };
            }
            
            // Default contextual response
            return {
                message: "I'm your AGAS AI Concierge. I can navigate the site, open contact or inquiry forms, and guide purchases, rentals, or sales. What would you like to do?",
                options: [
                    "Show available luxury vehicles",
                    "Browse rental fleet",
                    "View premium brands",
                    "Contact support",
                    "Generate reports"
                ]
            };
        }

        // Navigation helpers
        function revealSection(id) {
            const el = document.getElementById(id);
            if (!el) return false;
            el.style.display = '';
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            return true;
        }
        function goToSection(id) { return revealSection(id); }
        function openContact() {
            const ok = revealSection('contact-section');
            const form = document.getElementById('contact-form');
            if (form) form.scrollIntoView({ behavior: 'smooth' });
            return ok;
        }
        function openInquiryForCurrentCar() {
            if (typeof currentCarInquiry === 'number' && currentCarInquiry) {
                showInquiryModal(currentCarInquiry);
                return true;
            }
            return false;
        }
        function extractFiltersFromMessage(raw) {
            const m = raw.toLowerCase();
            let make = '';
            if (m.includes('mercedes') || m.includes('benz')) make = 'Mercedes-Benz';
            else if (m.includes('bmw')) make = 'BMW';
            else if (m.includes('range rover') || m.includes('land rover')) make = 'Range Rover';
            else if (m.includes('toyota')) make = 'Toyota';
            else if (m.includes('porsche')) make = 'Porsche';
            let priceMax = null;
            const match = m.match(/\$?\s*(\d+(?:\.\d+)?)\s*(k|m|million|thousand)?/);
            if (match) {
                const num = parseFloat(match[1]);
                const unit = match[2] || '';
                if (unit.startsWith('m')) priceMax = Math.round(num * 1000000);
                else if (unit && (unit.startsWith('k') || unit.startsWith('th'))) priceMax = Math.round(num * 1000);
                else priceMax = Math.round(num);
            }
            return { make, priceMax };
        }
        function applyAIListingsFilter(make, priceMax) {
            try {
                let list = cars.filter(car => car.status === 'approved');
                if (make) list = list.filter(car => String(car.make).toLowerCase().includes(make.toLowerCase()));
                if (priceMax) list = list.filter(car => Number(car.price) <= Number(priceMax));
                const allContainer = document.getElementById('all-car-listings');
                const featuredContainer = document.getElementById('car-listings');
                if (allContainer) {
                    allContainer.innerHTML = '';
                    list.forEach(car => { allContainer.appendChild(createCarCard(car, true)); });
                    goToSection('listings-section');
                } else if (featuredContainer) {
                    featuredContainer.innerHTML = '';
                    list.slice(0, 4).forEach(car => { featuredContainer.appendChild(createCarCard(car)); });
                    goToSection('featured-vehicles');
                }
                if (list.length > 0) showNotification(`Found ${list.length} matching vehicles.`, 'success');
                else showNotification('No matching vehicles found.', 'warning');
                return true;
            } catch (e) { return false; }
        }
        function performAIAction(rawMessage) {
            const m = rawMessage.toLowerCase();
            const f = extractFiltersFromMessage(rawMessage);
            if (f.make || f.priceMax) {
                return applyAIListingsFilter(f.make, f.priceMax);
            }
            if (m.includes('featured') || m.includes('available luxury') || m.includes('show vehicles')) {
                return goToSection('featured-vehicles');
            }
            if (m.includes('listings') || m.includes('inventory') || m.includes('all vehicles')) {
                return goToSection('listings-section');
            }
            if (m.includes('rental') || m.includes('rent') || m.includes('fleet')) {
                return goToSection('rentals-section');
            }
            if (m.includes('brand') || m.includes('brands') || m.includes('gallery')) {
                return goToSection('brands-section') || goToSection('brand-gallery-section');
            }
            if (m.includes('contact') || m.includes('support') || m.includes('help')) {
                return openContact();
            }
            if (m.includes('test drive') || m.includes('schedule') || m.includes('inspect')) {
                return openInquiryForCurrentCar() || goToSection('featured-vehicles');
            }
            if (m.includes('report')) {
                try { switchAdminTab('reports'); } catch (e) {}
                const admin = document.getElementById('admin-section');
                if (admin) admin.scrollIntoView({ behavior: 'smooth' });
                return true;
            }
            if (m.includes('dark') && m.includes('mode')) {
                try { toggleDarkMode(); return true; } catch (e) {}
            }
            return false;
        }

        // Enhanced AI chat functionality
        function sendAIMessage() {
            const input = document.getElementById('ai-chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            const userMessage = { sender: 'user', message };
            aiChatMessages.push(userMessage);
            localStorage.setItem('agas_ai_chat', JSON.stringify(aiChatMessages));
            loadAIChatMessages();
            
            // Clear input
            input.value = '';
            
            // Show typing indicator
            const messagesContainer = document.getElementById('ai-chat-messages');
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'ai-message bot';
            typingIndicator.id = 'typing-indicator';
            typingIndicator.innerHTML = '<div class="loading"></div> Thinking...';
            messagesContainer.appendChild(typingIndicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Simulated thinking delay for UX, then act/respond
            setTimeout(() => {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) indicator.remove();
                const acted = performAIAction(message);
                if (acted) {
                    const confirm = { sender: 'bot', message: 'Navigating and opening requested section.', options: null };
                    aiChatMessages.push(confirm);
                    localStorage.setItem('agas_ai_chat', JSON.stringify(aiChatMessages));
                    loadAIChatMessages();
                    return;
                }
                const aiResponse = getAIResponse(message);
                const botMessage = { sender: 'bot', message: aiResponse.message, options: aiResponse.options };
                aiChatMessages.push(botMessage);
                localStorage.setItem('agas_ai_chat', JSON.stringify(aiChatMessages));
                loadAIChatMessages();
            }, 800);
        }

        // Enhanced chat message display with options
        function loadAIChatMessages() {
            const messagesContainer = document.getElementById('ai-chat-messages');
            if (!messagesContainer) return;
            
            messagesContainer.innerHTML = '';
            
            aiChatMessages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.className = `ai-message ${msg.sender}`;
                messageElement.textContent = msg.message;
                
                // Add options if available
                if (msg.options && msg.sender === 'bot') {
                    const optionsContainer = document.createElement('div');
                    optionsContainer.className = 'ai-chat-options';
                    
                    msg.options.forEach(option => {
                        const optionElement = document.createElement('div');
                        optionElement.className = 'ai-chat-option';
                        optionElement.textContent = option;
                        optionElement.onclick = function() {
                            if (!performAIAction(option)) {
                                document.getElementById('ai-chat-input').value = option;
                                sendAIMessage();
                            }
                        };
                        optionsContainer.appendChild(optionElement);
                    });
                    
                    messageElement.appendChild(optionsContainer);
                }
                
                messagesContainer.appendChild(messageElement);
            });
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // =============================================
        // EMAILJS INTEGRATION WITH YOUR CONFIGURATION
        // =============================================

        // Initialize EmailJS with your Public Key
        (function() {
            emailjs.init("C8eqfETcWvBibFK4l");
            console.log("EmailJS initialized successfully");
        })();

        // EmailJS Configuration with your details
        const EMAILJS_CONFIG = {
            serviceId: 'service_venw737',
            otpTemplateId: 'template_au1x1tg',
            resetTemplateId: 'template_kvc5v1i',
            welcomeTemplateId: 'template_au1x1tg',
            contactTemplateId: 'template_contact_form',
            inquiryTemplateId: 'template_inquiry_form',
            bulkTemplateId: 'template_bulk_notifications',
            fromEmail: 'agasluxedrive@gmail.com',
            fromName: 'AGAS LUXE DRIVE'
        };

        // Notification System
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto-remove after duration
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }

        // Enhanced EmailJS Functions with error handling
        async function sendOTPEmail(email, otpCode) {
            try {
                const templateParams = {
                    to_email: email,
                    from_name: EMAILJS_CONFIG.fromName,
                    otp_code: otpCode,
                    company_name: 'AGAS LUXE DRIVE',
                    support_email: EMAILJS_CONFIG.fromEmail,
                    timestamp: new Date().toLocaleString()
                };

                console.log('Sending OTP email to:', email);
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.otpTemplateId,
                    templateParams
                );

                console.log('OTP Email sent successfully:', response);
                return { success: true, message: 'OTP sent successfully' };
            } catch (error) {
                console.error('Failed to send OTP email:', error);
                showNotification('Failed to send OTP email. Please try again later.', 'error');
                return { success: false, message: 'Failed to send OTP email' };
            }
        }

        async function sendPasswordResetEmail(email, resetToken) {
            try {
                const resetLink = `${window.location.origin}${window.location.pathname}#reset-password?token=${resetToken}`;
                
                const templateParams = {
                    to_email: email,
                    from_name: EMAILJS_CONFIG.fromName,
                    reset_link: resetLink,
                    company_name: 'AGAS LUXE DRIVE',
                    support_email: EMAILJS_CONFIG.fromEmail,
                    expiry_time: '24 hours',
                    timestamp: new Date().toLocaleString()
                };

                console.log('Sending password reset email to:', email);
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.resetTemplateId,
                    templateParams
                );

                console.log('Password reset email sent successfully:', response);
                return { success: true, message: 'Password reset email sent successfully' };
            } catch (error) {
                console.error('Failed to send password reset email:', error);
                showNotification('Password reset service temporarily unavailable. Please try again later or contact support.', 'error');
                return { success: false, message: 'Failed to send password reset email' };
            }
        }

        async function sendContactEmail(name, email, subject, message) {
            try {
                const templateParams = {
                    from_name: name,
                    from_email: email,
                    subject: subject,
                    message: message,
                    to_email: EMAILJS_CONFIG.fromEmail,
                    company_name: 'AGAS LUXE DRIVE',
                    timestamp: new Date().toLocaleString()
                };

                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.contactTemplateId,
                    templateParams
                );

                console.log('Contact email sent successfully:', response);
                return { success: true, message: 'Message sent successfully' };
            } catch (error) {
                console.error('Failed to send contact email:', error);
                return { success: false, message: 'Failed to send message. Please try again later.' };
            }
        }

        async function sendInquiryEmail(carId, name, email, phone, message) {
            try {
                const car = cars.find(c => c.id === carId);
                const templateParams = {
                    car_name: `${car.make} ${car.model} ${car.year}`,
                    car_price: formatPrice(car.price),
                    inquirer_name: name,
                    inquirer_email: email,
                    inquirer_phone: phone,
                    message: message,
                    to_email: EMAILJS_CONFIG.fromEmail,
                    company_name: 'AGAS LUXE DRIVE',
                    timestamp: new Date().toLocaleString()
                };

                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.inquiryTemplateId,
                    templateParams
                );

                console.log('Inquiry email sent successfully:', response);
                return { success: true, message: 'Inquiry sent successfully' };
            } catch (error) {
                console.error('Failed to send inquiry email:', error);
                return { success: false, message: 'Failed to send inquiry. Please try again later.' };
            }
        }

        async function sendWelcomeEmail(email, userName, userType) {
            try {
                const templateParams = {
                    to_email: email,
                    from_name: EMAILJS_CONFIG.fromName,
                    user_name: userName,
                    user_type: userType,
                    company_name: 'AGAS LUXE DRIVE',
                    support_email: EMAILJS_CONFIG.fromEmail,
                    login_link: window.location.origin,
                    timestamp: new Date().toLocaleString()
                };

                // Using OTP template as welcome template for now
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.welcomeTemplateId,
                    templateParams
                );

                console.log('Welcome email sent successfully:', response);
                return { success: true, message: 'Welcome email sent successfully' };
            } catch (error) {
                console.error('Failed to send welcome email:', error);
                // Non-critical failure, so we don't alert the user
                return { success: false, message: 'Failed to send welcome email' };
            }
        }

        async function sendBulkNotificationEmail(email, subject, message) {
            try {
                const templateParams = {
                    to_email: email,
                    from_name: EMAILJS_CONFIG.fromName,
                    subject: subject,
                    message: message,
                    company_name: 'AGAS LUXE DRIVE',
                    support_email: EMAILJS_CONFIG.fromEmail,
                    timestamp: new Date().toLocaleString()
                };

                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.bulkTemplateId,
                    templateParams
                );

                console.log('Bulk notification sent successfully to:', email);
                return { success: true, message: 'Bulk notification sent successfully' };
            } catch (error) {
                console.error('Failed to send bulk notification to:', email, error);
                return { success: false, message: 'Failed to send bulk notification' };
            }
        }

        // Enhanced security functions with EmailJS integration
        async function generateTwoFACode(email) {
            twoFACode = Math.floor(100000 + Math.random() * 900000).toString();
            twoFAExpiry = Date.now() + SECURITY_CONFIG.twoFATimeout;
            
            console.log(`Generating 2FA code for: ${email}`);
            
            // Send OTP via EmailJS
            const result = await sendOTPEmail(email, twoFACode);
            
            if (result.success) {
                showNotification(`2FA code has been sent to ${email}. Please check your inbox.`, 'success');
            } else {
                // Fallback message already handled in sendOTPEmail
                console.log(`2FA Code for ${email}: ${twoFACode}`);
            }
            
            return twoFACode;
        }

        // Enhanced password reset with EmailJS
        async function requestPasswordReset(email) {
            // Generate reset token
            const resetToken = Math.random().toString(36).substring(2) + Date.now().toString(36);
            const resetTokenExpiry = Date.now() + (24 * 60 * 60 * 1000); // 24 hours
            
            // Find user
            const user = users.find(u => u.email === email);
            if (user) {
                // Store reset token
                user.resetToken = resetToken;
                user.resetTokenExpiry = resetTokenExpiry;
                localStorage.setItem('encrypted_users', JSON.stringify(users));
                
                // Send reset email via EmailJS
                const result = await sendPasswordResetEmail(email, resetToken);
                
                if (result.success) {
                    showNotification(`Password reset link has been sent to ${email}. Please check your inbox.`, 'success');
                } else {
                    showNotification('Password reset service is temporarily unavailable. Please try again later or contact support.', 'error');
                }
                
                return result.success;
            } else {
                showNotification('No account found with that email address.', 'error');
                return false;
            }
        }

        // Enhanced user registration with welcome email
        async function sendUserWelcomeEmail(user) {
            const userName = user.fname || user.companyName || 'Valued Customer';
            const userType = user.role === 'buyer' ? 'Buyer' : 'Seller';
            
            const result = await sendWelcomeEmail(user.email, userName, userType);
            
            if (!result.success) {
                console.warn('Welcome email failed to send, but account was created successfully');
            }
        }

        // Bulk notification function
        async function sendBulkNotificationsToUsers(subject, message) {
            showNotification('Sending notifications to all users...', 'info');
            
            let successCount = 0;
            let errorCount = 0;
            
            for (const user of users) {
                const result = await sendBulkNotificationEmail(user.email, subject, message);
                if (result.success) {
                    successCount++;
                } else {
                    errorCount++;
                }
                // Small delay to avoid hitting rate limits
                await new Promise(resolve => setTimeout(resolve, 500));
                notifications.push({
                    id: notifications.length + 1,
                    title: subject,
                    message: message,
                    timestamp: new Date().toISOString(),
                    read: false,
                    type: 'announcement'
                });
            }
            localStorage.setItem('agas_notifications', JSON.stringify(notifications));
            updateNotificationBadges();
            
            showNotification(`Bulk notifications sent successfully to ${successCount} users. ${errorCount} failed.`, 'success');
        }

        // Verify 2FA code
        function verifyTwoFactor() {
            const digits = document.querySelectorAll('.twofa-digit');
            const enteredCode = Array.from(digits).map(d => d.value).join('');
            
            if (enteredCode === twoFACode && Date.now() < twoFAExpiry) {
                closeModal('twofa-modal');
                completeAdminLogin();
            } else {
                showNotification('Invalid or expired 2FA code. Please try again.', 'error');
                // Regenerate and resend code
                if (currentUser && currentUser.email) {
                    generateTwoFACode(currentUser.email);
                }
            }
        }

        // Move to next 2FA input
        function moveToNext(current, nextIndex) {
            if (current.value.length === 1) {
                const next = document.querySelectorAll('.twofa-digit')[nextIndex];
                if (next) next.focus();
            }
        }

        // Resend 2FA code with EmailJS
        async function resendTwoFACode() {
            const target = (currentUser && currentUser.role === 'admin') ? adminAccount.email : (currentUser && currentUser.email ? currentUser.email : adminAccount.email);
            await generateTwoFACode(target);
            showNotification('New 2FA code sent to your email.', 'success');
        }

        // Session management
        function startSessionTimer() {
            clearTimeout(sessionTimer);
            const timerElement = document.getElementById('session-time');
            const timerDisplay = document.getElementById('session-timer');
            
            if (currentUser) {
                timerDisplay.style.display = 'block';
                let timeLeft = SECURITY_CONFIG.sessionTimeout / 1000;
                
                const updateTimer = () => {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (timeLeft <= 0) {
                        logout();
                        showNotification('Session expired for security. Please login again.', 'warning');
                    } else {
                        timeLeft--;
                        sessionTimer = setTimeout(updateTimer, 1000);
                    }
                };
                
                updateTimer();
            } else {
                timerDisplay.style.display = 'none';
            }
        }

        // Reset session timer on user activity
        function resetSessionTimer() {
            if (currentUser) {
                startSessionTimer();
            }
        }

        // Admin password reset info
        function showAdminPasswordResetInfo() {
            showNotification('For admin password reset, please contact system administrator or use the enterprise recovery process.', 'info');
        }

        // Enhanced login with security features
        async function handleAdminLogin(e) {
            e.preventDefault();
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // Check login attempts
            const attemptKey = `${username}_${new Date().toDateString()}`;
            loginAttempts[attemptKey] = (loginAttempts[attemptKey] || 0) + 1;
            
            if (loginAttempts[attemptKey] > SECURITY_CONFIG.maxLoginAttempts) {
                showNotification('Too many login attempts. Account temporarily locked for security.', 'error');
                return;
            }
            
            if (username === adminAccount.username && password === adminAccount.password) {
                // Generate and require 2FA using EmailJS
                await generateTwoFACode(adminAccount.email);
                closeModal('admin-login-modal');
                showTwoFAModal();
            } else {
                showNotification(`Invalid credentials. ${SECURITY_CONFIG.maxLoginAttempts - loginAttempts[attemptKey]} attempts remaining.`, 'error');
            }
        }

        function completeAdminLogin() {
            currentUser = {
                id: 0,
                fname: 'Enterprise',
                lname: 'Admin',
                email: adminAccount.email,
                role: 'admin',
                permissions: ['all']
            };
            
            localStorage.setItem('encrypted_currentUser', JSON.stringify(currentUser));
            startSessionTimer();
            showAdminPanel();
            updateUserInterface();
            showNotification('Enterprise Admin login successful! Security protocols active.', 'success');
            
            // Add notification for admin
            addNotification('Admin Login', 'You have successfully logged in as administrator.', 'security');
        }

        // Enhanced user authentication
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                if (user.role === 'admin') {
                    showNotification('Please use Enterprise Admin Login for secure access.', 'warning');
                    closeModal('login-modal');
                    showAdminLoginModal();
                    return;
                }
                currentUser = user;
                localStorage.setItem('encrypted_currentUser', JSON.stringify(currentUser));
                closeModal('login-modal');
                startSessionTimer();
                updateUserInterface();
                
                // Add notification for user
                addNotification('Welcome Back', 'You have successfully logged in to your account.', 'info');
                
                if (user.role === 'admin') {
                    showAdminPanel();
                } else if (user.role === 'seller') {
                    showSellerDashboard();
                } else {
                    showBuyerDashboard();
                }
                
                showNotification('Secure login successful! Session timer activated.', 'success');
            } else {
                showNotification('Invalid email or password. Please try again.', 'error');
            }
        }

        // Update UI based on user role
        function updateUserInterface() {
            const authButtons = document.getElementById('auth-buttons');
            const userMenu = document.getElementById('user-menu');
            const userAvatar = document.getElementById('user-avatar');
            const userName = document.getElementById('user-name');
            const userBadges = document.getElementById('user-badges');
            const adminDashboardBtn = document.getElementById('admin-dashboard-btn');
            
            if (currentUser) {
                authButtons.style.display = 'none';
                userMenu.style.display = 'flex';
                
                // Show admin dashboard button if user is admin
                if (currentUser.role === 'admin') {
                    adminDashboardBtn.style.display = 'block';
                } else {
                    adminDashboardBtn.style.display = 'none';
                }
                
                // Set user info
                if (currentUser.role === 'admin') {
                    userAvatar.textContent = 'A';
                    userName.textContent = 'Admin';
                    userBadges.innerHTML = '<span class="user-badge badge-corporate">Enterprise Admin</span>';
                } else if (currentUser.role === 'seller') {
                    userAvatar.textContent = currentUser.companyName ? currentUser.companyName.charAt(0) : 'S';
                    userName.textContent = currentUser.companyName || 'Seller';
                    
                    // Add seller badges
                    let badgeHTML = '';
                    if (currentUser.verifiedSeller) {
                        badgeHTML += '<span class="user-badge badge-verified-seller">Verified Seller</span>';
                    }
                    
                    // Add seller level badge
                    const salesCount = currentUser.salesCount || 0;
                    if (salesCount >= 50) {
                        badgeHTML += '<span class="user-badge badge-platinum">Platinum Seller</span>';
                    } else if (salesCount >= 20) {
                        badgeHTML += '<span class="user-badge badge-gold">Gold Seller</span>';
                    } else if (salesCount >= 10) {
                        badgeHTML += '<span class="user-badge badge-silver">Silver Seller</span>';
                    } else if (salesCount >= 5) {
                        badgeHTML += '<span class="user-badge badge-bronze">Bronze Seller</span>';
                    } else {
                        badgeHTML += '<span class="user-badge badge-new">New Seller</span>';
                    }
                    
                    userBadges.innerHTML = badgeHTML;
                } else {
                    userAvatar.textContent = currentUser.fname ? currentUser.fname.charAt(0) : 'B';
                    userName.textContent = currentUser.fname || 'Buyer';
                    
                    // Add buyer badges
                    let badgeHTML = '';
                    if (currentUser.verifiedBuyer) {
                        badgeHTML += '<span class="user-badge badge-verified-buyer">Verified Buyer</span>';
                    }
                    
                    // Add buyer level based on purchases
                    const purchaseCount = currentUser.purchaseCount || 0;
                    if (purchaseCount >= 10) {
                        badgeHTML += '<span class="user-badge badge-platinum">Platinum Buyer</span>';
                    } else if (purchaseCount >= 5) {
                        badgeHTML += '<span class="user-badge badge-gold">Gold Buyer</span>';
                    } else if (purchaseCount >= 2) {
                        badgeHTML += '<span class="user-badge badge-silver">Silver Buyer</span>';
                    } else if (purchaseCount >= 1) {
                        badgeHTML += '<span class="user-badge badge-bronze">Bronze Buyer</span>';
                    }
                    
                    userBadges.innerHTML = badgeHTML;
                }
            } else {
                authButtons.style.display = 'flex';
                userMenu.style.display = 'none';
                adminDashboardBtn.style.display = 'none';
            }
        }

        // Profile selection
        function showProfileSelection() {
            if (currentUser) {
                if (currentUser.role === 'admin') {
                    showAdminPanel();
                } else if (currentUser.role === 'seller') {
                    showSellerDashboard();
                } else {
                    showBuyerDashboard();
                }
                return;
            }
            document.getElementById('profile-selection-modal').style.display = 'flex';
        }

        function selectProfile(profileType) {
            selectedProfileType = profileType;
            closeModal('profile-selection-modal');
            
            if (profileType === 'buyer') {
                showBuyerSignupModal();
            } else if (profileType === 'seller') {
                showSellerSignupModal();
            }
        }

        // Buyer signup with welcome email
        async function handleBuyerSignup(e) {
            e.preventDefault();
            const fname = document.getElementById('buyer-signup-fname').value;
            const lname = document.getElementById('buyer-signup-lname').value;
            const email = document.getElementById('buyer-signup-email').value;
            const phone = document.getElementById('buyer-signup-phone').value;
            const country = document.getElementById('buyer-signup-country').value;
            const idNumber = document.getElementById('buyer-signup-id').value;
            const idDocInput = document.getElementById('buyer-id-document');
            const idDocumentUrl = (idDocInput && idDocInput.files && idDocInput.files[0]) ? URL.createObjectURL(idDocInput.files[0]) : '';
            const password = document.getElementById('buyer-signup-password').value;
            const confirm = document.getElementById('buyer-signup-confirm').value;
            
            if (password !== confirm) {
                showNotification('Passwords do not match. Please try again.', 'error');
                return;
            }
            
            // Check if user already exists
            if (users.find(u => u.email === email)) {
                showNotification('An account with this email already exists. Please login instead.', 'error');
                return;
            }
            
            const newUser = {
                id: users.length + 1,
                fname,
                lname,
                email,
                phone,
                country,
                idNumber,
                idDocumentUrl,
                password,
                role: 'buyer',
                address: '',
                verifiedBuyer: false,
                purchaseCount: 0,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('encrypted_users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('encrypted_currentUser', JSON.stringify(currentUser));
            
            // Send welcome email
            await sendUserWelcomeEmail(newUser);
            
            // Add welcome notification
            addNotification('Welcome to AGAS LUXE DRIVE', 'Your buyer account has been successfully created. Start exploring luxury vehicles now!', 'info');
            
            closeModal('buyer-signup-modal');
            showBuyerDashboard();
            updateUserInterface();
            
            showNotification('Buyer account created successfully! Welcome email sent.', 'success');
        }

        // Seller signup with welcome email
        async function handleSellerSignup(e) {
            e.preventDefault();
            const companyName = document.getElementById('seller-company-name').value;
            const regNumber = document.getElementById('seller-reg-number').value;
            const fname = document.getElementById('seller-signup-fname').value;
            const lname = document.getElementById('seller-signup-lname').value;
            const email = document.getElementById('seller-signup-email').value;
            const phone = document.getElementById('seller-signup-phone').value;
            const country = document.getElementById('seller-signup-country').value;
            const idNumber = document.getElementById('seller-signup-id').value;
            const password = document.getElementById('seller-signup-password').value;
            const confirm = document.getElementById('seller-signup-confirm').value;
            
            if (password !== confirm) {
                showNotification('Passwords do not match. Please try again.', 'error');
                return;
            }
            
            // Check if user already exists
            if (users.find(u => u.email === email)) {
                showNotification('An account with this email already exists. Please login instead.', 'error');
                return;
            }
            
            const newUser = {
                id: users.length + 1,
                companyName,
                regNumber,
                fname,
                lname,
                email,
                phone,
                country,
                idNumber,
                password,
                role: 'seller',
                address: '',
                companyDescription: '',
                verifiedSeller: false,
                salesCount: 0,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('encrypted_users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('encrypted_currentUser', JSON.stringify(currentUser));
            
            // Send welcome email
            await sendUserWelcomeEmail(newUser);
            
            // Add welcome notification
            addNotification('Welcome to AGAS LUXE DRIVE', 'Your seller account has been successfully created. Start listing your luxury vehicles!', 'info');
            
            closeModal('seller-signup-modal');
            showSellerDashboard();
            updateUserInterface();
            
            showNotification('Seller account created successfully! Welcome email sent.', 'success');
        }

        // Add event listeners for session reset
        document.addEventListener('click', resetSessionTimer);
        document.addEventListener('keypress', resetSessionTimer);
        document.addEventListener('scroll', resetSessionTimer);
        document.addEventListener('mousemove', resetSessionTimer);

        // =============================================
        // CORE APPLICATION FUNCTIONS
        // =============================================

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadCarListings();
            loadRentalFleet();
            setupEventListeners();
            updateUserInterface();
            
            // Initialize new features
            initializeDarkMode();
            initializeNotificationCenter();
            initializeAIChat();
            loadAIRecommendations();
            ensureAudiRS3Listing();
            sanitizeTestimonials();
            const logoInput = document.getElementById('company-logo-input');
            if (logoInput) {
                logoInput.addEventListener('change', function(e) {
                    const file = e.target.files && e.target.files[0];
                    if (file) {
                        const url = URL.createObjectURL(file);
                        localStorage.setItem('companyLogoUrl', url);
                        showNotification('Company logo updated.', 'success');
                    }
                });
            }
            
            // Check URL for password reset token
            if (window.location.hash.includes('reset-password?token=')) {
                const token = window.location.hash.split('reset-password?token=')[1];
                document.getElementById('reset-token').value = token;
                showPasswordResetConfirmModal();
            }
            
            // Check if user is already logged in
            if (currentUser) {
                startSessionTimer();
                if (currentUser.role === 'admin') {
                    showAdminPanel();
                } else if (currentUser.role === 'seller') {
                    showSellerDashboard();
                } else {
                    showBuyerDashboard();
                }
            }
        });

        function sanitizeTestimonials() {
            if (!Array.isArray(testimonials)) return;
            let changed = false;
            const dupIndex = testimonials.findIndex(t => typeof t.userName === 'string' && /michael\.?\s*k/i.test(t.userName));
            const anotherDup = testimonials.findIndex((t, i) => i !== dupIndex && typeof t.userName === 'string' && /michael\.?\s*k/i.test(t.userName));
            if (dupIndex !== -1 && anotherDup !== -1) {
                testimonials[anotherDup].userName = 'Alex G';
                testimonials[anotherDup].title = testimonials[anotherDup].title || 'Delighted with AGAS experience';
                testimonials[anotherDup].content = 'I had specific questions about performance and warranty on a performance sedan. The AGAS team didnt rush methey walked me through specs, financing, and delivery timing with real transparency. The car arrived exactly as described, and the followup after purchase felt genuinely thoughtful. Id trust them again for my next upgrade.';
                changed = true;
            }
            const genericPhrases = [/great service/i, /highly recommend/i, /very good/i, /nice/i, /amazing company/i, /fast and reliable/i];
            testimonials.forEach(t => {
                const isGeneric = (typeof t.content === 'string' && (t.content.length < 80 || genericPhrases.some(rx => rx.test(t.content))));
                if (isGeneric) {
                    t.content = 'From first inquiry to handover, the process felt professional and calm. Pricing was clear, inspection reports matched the car, and delivery was on the promised date. I appreciated the quick responses and how small detailslike plate transfer and insurancewere handled without me chasing. This felt like a premium experience.';
                    changed = true;
                }
            });
            if (changed) {
                localStorage.setItem('encrypted_testimonials', JSON.stringify(testimonials));
                loadTestimonialApprovals();
            }
        }

        function setupEventListeners() {
            // Form submissions
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('buyer-signup-form').addEventListener('submit', handleBuyerSignup);
            document.getElementById('seller-signup-form').addEventListener('submit', handleSellerSignup);
            document.getElementById('admin-login-form').addEventListener('submit', handleAdminLogin);
            document.getElementById('add-car-form').addEventListener('submit', handleAddCar);
            document.getElementById('add-rental-form').addEventListener('submit', handleAddRental);
            document.getElementById('admin-add-car-form').addEventListener('submit', handleAdminAddCar);
            document.getElementById('admin-add-rental-form').addEventListener('submit', handleAdminAddRental);
            document.getElementById('contact-form').addEventListener('submit', handleContact);
            document.getElementById('inquiry-form').addEventListener('submit', handleInquiry);
            document.getElementById('testimonial-form').addEventListener('submit', handleTestimonial);
            document.getElementById('filter-form').addEventListener('submit', handleFilter);
            document.getElementById('listings-filter-form').addEventListener('submit', handleListingsFilter);
            document.getElementById('password-reset-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('reset-email').value;
                requestPasswordReset(email);
                closeModal('password-reset-modal');
            });
            document.getElementById('password-reset-confirm-form').addEventListener('submit', handlePasswordResetConfirm);
            document.getElementById('rental-form').addEventListener('submit', handleRentalBooking);
            document.getElementById('buyer-profile-form').addEventListener('submit', handleBuyerProfileUpdate);
            document.getElementById('buyer-password-form').addEventListener('submit', handleBuyerPasswordUpdate);
            document.getElementById('seller-profile-form').addEventListener('submit', handleSellerProfileUpdate);
            
            // Mobile menu
            document.querySelector('.mobile-menu-btn').addEventListener('click', toggleMobileMenu);
            
            // New features event listeners
            document.getElementById('dark-mode-toggle').addEventListener('click', toggleDarkMode);
            document.getElementById('dark-mode-toggle-user').addEventListener('click', toggleDarkMode);
            document.getElementById('notification-bell').addEventListener('click', toggleNotificationCenter);
            document.getElementById('notification-bell-user').addEventListener('click', toggleNotificationCenter);
            document.getElementById('ai-chat-toggle').addEventListener('click', toggleAIChat);
            document.getElementById('ai-chat-close').addEventListener('click', toggleAIChat);
            document.getElementById('ai-chat-send').addEventListener('click', sendAIMessage);
            document.getElementById('ai-chat-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendAIMessage();
                }
            });
            
            // Enhanced search functionality
            document.getElementById('search-input').addEventListener('input', handleSearch);
            
            // Close notification center when clicking outside
            document.addEventListener('click', function(e) {
                const notificationCenter = document.getElementById('notification-center');
                const notificationBell = document.getElementById('notification-bell');
                const notificationBellUser = document.getElementById('notification-bell-user');
                
                if (notificationCenter.classList.contains('active') && 
                    !notificationCenter.contains(e.target) && 
                    !notificationBell.contains(e.target) &&
                    !notificationBellUser.contains(e.target)) {
                    notificationCenter.classList.remove('active');
                }
                
                // Close AI chat when clicking outside
                const aiChatContainer = document.getElementById('ai-chat-container');
                const aiChatToggle = document.getElementById('ai-chat-toggle');
                
                if (aiChatContainer.classList.contains('active') && 
                    !aiChatContainer.contains(e.target) && 
                    !aiChatToggle.contains(e.target)) {
                    aiChatContainer.classList.remove('active');
                }
            });
        }

        // Password reset confirmation
        function handlePasswordResetConfirm(e) {
            e.preventDefault();
            const token = document.getElementById('reset-token').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;
            
            if (newPassword !== confirmPassword) {
                showNotification('Passwords do not match. Please try again.', 'error');
                return;
            }
            
            // Find user with matching reset token
            const user = users.find(u => u.resetToken === token && u.resetTokenExpiry > Date.now());
            
            if (user) {
                // Update password
                user.password = newPassword;
                user.resetToken = null;
                user.resetTokenExpiry = null;
                
                localStorage.setItem('encrypted_users', JSON.stringify(users));
                
                closeModal('password-reset-confirm-modal');
                showNotification('Password reset successfully! You can now login with your new password.', 'success');
                
                // Clear URL hash
                window.location.hash = '';
            } else {
                showNotification('Invalid or expired reset token. Please request a new password reset.', 'error');
            }
        }

        function showPasswordResetConfirmModal() {
            document.getElementById('password-reset-confirm-modal').style.display = 'flex';
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');
            
            // Auto-close when clicking a link (for mobile)
            if (navLinks.classList.contains('active')) {
                const links = navLinks.querySelectorAll('a');
                links.forEach(link => {
                    link.addEventListener('click', () => {
                        navLinks.classList.remove('active');
                    });
                });
            }
        }

        // Section navigation
        function showSection(section) {
            // Hide all sections
            document.getElementById('home-section').style.display = 'none';
            document.getElementById('listings-section').style.display = 'none';
            document.getElementById('brand-gallery-section').style.display = 'none';
            document.getElementById('about-section').style.display = 'none';
            document.getElementById('contact-section').style.display = 'none';
            document.getElementById('buyer-dashboard').style.display = 'none';
            document.getElementById('seller-dashboard').style.display = 'none';
            document.getElementById('admin-section').style.display = 'none';
            
            // Show selected section
            if (section === 'home') {
                document.getElementById('home-section').style.display = 'block';
            } else if (section === 'listings') {
                document.getElementById('listings-section').style.display = 'block';
                loadCarListings();
            } else if (section === 'rentals') {
                document.getElementById('home-section').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('rentals-section').scrollIntoView({ behavior: 'smooth' });
                }, 100);
            } else if (section === 'about') {
                document.getElementById('about-section').style.display = 'block';
            } else if (section === 'contact') {
                document.getElementById('contact-section').style.display = 'block';
            }
            
            // Close mobile menu if open
            document.querySelector('.nav-links').classList.remove('active');
        }

        // Brand gallery function
        function showBrandGallery() {
            // Hide all sections
            document.getElementById('home-section').style.display = 'none';
            document.getElementById('listings-section').style.display = 'none';
            document.getElementById('about-section').style.display = 'none';
            document.getElementById('contact-section').style.display = 'none';
            document.getElementById('buyer-dashboard').style.display = 'none';
            document.getElementById('seller-dashboard').style.display = 'none';
            document.getElementById('admin-section').style.display = 'none';
            
            // Show brand gallery
            document.getElementById('brand-gallery-section').style.display = 'block';
            
            // Close mobile menu if open
            document.querySelector('.nav-links').classList.remove('active');
        }

        // Filter by brand function
        function filterByBrand(brand) {
            showSection('home');
            setTimeout(() => {
                document.getElementById('make').value = brand;
                document.getElementById('filter-form').dispatchEvent(new Event('submit'));
                document.getElementById('featured-vehicles').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Corporate services modal
        function showCorporateServicesModal() {
            document.getElementById('corporate-services-modal').style.display = 'flex';
        }

        // Modal functions
        function showLoginModal() {
            if (currentUser) {
                if (currentUser.role === 'admin') {
                    showAdminPanel();
                } else if (currentUser.role === 'seller') {
                    showSellerDashboard();
                } else {
                    showBuyerDashboard();
                }
                return;
            }
            document.getElementById('login-modal').style.display = 'flex';
        }

        function showBuyerSignupModal() {
            document.getElementById('buyer-signup-modal').style.display = 'flex';
        }

        function showSellerSignupModal() {
            document.getElementById('seller-signup-modal').style.display = 'flex';
        }

        function showAdminLoginModal() {
            document.getElementById('admin-login-modal').style.display = 'flex';
        }

        function showTwoFAModal() {
            document.getElementById('twofa-modal').style.display = 'flex';
            // Auto-focus first digit
            setTimeout(() => {
                document.querySelector('.twofa-digit').focus();
            }, 100);
        }

        function showPasswordResetModal() {
            document.getElementById('password-reset-modal').style.display = 'flex';
        }

        function showInquiryModal(carId) {
            currentCarInquiry = carId;
            document.getElementById('inquiry-modal').style.display = 'flex';
        }

        function showRentalModal() {
            document.getElementById('rental-modal').style.display = 'flex';
        }

        function showAdminAddCarModal() {
            document.getElementById('admin-add-car-modal').style.display = 'flex';
        }

        function showAdminAddRentalModal() {
            document.getElementById('admin-add-rental-modal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Show car details modal
        function showCarDetailModal(carId) {
            const car = cars.find(c => c.id === carId);
            if (!car) return;
            
            document.getElementById('car-detail-title').textContent = `${car.make} ${car.model} ${car.year}`;
            
            const content = document.getElementById('car-detail-content');
            content.innerHTML = `
                <div class="car-detail-images">
                    <img src="${car.images[0]}" alt="${car.make} ${car.model}" class="car-detail-main-image" id="car-detail-main-image">
                    <div class="car-detail-thumbnails">
                        ${car.images.map((img, index) => `
                            <img src="${img}" alt="Thumbnail ${index + 1}" class="car-detail-thumbnail" onclick="changeMainImage('${img}')">
                        `).join('')}
                    </div>
                </div>
                
                <div class="car-detail-specs">
                    <div class="car-detail-spec">
                        <div class="car-detail-spec-label">Price</div>
                        <div class="car-detail-spec-value">${formatPrice(car.price)}</div>
                    </div>
                    <div class="car-detail-spec">
                        <div class="car-detail-spec-label">Mileage</div>
                        <div class="car-detail-spec-value">${car.mileage.toLocaleString()} km</div>
                    </div>
                    <div class="car-detail-spec">
                        <div class="car-detail-spec-label">Transmission</div>
                        <div class="car-detail-spec-value">${car.transmission}</div>
                    </div>
                    <div class="car-detail-spec">
                        <div class="car-detail-spec-label">Fuel Type</div>
                        <div class="car-detail-spec-value">${car.fuel}</div>
                    </div>
                    <div class="car-detail-spec">
                        <div class="car-detail-spec-label">Color</div>
                        <div class="car-detail-spec-value">${car.color}</div>
                    </div>
                    <div class="car-detail-spec">
                        <div class="car-detail-spec-label">Condition</div>
                        <div class="car-detail-spec-value">${car.condition}</div>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <h4>Description</h4>
                    <p>${car.description}</p>
                </div>
                
                <div style="margin: 20px 0;">
                    <h4>Features</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        ${car.features.map(feature => `
                            <span style="background: var(--light); padding: 8px 15px; border-radius: 20px; font-size: 0.9rem;">${feature}</span>
                        `).join('')}
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button class="btn" onclick="showInquiryModal(${car.id}); closeModal('car-detail-modal')">Make Inquiry</button>
                    <button class="btn btn-outline" onclick="closeModal('car-detail-modal')">Close</button>
                </div>
            `;
            
            document.getElementById('car-detail-modal').style.display = 'flex';
        }

        // Quick view modal for cars
        function showQuickViewModal(carId) {
            const car = cars.find(c => c.id === carId);
            if (!car) return;
            
            document.getElementById('quick-view-title').textContent = `${car.make} ${car.model} ${car.year}`;
            
            const content = document.getElementById('quick-view-content');
            content.innerHTML = `
                <div>
                    <img src="${car.images[0]}" alt="${car.make} ${car.model}" style="width: 100%; height: 200px; object-fit: cover; border-radius: var(--radius);">
                </div>
                <div>
                    <div class="car-price">${formatPrice(car.price)}</div>
                    <div class="car-specs">
                        <span><i class="fas fa-tachometer-alt"></i> ${car.mileage.toLocaleString()} km</span>
                        <span><i class="fas fa-gas-pump"></i> ${car.fuel}</span>
                        <span><i class="fas fa-car"></i> ${car.transmission}</span>
                    </div>
                    <p>${car.description.substring(0, 150)}...</p>
                    <div style="margin: 15px 0;">
                        ${car.features.slice(0, 3).map(feature => 
                            `<span style="display: inline-block; background: var(--gray-light); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; margin: 2px;">${feature}</span>`
                        ).join('')}
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn" style="flex: 1;" onclick="showCarDetailModal(${car.id}); closeModal('quick-view-modal')">View Details</button>
                        <button class="btn btn-outline" style="flex: 1;" onclick="showInquiryModal(${car.id}); closeModal('quick-view-modal')">Inquire</button>
                    </div>
                </div>
            `;
            
            document.getElementById('quick-view-modal').style.display = 'flex';
        }

        function changeMainImage(src) {
            document.getElementById('car-detail-main-image').src = src;
        }

        // Currency functions
        function setCurrency(currency) {
            currentCurrency = currency;
            document.querySelectorAll('.currency-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadCarListings();
        }

        function setRentalCurrency(currency) {
            currentCurrency = currency;
            document.querySelectorAll('.currency-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadRentalFleet();
        }

        function formatPrice(price) {
            if (currentCurrency === 'kes') {
                return `KES ${price.toLocaleString()}`;
            } else {
                return `$${Math.round(price / exchangeRate).toLocaleString()}`;
            }
        }

        // Car listings
        function loadCarListings() {
            const featuredContainer = document.getElementById('car-listings');
            const allContainer = document.getElementById('all-car-listings');
            
            // Clear existing content
            if (featuredContainer) featuredContainer.innerHTML = '';
            if (allContainer) allContainer.innerHTML = '';
            
            // Filter verified cars for featured section
            const verifiedCars = cars.filter(car => car.verified && car.status === 'approved');
            const allCars = cars.filter(car => car.status === 'approved');
            
            // Load featured cars (limit to 4)
            if (featuredContainer) {
                verifiedCars.slice(0, 4).forEach(car => {
                    featuredContainer.appendChild(createCarCard(car));
                });
            }
            
            // Load all cars
            if (allContainer) {
                allCars.forEach(car => {
                    allContainer.appendChild(createCarCard(car, true));
                });
            }
        }

        function createCarCard(car, showInquire = false) {
            const card = document.createElement('div');
            card.className = 'car-card';
            card.innerHTML = `
                <div class="car-badge">${car.verified ? 'VERIFIED' : 'PENDING'}</div>
                <img src="${car.images[0]}" alt="${car.make} ${car.model}" class="car-image">
                <div class="car-details">
                    <div class="car-price">${formatPrice(car.price)}</div>
                    <h3 class="car-title">${car.make} ${car.model} ${car.year}</h3>
                    <div class="car-specs">
                        <span><i class="fas fa-tachometer-alt"></i> ${car.mileage.toLocaleString()} km</span>
                        <span><i class="fas fa-gas-pump"></i> ${car.fuel}</span>
                        <span><i class="fas fa-car"></i> ${car.transmission}</span>
                    </div>
                    ${car.verified ? 
                        '<div class="verified-badge"><i class="fas fa-shield-alt"></i> AGAS Verified</div>' : 
                        '<div class="pending-badge"><i class="fas fa-clock"></i> Pending Verification</div>'
                    }
                    <p>${car.description.substring(0, 100)}...</p>
                    <div style="margin: 10px 0;">
                        ${car.features ? car.features.slice(0, 3).map(feature => 
                            `<span style="display: inline-block; background: var(--gray-light); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; margin: 2px;">${feature}</span>`
                        ).join('') : ''}
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" style="flex: 1;" onclick="showQuickViewModal(${car.id})">Quick View</button>
                        ${showInquire ? 
                            `<button class="btn" style="flex: 1;" onclick="showInquiryModal(${car.id})">Inquire</button>` :
                            `<button class="btn" style="flex: 1;" onclick="showCarDetailModal(${car.id})">Details</button>`
                        }
                    </div>
                </div>
            `;
            return card;
        }

        // Rental fleet
        function loadRentalFleet() {
            const container = document.getElementById('rental-listings');
            if (!container) return;
            
            container.innerHTML = '';
            
            rentalFleet.forEach(rental => {
                const dailyRate = currentCurrency === 'kes' ? 
                    `KES ${rental.dailyRate.toLocaleString()}` : 
                    `$${Math.round(rental.dailyRate / exchangeRate)}`;
                
                const weeklyRate = currentCurrency === 'kes' ? 
                    `KES ${rental.weeklyRate.toLocaleString()}` : 
                    `$${Math.round(rental.weeklyRate / exchangeRate)}`;
                
                const rentalCard = document.createElement('div');
                rentalCard.className = 'rental-card';
                rentalCard.innerHTML = `
                    <div class="rental-badge">${rental.available ? 'AVAILABLE' : 'BOOKED'}</div>
                    <img src="${rental.image}" alt="${rental.make} ${rental.model}" class="rental-image">
                    <div class="rental-details">
                        <h3>${rental.make} ${rental.model}</h3>
                        <p style="color: var(--gray); margin-bottom: 15px;">${rental.type}</p>
                        <div class="rental-price">
                            ${dailyRate} <span class="price-unit">/ day</span>
                        </div>
                        <div style="color: var(--gray); margin-bottom: 15px;">
                            ${weeklyRate} <span class="price-unit">/ week</span>
                        </div>
                        <ul style="list-style: none; margin-bottom: 20px;">
                            ${rental.features.map(feature => `<li style="margin-bottom: 5px;"><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> ${feature}</li>`).join('')}
                        </ul>
                        <button class="btn" style="width: 100%;" onclick="showRentalModal()" ${!rental.available ? 'disabled' : ''}>${rental.available ? 'Book Securely' : 'Currently Booked'}</button>
                    </div>
                `;
                container.appendChild(rentalCard);
            });
        }

        // Form handlers
        function handleContact(e) {
            e.preventDefault();
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const subject = document.getElementById('contact-subject').value;
            const message = document.getElementById('contact-message').value;
            
            // Send email via EmailJS
            sendContactEmail(name, email, subject, message)
                .then(result => {
                    if (result.success) {
                        showNotification(`Thank you for your message, ${name}! We will get back to you soon.`, 'success');
                        document.getElementById('contact-form').reset();
                    } else {
                        showNotification(result.message, 'error');
                    }
                });
        }

        function handleInquiry(e) {
            e.preventDefault();
            const name = document.getElementById('inquiry-name').value;
            const email = document.getElementById('inquiry-email').value;
            const phone = document.getElementById('inquiry-phone').value;
            const message = document.getElementById('inquiry-message').value;
            
            const car = cars.find(c => c.id === currentCarInquiry);
            
            const inquiry = {
                id: inquiries.length + 1,
                carId: currentCarInquiry,
                carName: `${car.make} ${car.model} ${car.year}`,
                name,
                email,
                phone,
                message,
                date: new Date().toISOString()
            };
            inquiries.push(inquiry);
            localStorage.setItem('encrypted_inquiries', JSON.stringify(inquiries));
            
            sendInquiryEmail(currentCarInquiry, name, email, phone, message)
                .then(result => {
                    closeModal('inquiry-modal');
                    if (result.success) {
                        showNotification('Your inquiry has been sent successfully! The seller will contact you soon.', 'success');
                    } else {
                        showNotification('Your inquiry has been recorded. Email delivery failed, support will reach you.', 'warning');
                    }
                })
                .catch(() => {
                    closeModal('inquiry-modal');
                    showNotification('Your inquiry has been recorded. Email service is unavailable.', 'warning');
                });
        }

        function handleAddCar(e) {
            e.preventDefault();
            if (!currentUser) {
                showNotification('Please login to list a car.', 'error');
                return;
            }
            
            const make = document.getElementById('car-make').value;
            const model = document.getElementById('car-model').value;
            const year = parseInt(document.getElementById('car-year').value);
            const price = parseInt(document.getElementById('car-price').value);
            const mileage = parseInt(document.getElementById('car-mileage').value);
            const transmission = document.getElementById('car-transmission').value;
            const fuel = document.getElementById('car-fuel').value;
            const color = document.getElementById('car-color').value;
            const condition = document.getElementById('car-condition').value;
            const vin = document.getElementById('car-vin').value;
            const description = document.getElementById('car-description').value;
            
            const imagesInput = document.getElementById('car-images');
            const documentsInput = document.getElementById('car-documents');
            const uploadedImages = (imagesInput && imagesInput.files && imagesInput.files.length > 0) ? [URL.createObjectURL(imagesInput.files[0])] : ['https://images.unsplash.com/photo-1549399542-7e3f8b79c341?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80'];
            const docs = (documentsInput && documentsInput.files) ? documentsInput.files : [];
            const logbookUrl = docs[0] ? URL.createObjectURL(docs[0]) : 'https://via.placeholder.com/200x120?text=Logbook';
            const idUrl = docs[1] ? URL.createObjectURL(docs[1]) : 'https://via.placeholder.com/200x120?text=ID+Copy';
            const insuranceUrl = docs[2] ? URL.createObjectURL(docs[2]) : 'https://via.placeholder.com/200x120?text=Insurance';
            const inspectionUrl = docs[3] ? URL.createObjectURL(docs[3]) : 'https://via.placeholder.com/200x120?text=Inspection';

            const newCar = {
                id: cars.length + 1,
                make,
                model,
                year,
                price,
                mileage,
                transmission,
                fuel,
                color,
                condition,
                vin,
                description,
                images: uploadedImages,
                verified: false,
                sellerId: currentUser.id,
                status: 'pending',
                features: ['Standard Features'],
                kycDocuments: {
                    logbook: logbookUrl,
                    id: idUrl,
                    insurance: insuranceUrl,
                    inspection: inspectionUrl
                }
            };
            
            cars.push(newCar);
            localStorage.setItem('encrypted_cars', JSON.stringify(cars));
            
            // Reset form
            document.getElementById('add-car-form').reset();
            
            // Reload user listings
            loadSellerListings();
            
            // Add notification
            addNotification('Car Listing Submitted', 'Your car listing has been submitted and is pending admin verification.', 'info');
            
            showNotification('Car listing submitted successfully! It is now pending admin verification.', 'success');
        }

        function handleAddRental(e) {
            e.preventDefault();
            if (!currentUser) {
                showNotification('Please login to add a rental car.', 'error');
                return;
            }
            
            const make = document.getElementById('rental-make').value;
            const model = document.getElementById('rental-model').value;
            const year = parseInt(document.getElementById('rental-year').value);
            const type = document.getElementById('rental-type').value;
            const dailyRate = parseInt(document.getElementById('rental-daily-rate').value);
            const weeklyRate = parseInt(document.getElementById('rental-weekly-rate').value);
            const features = document.getElementById('rental-features').value.split(',').map(f => f.trim());
            const description = document.getElementById('rental-description').value;
            
            const newRental = {
                id: rentalFleet.length + 1,
                make,
                model,
                year,
                type,
                image: 'https://images.unsplash.com/photo-1549399542-7e3f8b79c341?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
                dailyRate,
                weeklyRate,
                features,
                description,
                available: true,
                sellerId: currentUser.id,
                status: 'pending'
            };
            
            rentalFleet.push(newRental);
            localStorage.setItem('encrypted_rentalFleet', JSON.stringify(rentalFleet));
            
            // Reset form
            document.getElementById('add-rental-form').reset();
            
            // Reload seller rentals
            loadSellerRentals();
            
            // Add notification
            addNotification('Rental Listing Submitted', 'Your rental car listing has been submitted successfully.', 'info');
            
            showNotification('Rental car listing submitted successfully!', 'success');
        }

        function handleAdminAddCar(e) {
            e.preventDefault();
            const make = document.getElementById('admin-car-make').value;
            const model = document.getElementById('admin-car-model').value;
            const year = parseInt(document.getElementById('admin-car-year').value);
            const price = parseInt(document.getElementById('admin-car-price').value);
            const condition = document.getElementById('admin-car-condition').value;
            const status = document.getElementById('admin-car-status').value;
            const description = document.getElementById('admin-car-description').value;
            const adminImagesInput = document.getElementById('admin-car-images');
            const adminUploadedImages = (adminImagesInput && adminImagesInput.files && adminImagesInput.files.length > 0) ? [URL.createObjectURL(adminImagesInput.files[0])] : ['https://images.unsplash.com/photo-1549399542-7e3f8b79c341?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80'];
            
            const newCar = {
                id: cars.length + 1,
                make,
                model,
                year,
                price,
                mileage: 0,
                transmission: 'automatic',
                fuel: 'petrol',
                color: 'Black',
                condition,
                description,
                images: adminUploadedImages,
                verified: status === 'approved',
                sellerId: 0, // Admin user
                status: status,
                features: ['Standard Features'],
                kycDocuments: {
                    logbook: 'https://via.placeholder.com/200x120?text=Logbook',
                    id: 'https://via.placeholder.com/200x120?text=ID+Copy',
                    insurance: 'https://via.placeholder.com/200x120?text=Insurance',
                    inspection: 'https://via.placeholder.com/200x120?text=Inspection'
                }
            };
            
            cars.push(newCar);
            localStorage.setItem('encrypted_cars', JSON.stringify(cars));
            
            // Reset form
            document.getElementById('admin-add-car-form').reset();
            
            // Reload listings
            loadCarListings();
            loadPendingListings();
            loadVerifiedListings();
            
            showNotification('Car added successfully!', 'success');
            closeModal('admin-add-car-modal');
        }

        function handleAdminAddRental(e) {
            e.preventDefault();
            const make = document.getElementById('admin-rental-make').value;
            const model = document.getElementById('admin-rental-model').value;
            const year = parseInt(document.getElementById('admin-rental-year').value);
            const type = document.getElementById('admin-rental-type').value;
            const dailyRate = parseInt(document.getElementById('admin-rental-daily-rate').value);
            const weeklyRate = parseInt(document.getElementById('admin-rental-weekly-rate').value);
            const features = document.getElementById('admin-rental-features').value.split(',').map(f => f.trim());
            const description = document.getElementById('admin-rental-description').value;
            const rentalImageInput = document.getElementById('admin-rental-image');
            const rentalImage = (rentalImageInput && rentalImageInput.files && rentalImageInput.files[0]) ? URL.createObjectURL(rentalImageInput.files[0]) : 'https://images.unsplash.com/photo-1549399542-7e3f8b79c341?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80';
            
            const newRental = {
                id: rentalFleet.length + 1,
                make,
                model,
                year,
                type,
                image: rentalImage,
                dailyRate,
                weeklyRate,
                features,
                description,
                available: true,
                sellerId: 0,
                status: 'approved'
            };
            
            rentalFleet.push(newRental);
            localStorage.setItem('encrypted_rentalFleet', JSON.stringify(rentalFleet));
            
            // Reset form
            document.getElementById('admin-add-rental-form').reset();
            
            // Reload rentals
            loadRentalFleet();
            loadRentalManagement();
            
            showNotification('Rental car added successfully!', 'success');
            closeModal('admin-add-rental-modal');
        }

        function handleTestimonial(e) {
            e.preventDefault();
            const title = document.getElementById('testimonial-title').value;
            const content = document.getElementById('testimonial-content').value;
            
            const testimonial = {
                id: testimonials.length + 1,
                userId: currentUser.id,
                userName: `${currentUser.fname} ${currentUser.lname}`,
                title,
                content,
                date: new Date().toISOString(),
                approved: false
            };
            
            testimonials.push(testimonial);
            localStorage.setItem('encrypted_testimonials', JSON.stringify(testimonials));
            
            document.getElementById('testimonial-form').reset();
            loadBuyerTestimonials();
            
            // Add notification
            addNotification('Testimonial Submitted', 'Thank you for your testimonial! It will be reviewed before publishing.', 'info');
            
            showNotification('Thank you for your testimonial! It will be reviewed before publishing.', 'success');
        }

        function handleRentalBooking(e) {
            e.preventDefault();
            const startDate = document.getElementById('rental-start').value;
            const endDate = document.getElementById('rental-end').value;
            const location = document.getElementById('rental-location').value;
            const insurance = document.getElementById('rental-insurance').value;
            
            const rental = {
                id: rentals.length + 1,
                userId: currentUser.id,
                userName: `${currentUser.fname} ${currentUser.lname}`,
                startDate,
                endDate,
                location,
                insurance,
                status: 'pending',
                date: new Date().toISOString()
            };
            
            rentals.push(rental);
            localStorage.setItem('encrypted_rentals', JSON.stringify(rentals));
            
            closeModal('rental-modal');
            loadBuyerRentals();
            
            // Add notification
            addNotification('Rental Booking Submitted', `Your rental booking for ${startDate} to ${endDate} has been submitted. Our team will contact you to confirm.`, 'info');
            
            showNotification(`Thank you for your rental booking!\n\nDates: ${startDate} to ${endDate}\nLocation: ${location}\nInsurance: ${insurance}\n\nOur team will contact you to confirm your booking.`, 'success');
        }

        function handleFilter(e) {
            e.preventDefault();
            // Show loading message
            showNotification('Searching for cars with your criteria...', 'info');
            
            // Simulate search delay
            setTimeout(() => {
                // Get filter values
                const make = document.getElementById('make').value;
                const model = document.getElementById('model').value;
                const year = document.getElementById('year').value;
                const price = document.getElementById('price').value;
                
                // Filter cars based on criteria
                let filteredCars = cars.filter(car => car.verified && car.status === 'approved');
                
                if (make) {
                    filteredCars = filteredCars.filter(car => car.make.toLowerCase().includes(make.toLowerCase()));
                }
                
                if (model) {
                    filteredCars = filteredCars.filter(car => car.model.toLowerCase().includes(model.toLowerCase()));
                }
                
                if (year) {
                    filteredCars = filteredCars.filter(car => car.year == year);
                }
                
                if (price) {
                    filteredCars = filteredCars.filter(car => car.price <= parseInt(price));
                }
                
                // Update the car listings
                const featuredContainer = document.getElementById('car-listings');
                if (featuredContainer) {
                    featuredContainer.innerHTML = '';
                    filteredCars.slice(0, 4).forEach(car => {
                        featuredContainer.appendChild(createCarCard(car));
                    });
                }
                
                if (filteredCars.length === 0) {
                    showNotification('No cars found matching your criteria. Please try different filters.', 'warning');
                } else {
                    showNotification(`Found ${filteredCars.length} cars matching your criteria!`, 'success');
                }
            }, 1000);
        }

        function handleListingsFilter(e) {
            e.preventDefault();
            // Show loading message
            showNotification('Searching for cars with your criteria...', 'info');
            
            // Simulate search delay
            setTimeout(() => {
                // Get filter values
                const make = document.getElementById('listings-make').value;
                const model = document.getElementById('listings-model').value;
                const year = document.getElementById('listings-year').value;
                const price = document.getElementById('listings-price').value;
                
                // Filter cars based on criteria
                let filteredCars = cars.filter(car => car.status === 'approved');
                
                if (make) {
                    filteredCars = filteredCars.filter(car => car.make.toLowerCase().includes(make.toLowerCase()));
                }
                
                if (model) {
                    filteredCars = filteredCars.filter(car => car.model.toLowerCase().includes(model.toLowerCase()));
                }
                
                if (year) {
                    filteredCars = filteredCars.filter(car => car.year == year);
                }
                
                if (price) {
                    filteredCars = filteredCars.filter(car => car.price <= parseInt(price));
                }
                
                // Update the car listings
                const allContainer = document.getElementById('all-car-listings');
                if (allContainer) {
                    allContainer.innerHTML = '';
                    filteredCars.forEach(car => {
                        allContainer.appendChild(createCarCard(car, true));
                    });
                }
                
                if (filteredCars.length === 0) {
                    showNotification('No cars found matching your criteria. Please try different filters.', 'warning');
                } else {
                    showNotification(`Found ${filteredCars.length} cars matching your criteria!`, 'success');
                }
            }, 1000);
        }

        function handleBuyerProfileUpdate(e) {
            e.preventDefault();
            const fname = document.getElementById('buyer-fname').value;
            const lname = document.getElementById('buyer-lname').value;
            const email = document.getElementById('buyer-email').value;
            const phone = document.getElementById('buyer-phone').value;
            const country = document.getElementById('buyer-country').value;
            const idNumber = document.getElementById('buyer-id').value;
            const address = document.getElementById('buyer-address').value;
            
            // Update user data
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].fname = fname;
                users[userIndex].lname = lname;
                users[userIndex].email = email;
                users[userIndex].phone = phone;
                users[userIndex].country = country;
                users[userIndex].idNumber = idNumber;
                users[userIndex].address = address;
                
                localStorage.setItem('encrypted_users', JSON.stringify(users));
                currentUser = users[userIndex];
                localStorage.setItem('encrypted_currentUser', JSON.stringify(currentUser));
                
                updateUserInterface();
                showNotification('Profile updated successfully!', 'success');
            }
        }

        function handleBuyerPasswordUpdate(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('buyer-current-password').value;
            const newPassword = document.getElementById('buyer-new-password').value;
            const confirmPassword = document.getElementById('buyer-confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match.', 'error');
                return;
            }
            
            // Verify current password
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1 && users[userIndex].password === currentPassword) {
                users[userIndex].password = newPassword;
                localStorage.setItem('encrypted_users', JSON.stringify(users));
                
                document.getElementById('buyer-password-form').reset();
                showNotification('Password updated successfully!', 'success');
            } else {
                showNotification('Current password is incorrect.', 'error');
            }
        }

        function handleSellerProfileUpdate(e) {
            e.preventDefault();
            const companyName = document.getElementById('company-name').value;
            const regNumber = document.getElementById('company-reg').value;
            const fname = document.getElementById('seller-fname').value;
            const lname = document.getElementById('seller-lname').value;
            const email = document.getElementById('seller-email').value;
            const phone = document.getElementById('seller-phone').value;
            const country = document.getElementById('seller-country').value;
            const idNumber = document.getElementById('seller-id').value;
            const address = document.getElementById('seller-address').value;
            const companyDescription = document.getElementById('company-description').value;
            
            // Update user data
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].companyName = companyName;
                users[userIndex].regNumber = regNumber;
                users[userIndex].fname = fname;
                users[userIndex].lname = lname;
                users[userIndex].email = email;
                users[userIndex].phone = phone;
                users[userIndex].country = country;
                users[userIndex].idNumber = idNumber;
                users[userIndex].address = address;
                users[userIndex].companyDescription = companyDescription;
                
                localStorage.setItem('encrypted_users', JSON.stringify(users));
                currentUser = users[userIndex];
                localStorage.setItem('encrypted_currentUser', JSON.stringify(currentUser));
                
                updateUserInterface();
                showNotification('Company profile updated successfully!', 'success');
            }
        }

        // Dashboard functions
        function showBuyerDashboard() {
            // Hide all sections
            document.getElementById('home-section').style.display = 'none';
            document.getElementById('listings-section').style.display = 'none';
            document.getElementById('brand-gallery-section').style.display = 'none';
            document.getElementById('about-section').style.display = 'none';
            document.getElementById('contact-section').style.display = 'none';
            document.getElementById('seller-dashboard').style.display = 'none';
            document.getElementById('admin-section').style.display = 'none';
            
            // Show dashboard
            document.getElementById('buyer-dashboard').style.display = 'block';
            
            // Load buyer data
            loadBuyerInquiries();
            loadBuyerRentals();
            loadBuyerTestimonials();
            loadBuyerRatings();
            populateBuyerProfile();
        }

        function showSellerDashboard() {
            // Hide all sections
            document.getElementById('home-section').style.display = 'none';
            document.getElementById('listings-section').style.display = 'none';
            document.getElementById('brand-gallery-section').style.display = 'none';
            document.getElementById('about-section').style.display = 'none';
            document.getElementById('contact-section').style.display = 'none';
            document.getElementById('buyer-dashboard').style.display = 'none';
            document.getElementById('admin-section').style.display = 'none';
            
            // Show dashboard
            document.getElementById('seller-dashboard').style.display = 'block';
            
            // Load seller data
            loadSellerListings();
            loadSellerRentals();
            loadSellerInquiries();
            loadSellerRatings();
            populateSellerProfile();
        }

        function showAdminPanel() {
            // Hide all sections
            document.getElementById('home-section').style.display = 'none';
            document.getElementById('listings-section').style.display = 'none';
            document.getElementById('brand-gallery-section').style.display = 'none';
            document.getElementById('about-section').style.display = 'none';
            document.getElementById('contact-section').style.display = 'none';
            document.getElementById('buyer-dashboard').style.display = 'none';
            document.getElementById('seller-dashboard').style.display = 'none';
            
            // Show admin panel
            document.getElementById('admin-section').style.display = 'block';
            
            // Load admin data
            loadPendingListings();
            loadVerifiedListings();
            loadRentalManagement();
            loadAdminCommunications();
            loadUserManagement();
            loadTestimonialApprovals();
            updateAdminStats();
        }

        function populateBuyerProfile() {
            if (!currentUser) return;
            
            document.getElementById('buyer-fname').value = currentUser.fname || '';
            document.getElementById('buyer-lname').value = currentUser.lname || '';
            document.getElementById('buyer-email').value = currentUser.email || '';
            document.getElementById('buyer-phone').value = currentUser.phone || '';
            document.getElementById('buyer-country').value = currentUser.country || '';
            document.getElementById('buyer-id').value = currentUser.idNumber || '';
            document.getElementById('buyer-address').value = currentUser.address || '';
        }

        function populateSellerProfile() {
            if (!currentUser) return;
            
            document.getElementById('company-name').value = currentUser.companyName || '';
            document.getElementById('company-reg').value = currentUser.regNumber || '';
            document.getElementById('seller-fname').value = currentUser.fname || '';
            document.getElementById('seller-lname').value = currentUser.lname || '';
            document.getElementById('seller-email').value = currentUser.email || '';
            document.getElementById('seller-phone').value = currentUser.phone || '';
            document.getElementById('seller-country').value = currentUser.country || '';
            document.getElementById('seller-id').value = currentUser.idNumber || '';
            document.getElementById('seller-address').value = currentUser.address || '';
            document.getElementById('company-description').value = currentUser.companyDescription || '';
        }

        function loadBuyerInquiries() {
            if (!currentUser) return;
            
            const container = document.getElementById('buyer-inquiries-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            const buyerInquiries = inquiries.filter(inquiry => inquiry.email === currentUser.email);
            
            // Update stats
            document.getElementById('buyer-inquiries').textContent = buyerInquiries.length;
            
            if (buyerInquiries.length === 0) {
                container.innerHTML = '<p>You have no inquiries yet.</p>';
                return;
            }
            
            buyerInquiries.forEach(inquiry => {
                const inquiryItem = document.createElement('div');
                inquiryItem.className = 'listing-item';
                inquiryItem.innerHTML = `
                    <div class="listing-info">
                        <h4>${inquiry.carName}</h4>
                        <p><strong>Sent:</strong> ${new Date(inquiry.date).toLocaleDateString()}</p>
                        <p><strong>Message:</strong> ${inquiry.message}</p>
                    </div>
                `;
                container.appendChild(inquiryItem);
            });
        }

        function loadBuyerRentals() {
            if (!currentUser) return;
            
            const container = document.getElementById('buyer-rentals-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            const buyerRentals = rentals.filter(rental => rental.userId === currentUser.id);
            
            // Update stats
            document.getElementById('buyer-rentals').textContent = buyerRentals.length;
            
            if (buyerRentals.length === 0) {
                container.innerHTML = '<p>You have no rental bookings yet.</p>';
                return;
            }
            
            buyerRentals.forEach(rental => {
                const rentalItem = document.createElement('div');
                rentalItem.className = 'listing-item';
                rentalItem.innerHTML = `
                    <div class="listing-info">
                        <h4>Booking #${rental.id}</h4>
                        <p><strong>Dates:</strong> ${rental.startDate} to ${rental.endDate}</p>
                        <p><strong>Location:</strong> ${rental.location}</p>
                        <p><strong>Insurance:</strong> ${rental.insurance}</p>
                        <p><strong>Status:</strong> <span class="rental-status ${rental.status === 'approved' ? 'status-approved' : rental.status === 'rejected' ? 'status-rejected' : 'status-pending'}">${rental.status.toUpperCase()}</span></p>
                    </div>
                `;
                container.appendChild(rentalItem);
            });
        }

        function loadBuyerTestimonials() {
            if (!currentUser) return;
            
            const container = document.getElementById('buyer-testimonials-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            const buyerTestimonials = testimonials.filter(testimonial => testimonial.userId === currentUser.id);
            
            // Update stats
            document.getElementById('buyer-testimonials').textContent = buyerTestimonials.length;
            
            if (buyerTestimonials.length === 0) {
                container.innerHTML = '<p>You have no testimonials yet.</p>';
                return;
            }
            
            buyerTestimonials.forEach(testimonial => {
                const testimonialItem = document.createElement('div');
                testimonialItem.className = 'listing-item';
                testimonialItem.innerHTML = `
                    <div class="listing-info">
                        <h4>${testimonial.title}</h4>
                        <p>${testimonial.content}</p>
                        <p><small>${new Date(testimonial.date).toLocaleDateString()} - ${testimonial.approved ? 'Published' : 'Pending Approval'}</small></p>
                    </div>
                `;
                container.appendChild(testimonialItem);
            });
        }

        function loadBuyerRatings() {
            if (!currentUser) return;
            
            const container = document.getElementById('buyer-ratings-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            const buyerRatings = ratings.filter(rating => rating.fromUserId === currentUser.id);
            
            // Update stats
            document.getElementById('buyer-ratings').textContent = buyerRatings.length;
            
            if (buyerRatings.length === 0) {
                container.innerHTML = '<p>You have not given any ratings yet.</p>';
                return;
            }
            
            buyerRatings.forEach(rating => {
                const ratingItem = document.createElement('div');
                ratingItem.className = 'listing-item';
                ratingItem.innerHTML = `
                    <div class="listing-info">
                        <h4>Rating for ${rating.toUserName}</h4>
                        <div class="rating-stars">
                            ${Array(5).fill().map((_, i) => 
                                `<span class="star ${i < rating.rating ? 'filled' : ''}"></span>`
                            ).join('')}
                            <span>(${rating.rating}.0)</span>
                        </div>
                        <p>${rating.comment}</p>
                        <p><small>${new Date(rating.date).toLocaleDateString()}</small></p>
                    </div>
                `;
                container.appendChild(ratingItem);
            });
        }

        function loadSellerListings() {
            if (!currentUser) return;
            
            const container = document.getElementById('seller-listings-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            const sellerCars = cars.filter(car => car.sellerId === currentUser.id);
            
            // Update stats
            document.getElementById('seller-listings').textContent = sellerCars.length;
            document.getElementById('seller-sales').textContent = sellerCars.filter(car => car.status === 'sold').length;
            
            if (sellerCars.length === 0) {
                container.innerHTML = '<p>You have no car listings yet.</p>';
                return;
            }
            
            sellerCars.forEach(car => {
                const listing = document.createElement('div');
                listing.className = 'listing-item';
                listing.innerHTML = `
                    <div class="listing-info">
                        <h4>${car.make} ${car.model} ${car.year} - ${formatPrice(car.price)}</h4>
                        <p>Status: ${car.verified ? 'Verified' : 'Pending Verification'}</p>
                        <p>Condition: ${car.condition}</p>
                    </div>
                    <div class="listing-actions">
                        ${!car.verified ? '<button class="btn btn-outline">Edit</button>' : ''}
                        <button class="btn btn-danger" onclick="deleteCar(${car.id})">Delete</button>
                    </div>
                `;
                container.appendChild(listing);
            });
        }

        function loadSellerRentals() {
            if (!currentUser) return;
            
            const container = document.getElementById('seller-rental-listings');
            if (!container) return;
            
            container.innerHTML = '';
            
            const sellerRentals = rentalFleet.filter(rental => rental.sellerId === currentUser.id);
            
            if (sellerRentals.length === 0) {
                container.innerHTML = '<p>You have no rental listings yet.</p>';
                return;
            }
            
            sellerRentals.forEach(rental => {
                const listing = document.createElement('div');
                listing.className = 'listing-item';
                listing.innerHTML = `
                    <div class="listing-info">
                        <h4>${rental.make} ${rental.model} ${rental.year} - ${rental.type}</h4>
                        <p>Daily Rate: KES ${rental.dailyRate.toLocaleString()}</p>
                        <p>Weekly Rate: KES ${rental.weeklyRate.toLocaleString()}</p>
                        <p>Status: ${rental.available ? 'Available' : 'Booked'}</p>
                    </div>
                    <div class="listing-actions">
                        <button class="btn btn-danger" onclick="deleteRental(${rental.id})">Delete</button>
                    </div>
                `;
                container.appendChild(listing);
            });
        }

        function loadSellerInquiries() {
            if (!currentUser) return;
            
            const container = document.getElementById('seller-inquiries-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Get inquiries for user's cars
            const userCarIds = cars.filter(car => car.sellerId === currentUser.id).map(car => car.id);
            const sellerInquiries = inquiries.filter(inquiry => userCarIds.includes(inquiry.carId));
            
            // Update stats
            document.getElementById('seller-inquiries').textContent = sellerInquiries.length;
            
            if (sellerInquiries.length === 0) {
                container.innerHTML = '<p>You have no inquiries yet.</p>';
                return;
            }
            
            sellerInquiries.forEach(inquiry => {
                const car = cars.find(c => c.id === inquiry.carId);
                const inquiryItem = document.createElement('div');
                inquiryItem.className = 'listing-item';
                inquiryItem.innerHTML = `
                    <div class="listing-info">
                        <h4>${car.make} ${car.model} ${car.year}</h4>
                        <p><strong>From:</strong> ${inquiry.name} (${inquiry.email}, ${inquiry.phone})</p>
                        <p><strong>Message:</strong> ${inquiry.message}</p>
                        <p><small>${new Date(inquiry.date).toLocaleDateString()}</small></p>
                    </div>
                    <div class="listing-actions">
                        <button class="btn" onclick="contactInquirer('${inquiry.email}', '${inquiry.phone}')">Contact</button>
                    </div>
                `;
                container.appendChild(inquiryItem);
            });
        }

        function loadSellerRatings() {
            if (!currentUser) return;
            
            const container = document.getElementById('seller-ratings-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            const sellerRatings = ratings.filter(rating => rating.toUserId === currentUser.id);
            
            // Update stats
            document.getElementById('seller-ratings').textContent = sellerRatings.length;
            
            if (sellerRatings.length === 0) {
                container.innerHTML = '<p>You have not received any ratings yet.</p>';
                return;
            }
            
            sellerRatings.forEach(rating => {
                const ratingItem = document.createElement('div');
                ratingItem.className = 'listing-item';
                ratingItem.innerHTML = `
                    <div class="listing-info">
                        <h4>Rating from ${rating.fromUserName}</h4>
                        <div class="rating-stars">
                            ${Array(5).fill().map((_, i) => 
                                `<span class="star ${i < rating.rating ? 'filled' : ''}"></span>`
                            ).join('')}
                            <span>(${rating.rating}.0)</span>
                        </div>
                        <p>${rating.comment}</p>
                        <p><small>${new Date(rating.date).toLocaleDateString()}</small></p>
                    </div>
                `;
                container.appendChild(ratingItem);
            });
        }

        function loadPendingListings() {
            const container = document.getElementById('pending-listings');
            if (!container) return;
            
            container.innerHTML = '';
            
            const pendingCars = cars.filter(car => car.status === 'pending');
            
            // Update stats
            document.getElementById('admin-pending').textContent = pendingCars.length;
            
            if (pendingCars.length === 0) {
                container.innerHTML = '<p>No pending car listings to review.</p>';
                return;
            }
            
            pendingCars.forEach(car => {
                const seller = users.find(u => u.id === car.sellerId);
                const listing = document.createElement('div');
                listing.className = 'listing-item';
                listing.innerHTML = `
                    <div class="listing-info">
                        <h4>${car.make} ${car.model} ${car.year} - ${formatPrice(car.price)}</h4>
                        <p><strong>Seller:</strong> ${seller ? (seller.companyName || `${seller.fname} ${seller.lname}`) : 'Unknown'}</p>
                        <p><strong>Contact:</strong> ${seller ? seller.email : 'N/A'}, ${seller ? seller.phone : 'N/A'}</p>
                        <p><strong>Condition:</strong> ${car.condition}</p>
                        <p><strong>VIN:</strong> ${car.vin}</p>
                        <p>${car.description}</p>
                        <div class="kyc-documents">
                            <div class="kyc-doc">
                                <h5>Logbook</h5>
                                <img src="${car.kycDocuments.logbook}" alt="Logbook">
                            </div>
                            <div class="kyc-doc">
                                <h5>ID Copy</h5>
                                <img src="${car.kycDocuments.id}" alt="ID Copy">
                            </div>
                            <div class="kyc-doc">
                                <h5>Insurance</h5>
                                <img src="${car.kycDocuments.insurance}" alt="Insurance">
                            </div>
                            <div class="kyc-doc">
                                <h5>Inspection</h5>
                                <img src="${car.kycDocuments.inspection}" alt="Inspection">
                            </div>
                        </div>
                    </div>
                    <div class="listing-actions">
                        <button class="btn" onclick="approveCar(${car.id})">Approve</button>
                        <button class="btn btn-danger" onclick="rejectCar(${car.id})">Reject</button>
                    </div>
                `;
                container.appendChild(listing);
            });
        }

        function loadVerifiedListings() {
            const container = document.getElementById('verified-listings');
            if (!container) return;
            
            container.innerHTML = '';
            
            const verifiedCars = cars.filter(car => car.status === 'approved');
            
            // Update stats
            document.getElementById('admin-listings').textContent = verifiedCars.length;
            
            if (verifiedCars.length === 0) {
                container.innerHTML = '<p>No verified listings.</p>';
                return;
            }
            
            verifiedCars.forEach(car => {
                const seller = users.find(u => u.id === car.sellerId);
                const listing = document.createElement('div');
                listing.className = 'listing-item';
                listing.innerHTML = `
                    <div class="listing-info">
                        <h4>${car.make} ${car.model} ${car.year} - ${formatPrice(car.price)}</h4>
                        <p><strong>Seller:</strong> ${seller ? (seller.companyName || `${seller.fname} ${seller.lname}`) : 'Admin'}</p>
                        <p><strong>Status:</strong> Verified</p>
                        <p><strong>Condition:</strong> ${car.condition}</p>
                    </div>
                    <div class="listing-actions">
                        <button class="btn btn-danger" onclick="removeCar(${car.id})">Remove</button>
                    </div>
                `;
                container.appendChild(listing);
            });
        }

        // ENHANCED RENTAL MANAGEMENT FUNCTION
        function loadRentalManagement() {
            const verifiedContainer = document.getElementById('verified-rentals');
            const pendingContainer = document.getElementById('pending-rentals-list');
            
            if (verifiedContainer) verifiedContainer.innerHTML = '';
            if (pendingContainer) pendingContainer.innerHTML = '';
            
            const verifiedRentals = rentalFleet.filter(rental => rental.status === 'approved');
            const pendingRentals = rentalFleet.filter(rental => rental.status === 'pending');
            
            // Update stats
            document.getElementById('admin-rentals').textContent = rentalFleet.length;
            
            // Load verified rentals
            if (verifiedRentals.length === 0) {
                verifiedContainer.innerHTML = '<p>No verified rental listings.</p>';
            } else {
                verifiedRentals.forEach(rental => {
                    const seller = users.find(u => u.id === rental.sellerId);
                    const rentalItem = document.createElement('div');
                    rentalItem.className = 'listing-item';
                    rentalItem.innerHTML = `
                        <div class="listing-info">
                            <h4>${rental.make} ${rental.model} ${rental.year} - ${rental.type}</h4>
                            <p><strong>Owner:</strong> ${seller ? (seller.companyName || `${seller.fname} ${seller.lname}`) : 'Admin'}</p>
                            <p><strong>Daily Rate:</strong> KES ${rental.dailyRate.toLocaleString()}</p>
                            <p><strong>Weekly Rate:</strong> KES ${rental.weeklyRate.toLocaleString()}</p>
                            <p><strong>Status:</strong> ${rental.available ? 'Available' : 'Booked'}</p>
                            <p><strong>Features:</strong> ${rental.features.join(', ')}</p>
                        </div>
                        <div class="listing-actions">
                            <button class="btn btn-danger" onclick="deleteRental(${rental.id})">Delete</button>
                        </div>
                    `;
                    verifiedContainer.appendChild(rentalItem);
                });
            }
            
            // Load pending rentals
            if (pendingRentals.length === 0) {
                pendingContainer.innerHTML = '<p>No pending rental listings to review.</p>';
            } else {
                pendingRentals.forEach(rental => {
                    const seller = users.find(u => u.id === rental.sellerId);
                    const rentalItem = document.createElement('div');
                    rentalItem.className = 'listing-item';
                    rentalItem.innerHTML = `
                        <div class="listing-info">
                            <h4>${rental.make} ${rental.model} ${rental.year} - ${rental.type}</h4>
                            <p><strong>Owner:</strong> ${seller ? (seller.companyName || `${seller.fname} ${seller.lname}`) : 'Admin'}</p>
                            <p><strong>Daily Rate:</strong> KES ${rental.dailyRate.toLocaleString()}</p>
                            <p><strong>Weekly Rate:</strong> KES ${rental.weeklyRate.toLocaleString()}</p>
                            <p><strong>Features:</strong> ${rental.features.join(', ')}</p>
                        </div>
                        <div class="listing-actions">
                            <button class="btn" onclick="approveRental(${rental.id})">Approve</button>
                            <button class="btn btn-danger" onclick="deleteRental(${rental.id})">Reject</button>
                        </div>
                    `;
                    pendingContainer.appendChild(rentalItem);
                });
            }
        }

        function loadAdminCommunications() {
            const inquiriesContainer = document.getElementById('admin-inquiries-list');
            const bookingsContainer = document.getElementById('admin-bookings-list');
            if (inquiriesContainer) inquiriesContainer.innerHTML = '';
            if (bookingsContainer) bookingsContainer.innerHTML = '';
            
            if (inquiriesContainer) {
                if (inquiries.length === 0) {
                    inquiriesContainer.innerHTML = '<p>No client inquiries yet.</p>';
                } else {
                    inquiries.forEach(inquiry => {
                        const item = document.createElement('div');
                        item.className = 'listing-item';
                        item.innerHTML = `
                            <div class="listing-info">
                                <h4>${inquiry.carName}</h4>
                                <p><strong>From:</strong> ${inquiry.name} (${inquiry.email}, ${inquiry.phone})</p>
                                <p><strong>Message:</strong> ${inquiry.message}</p>
                                <p><small>${new Date(inquiry.date).toLocaleDateString()}</small></p>
                            </div>
                            <div class="listing-actions">
                                <button class="btn" onclick="sendContactEmail('${inquiry.name}','${inquiry.email}','Re: ${inquiry.carName}','Thank you. Our team will contact you.')">Reply</button>
                            </div>
                        `;
                        inquiriesContainer.appendChild(item);
                    });
                }
            }
            
            if (bookingsContainer) {
                const pendingBookings = rentals;
                if (pendingBookings.length === 0) {
                    bookingsContainer.innerHTML = '<p>No rental bookings yet.</p>';
                } else {
                    pendingBookings.forEach(rental => {
                        const item = document.createElement('div');
                        item.className = 'listing-item';
                        item.innerHTML = `
                            <div class="listing-info">
                                <h4>Booking #${rental.id}</h4>
                                <p><strong>Client:</strong> ${rental.userName}</p>
                                <p><strong>Dates:</strong> ${rental.startDate} to ${rental.endDate}</p>
                                <p><strong>Location:</strong> ${rental.location}</p>
                                <p><strong>Insurance:</strong> ${rental.insurance}</p>
                                <p><strong>Status:</strong> ${rental.status.toUpperCase()}</p>
                            </div>
                            <div class="listing-actions">
                                <button class="btn" onclick="approveAdminBooking(${rental.id})">Mark Approved</button>
                                <button class="btn btn-danger" onclick="rejectAdminBooking(${rental.id})">Reject</button>
                            </div>
                        `;
                        bookingsContainer.appendChild(item);
                    });
                }
            }
        }

        function approveAdminBooking(bookingId) {
            const idx = rentals.findIndex(r => r.id === bookingId);
            if (idx !== -1) {
                rentals[idx].status = 'approved';
                localStorage.setItem('encrypted_rentals', JSON.stringify(rentals));
                loadAdminCommunications();
                showNotification('Booking approved.', 'success');
            }
        }

        function rejectAdminBooking(bookingId) {
            const idx = rentals.findIndex(r => r.id === bookingId);
            if (idx !== -1) {
                rentals.splice(idx, 1);
                localStorage.setItem('encrypted_rentals', JSON.stringify(rentals));
                loadAdminCommunications();
                showNotification('Booking rejected and removed.', 'success');
            }
        }

        function loadUserManagement() {
            const container = document.getElementById('user-management');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Update stats
            document.getElementById('admin-users').textContent = users.length;
            
            if (users.length === 0) {
                container.innerHTML = '<p>No users to manage.</p>';
                return;
            }
            
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'listing-item';
                userItem.innerHTML = `
                    <div class="listing-info">
                        <h4>${user.role === 'seller' ? (user.companyName || 'Seller') : `${user.fname} ${user.lname}`}</h4>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Phone:</strong> ${user.phone}</p>
                        <p><strong>Role:</strong> ${user.role}</p>
                        <p><strong>Joined:</strong> ${new Date(user.createdAt).toLocaleDateString()}</p>
                    </div>
                    <div class="listing-actions">
                        <button class="btn btn-outline" onclick="viewUserDetails(${user.id})">Details</button>
                        <button class="btn btn-danger" onclick="deleteUser(${user.id})">Delete</button>
                    </div>
                `;
                container.appendChild(userItem);
            });
        }

        function loadTestimonialApprovals() {
            const container = document.getElementById('testimonial-approvals');
            if (!container) return;
            
            container.innerHTML = '';
            
            const pendingTestimonials = testimonials.filter(testimonial => !testimonial.approved);
            
            if (pendingTestimonials.length === 0) {
                container.innerHTML = '<p>No pending testimonials to review.</p>';
                return;
            }
            
            pendingTestimonials.forEach(testimonial => {
                const testimonialItem = document.createElement('div');
                testimonialItem.className = 'listing-item';
                testimonialItem.innerHTML = `
                    <div class="listing-info">
                        <h4>${testimonial.title}</h4>
                        <p><strong>By:</strong> ${testimonial.userName}</p>
                        <p>${testimonial.content}</p>
                        <p><small>${new Date(testimonial.date).toLocaleDateString()}</small></p>
                    </div>
                    <div class="listing-actions">
                        <button class="btn" onclick="approveTestimonial(${testimonial.id})">Approve</button>
                        <button class="btn btn-danger" onclick="rejectTestimonial(${testimonial.id})">Reject</button>
                    </div>
                `;
                container.appendChild(testimonialItem);
            });
        }

        function updateAdminStats() {
            // Calculate real statistics
            const totalListings = cars.filter(car => car.status === 'approved').length;
            const pendingApprovals = cars.filter(car => car.status === 'pending').length + 
                                    rentalFleet.filter(rental => rental.status === 'pending').length +
                                    testimonials.filter(testimonial => !testimonial.approved).length;
            const totalUsers = users.length;
            const activeRentals = rentalFleet.length;
            
            // Update stats
            document.getElementById('admin-listings').textContent = totalListings;
            document.getElementById('admin-pending').textContent = pendingApprovals;
            document.getElementById('admin-users').textContent = totalUsers;
            document.getElementById('admin-rentals').textContent = activeRentals;
            
            // Update report stats
            document.getElementById('report-listings').textContent = totalListings;
            document.getElementById('report-verified').textContent = cars.filter(car => car.verified).length;
            document.getElementById('report-rentals').textContent = activeRentals;
            document.getElementById('report-pending').textContent = pendingApprovals;
            
            // Calculate platform performance metrics
            const monthlyGrowth = Math.round((totalListings / 100) * 15); // Simulated growth
            const userEngagement = Math.round((users.filter(u => u.lastLogin && new Date(u.lastLogin) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)).length / users.length) * 100);
            const approvalRate = Math.round(((totalListings) / (totalListings + pendingApprovals)) * 100);
            
            // Update performance metrics
            document.getElementById('growth-rate').textContent = `+${monthlyGrowth}%`;
            document.getElementById('engagement-rate').textContent = `${userEngagement}%`;
            document.getElementById('approval-rate').textContent = `${approvalRate}%`;
            document.getElementById('satisfaction-rate').textContent = '4.8/5';
            try { renderAdminCharts(); } catch (e) {}
        }

        // ENHANCED RENTAL APPROVAL SYSTEM
        function approveRental(rentalId) {
            const rentalIndex = rentalFleet.findIndex(r => r.id === rentalId);
            if (rentalIndex !== -1) {
                rentalFleet[rentalIndex].status = 'approved';
                localStorage.setItem('encrypted_rentalFleet', JSON.stringify(rentalFleet));
                loadRentalManagement();
                showNotification('Rental listing approved successfully!', 'success');
            }
        }

        // =============================================
        // INNOVATIVE FEATURES IMPLEMENTATION
        // =============================================

        // AI-Powered Recommendation Engine
        function loadAIRecommendations() {
            const container = document.getElementById('recommendation-grid');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Get user preferences or use default
            const preferences = userPreferences;
            
            // Filter cars based on user preferences
            let recommendedCars = cars.filter(car => {
                // Brand preference
                if (preferences.preferredBrands.length > 0 && 
                    !preferences.preferredBrands.includes(car.make.toLowerCase())) {
                    return false;
                }
                
                // Price range
                if (car.price < preferences.priceRange.min || car.price > preferences.priceRange.max) {
                    return false;
                }
                
                // Vehicle type (simplified)
                if (preferences.vehicleType !== 'all') {
                    // This is a simplified implementation - in a real app, you'd have more sophisticated categorization
                    const carType = getCarType(car);
                    if (preferences.vehicleType !== carType) {
                        return false;
                    }
                }
                
                return true;
            });
            
            // If no preferences set or no matches, show popular cars
            if (recommendedCars.length === 0) {
                recommendedCars = cars.filter(car => car.verified).slice(0, 4);
            }
            
            // Limit to 4 recommendations
            recommendedCars = recommendedCars.slice(0, 4);
            
            if (recommendedCars.length === 0) {
                container.innerHTML = '<p>No recommendations available at the moment.</p>';
                return;
            }
            
            recommendedCars.forEach(car => {
                const matchScore = calculateMatchScore(car, preferences);
                
                const card = document.createElement('div');
                card.className = 'recommendation-card';
                card.innerHTML = `
                    <div class="recommendation-badge">RECOMMENDED</div>
                    <div class="recommendation-match">${matchScore}% Match</div>
                    <img src="${car.images[0]}" alt="${car.make} ${car.model}" class="car-image">
                    <div class="car-details">
                        <div class="car-price">${formatPrice(car.price)}</div>
                        <h3 class="car-title">${car.make} ${car.model} ${car.year}</h3>
                        <div class="car-specs">
                            <span><i class="fas fa-tachometer-alt"></i> ${car.mileage.toLocaleString()} km</span>
                            <span><i class="fas fa-gas-pump"></i> ${car.fuel}</span>
                        </div>
                        <div class="verified-badge"><i class="fas fa-shield-alt"></i> AGAS Verified</div>
                        <p>${car.description.substring(0, 80)}...</p>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button class="btn btn-outline" style="flex: 1;" onclick="showQuickViewModal(${car.id})">Quick View</button>
                            <button class="btn" style="flex: 1;" onclick="showInquiryModal(${car.id})">Inquire</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Helper function to calculate match score
        function calculateMatchScore(car, preferences) {
            let score = 50; // Base score
            
            // Brand match
            if (preferences.preferredBrands.includes(car.make.toLowerCase())) {
                score += 20;
            }
            
            // Price match (closer to user's preferred range gets higher score)
            const priceMidpoint = (preferences.priceRange.min + preferences.priceRange.max) / 2;
            const priceDifference = Math.abs(car.price - priceMidpoint);
            const priceRange = preferences.priceRange.max - preferences.priceRange.min;
            
            if (priceDifference < priceRange * 0.1) {
                score += 20;
            } else if (priceDifference < priceRange * 0.3) {
                score += 10;
            }
            
            // Feature match (simplified)
            if (preferences.features.length > 0) {
                const matchingFeatures = car.features.filter(f => 
                    preferences.features.some(pf => f.toLowerCase().includes(pf.toLowerCase()))
                );
                score += (matchingFeatures.length / preferences.features.length) * 10;
            }
            
            return Math.min(score, 95); // Cap at 95% to leave room for "perfect" matches
        }

        // Helper function to determine car type
        function getCarType(car) {
            const model = car.model.toLowerCase();
            if (model.includes('suv') || model.includes('x5') || model.includes('gle') || model.includes('xc90')) {
                return 'suv';
            } else if (model.includes('sedan') || model.includes('s-class') || model.includes('7 series')) {
                return 'sedan';
            } else if (model.includes('coupe') || model.includes('convertible')) {
                return 'sports';
            } else {
                return 'other';
            }
        }

        // Advanced Filter Toggle
        function toggleAdvancedFilters() {
            const filters = document.getElementById('advanced-filters');
            const arrow = document.getElementById('filter-arrow');
            
            filters.classList.toggle('active');
            
            if (filters.classList.contains('active')) {
                arrow.className = 'fas fa-chevron-up';
            } else {
                arrow.className = 'fas fa-chevron-down';
            }
        }

        // Enhanced Search Functionality
        function handleSearch() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            if (searchTerm.length < 2) {
                loadCarListings();
                return;
            }
            
            // Filter cars based on search term
            const filteredCars = cars.filter(car => {
                return (
                    car.make.toLowerCase().includes(searchTerm) ||
                    car.model.toLowerCase().includes(searchTerm) ||
                    car.description.toLowerCase().includes(searchTerm) ||
                    car.features.some(feature => feature.toLowerCase().includes(searchTerm))
                );
            });
            
            // Update the car listings
            const featuredContainer = document.getElementById('car-listings');
            if (featuredContainer) {
                featuredContainer.innerHTML = '';
                filteredCars.slice(0, 4).forEach(car => {
                    featuredContainer.appendChild(createCarCard(car));
                });
                
                if (filteredCars.length === 0) {
                    featuredContainer.innerHTML = '<p>No cars found matching your search.</p>';
                }
            }
        }

        // Dark Mode Implementation
        function initializeDarkMode() {
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.querySelectorAll('.dark-mode-toggle i').forEach(icon => {
                    icon.className = 'fas fa-sun';
                });
            }
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            
            // Update toggle button icons
            document.querySelectorAll('.dark-mode-toggle i').forEach(icon => {
                icon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            });
            
            // Save preference
            localStorage.setItem('agas_dark_mode', isDarkMode);
            
            showNotification(`Dark mode ${isDarkMode ? 'enabled' : 'disabled'}`, 'info');
        }

        // Notification Center Implementation
        function initializeNotificationCenter() {
            updateNotificationBadges();
            loadNotifications();
        }

        function toggleNotificationCenter() {
            const notificationCenter = document.getElementById('notification-center');
            notificationCenter.classList.toggle('active');
            
            if (notificationCenter.classList.contains('active')) {
                markNotificationsAsRead();
            }
        }

        function loadNotifications() {
            const container = document.getElementById('notification-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Sort notifications by timestamp (newest first)
            const sortedNotifications = [...notifications].sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            if (sortedNotifications.length === 0) {
                container.innerHTML = '<p>No notifications</p>';
                return;
            }
            
            sortedNotifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = `notification-item ${notification.read ? '' : 'unread'}`;
                notificationItem.innerHTML = `
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-message">${notification.message}</div>
                    <div class="notification-time">${formatTimeAgo(new Date(notification.timestamp))}</div>
                `;
                container.appendChild(notificationItem);
            });
        }

        function updateNotificationBadges() {
            const unreadCount = notifications.filter(n => !n.read).length;
            
            document.querySelectorAll('#notification-count, #notification-count-user').forEach(badge => {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'flex' : 'none';
            });
        }

        function markNotificationsAsRead() {
            notifications.forEach(notification => {
                notification.read = true;
            });
            
            localStorage.setItem('agas_notifications', JSON.stringify(notifications));
            updateNotificationBadges();
        }

        function markAllNotificationsAsRead() {
            markNotificationsAsRead();
            loadNotifications();
            showNotification('All notifications marked as read', 'success');
        }

        function addNotification(title, message, type = 'info') {
            const newNotification = {
                id: notifications.length + 1,
                title,
                message,
                timestamp: new Date().toISOString(),
                read: false,
                type
            };
            
            notifications.unshift(newNotification);
            localStorage.setItem('agas_notifications', JSON.stringify(notifications));
            
            updateNotificationBadges();
            
            // If notification center is open, reload it
            if (document.getElementById('notification-center').classList.contains('active')) {
                loadNotifications();
            }
        }

        function viewAllNotifications() {
            // In a real app, this would navigate to a dedicated notifications page
            showNotification('Viewing all notifications', 'info');
            toggleNotificationCenter();
        }

        // Helper function to format time ago
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffHours < 24) return `${diffHours} hr ago`;
            if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            
            return date.toLocaleDateString();
        }

        // AI Chat Implementation
        function initializeAIChat() {
            loadAIChatMessages();
        }

        function toggleAIChat() {
            const chatContainer = document.getElementById('ai-chat-container');
            chatContainer.classList.toggle('active');
        }

        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('encrypted_currentUser');
            clearTimeout(sessionTimer);
            const timerDisplay = document.getElementById('session-timer');
            if (timerDisplay) timerDisplay.style.display = 'none';
            updateUserInterface();
            showSection('home');
            showNotification('You have been logged out successfully.', 'info');
        }

        // Additional utility functions for admin panel
        function approveCar(carId) {
            const carIndex = cars.findIndex(c => c.id === carId);
            if (carIndex !== -1) {
                cars[carIndex].status = 'approved';
                cars[carIndex].verified = true;
                localStorage.setItem('encrypted_cars', JSON.stringify(cars));
                loadPendingListings();
                loadVerifiedListings();
                showNotification('Car listing approved successfully!', 'success');
            }
        }

        function rejectCar(carId) {
            const carIndex = cars.findIndex(c => c.id === carId);
            if (carIndex !== -1) {
                cars.splice(carIndex, 1);
                localStorage.setItem('encrypted_cars', JSON.stringify(cars));
                loadPendingListings();
                showNotification('Car listing rejected and removed.', 'success');
            }
        }

        function removeCar(carId) {
            const carIndex = cars.findIndex(c => c.id === carId);
            if (carIndex !== -1) {
                cars.splice(carIndex, 1);
                localStorage.setItem('encrypted_cars', JSON.stringify(cars));
                loadVerifiedListings();
                showNotification('Car listing removed successfully.', 'success');
            }
        }

        function deleteRental(rentalId) {
            const rentalIndex = rentalFleet.findIndex(r => r.id === rentalId);
            if (rentalIndex !== -1) {
                rentalFleet.splice(rentalIndex, 1);
                localStorage.setItem('encrypted_rentalFleet', JSON.stringify(rentalFleet));
                loadRentalManagement();
                showNotification('Rental listing deleted successfully.', 'success');
            }
        }

        function deleteCar(carId) {
            const carIndex = cars.findIndex(c => c.id === carId);
            if (carIndex !== -1) {
                cars.splice(carIndex, 1);
                localStorage.setItem('encrypted_cars', JSON.stringify(cars));
                loadSellerListings();
                showNotification('Car listing deleted successfully.', 'success');
            }
        }

        function approveTestimonial(testimonialId) {
            const testimonialIndex = testimonials.findIndex(t => t.id === testimonialId);
            if (testimonialIndex !== -1) {
                testimonials[testimonialIndex].approved = true;
                localStorage.setItem('encrypted_testimonials', JSON.stringify(testimonials));
                loadTestimonialApprovals();
                showNotification('Testimonial approved and published.', 'success');
            }
        }

        function rejectTestimonial(testimonialId) {
            const testimonialIndex = testimonials.findIndex(t => t.id === testimonialId);
            if (testimonialIndex !== -1) {
                testimonials.splice(testimonialIndex, 1);
                localStorage.setItem('encrypted_testimonials', JSON.stringify(testimonials));
                loadTestimonialApprovals();
                showNotification('Testimonial rejected and removed.', 'success');
            }
        }

        function viewUserDetails(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                alert(`User Details:\nName: ${user.fname} ${user.lname}\nEmail: ${user.email}\nPhone: ${user.phone}\nRole: ${user.role}\nJoined: ${new Date(user.createdAt).toLocaleDateString()}`);
            }
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                const userIndex = users.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    users.splice(userIndex, 1);
                    localStorage.setItem('encrypted_users', JSON.stringify(users));
                    loadUserManagement();
                    showNotification('User deleted successfully.', 'success');
                }
            }
        }

        function contactInquirer(email, phone) {
            alert(`Contact Information:\nEmail: ${email}\nPhone: ${phone}`);
        }

        function switchBuyerTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('#buyer-dashboard .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('#buyer-dashboard .dashboard-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function switchSellerTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('#seller-dashboard .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('#seller-dashboard .dashboard-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function switchAdminTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('#admin-section .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('#admin-section .dashboard-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            if (tabName === 'communications') {
                loadAdminCommunications();
            }
            if (tabName === 'reports') {
                try { renderAdminCharts(); } catch (e) {}
            }
        }

        function generateReports() {
            try {
                const carsData = cars.map(c => ({
                    ID: c.id,
                    Make: c.make,
                    Model: c.model,
                    Year: c.year,
                    Price: typeof formatPrice === 'function' ? formatPrice(c.price) : c.price,
                    Mileage: c.mileage || '',
                    Location: c.location || '',
                    Status: c.status || ''
                }));

                const usersData = (Array.isArray(users) ? users : []).map(u => ({
                    ID: u.id || '',
                    Name: ((u.fname || '') + ' ' + (u.lname || '')).trim() || (u.companyName || ''),
                    Email: u.email || '',
                    Role: u.role || '',
                    Joined: u.createdAt ? new Date(u.createdAt).toLocaleDateString() : ''
                }));

                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(carsData), 'Cars');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(usersData), 'Users');
                XLSX.writeFile(wb, 'agas_reports.xlsx');

                let listingsCanvas = document.getElementById('chart-listings');
                let engagementCanvas = document.getElementById('chart-engagement');
                let distributionCanvas = document.getElementById('chart-distribution');
                let legendEl = document.getElementById('chart-legend');
                let tooltipEl = document.getElementById('chart-tooltip');
                let holder = null;
                if (!listingsCanvas || !engagementCanvas || !distributionCanvas) {
                    holder = document.createElement('div');
                    holder.style.position = 'fixed';
                    holder.style.left = '-9999px';
                    holder.style.top = '-9999px';
                    document.body.appendChild(holder);
                    if (!listingsCanvas) { listingsCanvas = document.createElement('canvas'); listingsCanvas.id = 'chart-listings'; listingsCanvas.width = 640; listingsCanvas.height = 280; holder.appendChild(listingsCanvas); }
                    if (!engagementCanvas) { engagementCanvas = document.createElement('canvas'); engagementCanvas.id = 'chart-engagement'; engagementCanvas.width = 640; engagementCanvas.height = 280; holder.appendChild(engagementCanvas); }
                    if (!distributionCanvas) { distributionCanvas = document.createElement('canvas'); distributionCanvas.id = 'chart-distribution'; distributionCanvas.width = 640; distributionCanvas.height = 320; holder.appendChild(distributionCanvas); }
                    if (!legendEl) { legendEl = document.createElement('div'); legendEl.id = 'chart-legend'; holder.appendChild(legendEl); }
                    if (!tooltipEl) { tooltipEl = document.createElement('div'); tooltipEl.id = 'chart-tooltip'; holder.appendChild(tooltipEl); }
                }
                try { renderAdminCharts(); } catch (e) {}
                const listingsImg = listingsCanvas ? listingsCanvas.toDataURL('image/png') : '';
                const engagementImg = engagementCanvas ? engagementCanvas.toDataURL('image/png') : '';
                const distributionImg = distributionCanvas ? distributionCanvas.toDataURL('image/png') : '';
                if (holder) { document.body.removeChild(holder); }

                const carsRows = cars.map(c => `
                    <tr>
                        <td>${c.id || ''}</td>
                        <td>${c.make || ''}</td>
                        <td>${c.model || ''}</td>
                        <td>${c.year || ''}</td>
                        <td>${typeof formatPrice === 'function' ? formatPrice(c.price) : (c.price || '')}</td>
                        <td>${c.mileage || ''}</td>
                        <td>${c.location || ''}</td>
                        <td>${c.status || ''}</td>
                    </tr>
                `).join('');

                const usersRows = (Array.isArray(users) ? users : []).map(u => `
                    <tr>
                        <td>${u.id || ''}</td>
                        <td>${(((u.fname || '') + ' ' + (u.lname || '')).trim()) || (u.companyName || '')}</td>
                        <td>${u.email || ''}</td>
                        <td>${u.role || ''}</td>
                        <td>${u.createdAt ? new Date(u.createdAt).toLocaleDateString() : ''}</td>
                    </tr>
                `).join('');

                let chartsHtml = '';
                if (listingsImg) chartsHtml += `<h3 style="margin-top:20px">Listings Overview</h3><img src="${listingsImg}" alt="Listings Overview" style="max-width:700px;border-radius:10px">`;
                if (engagementImg) chartsHtml += `<h3 style="margin-top:20px">Engagement Trend</h3><img src="${engagementImg}" alt="Engagement Trend" style="max-width:700px;border-radius:10px">`;
                if (distributionImg) chartsHtml += `<h3 style="margin-top:20px">Distribution</h3><img src="${distributionImg}" alt="Distribution" style="max-width:700px;border-radius:10px">`;

                const reportDate = new Date().toLocaleString();
                const companyLogoUrl = localStorage.getItem('companyLogoUrl') || '';
                const coverImage = 'https://uploads.audi-mediacenter.com/system/production/media/125899/images/ed977bc29fd369ea4a5c2b6998ab027d9972703b/A243788_web_960.jpg?1730706355';
                const htmlDoc = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>AGAS Executive Report</title></head><body style="font-family:Segoe UI, Arial, sans-serif; color:#222;">
                    <div style="padding:20px;background:linear-gradient(135deg,#1b1b1b,#2a7ade);color:#fff;border-bottom:4px solid #FFC107;display:flex;align-items:center;gap:16px;">
                        ${companyLogoUrl ? `<img src="${companyLogoUrl}" alt="AGAS Logo" style="height:60px;border-radius:8px;box-shadow:0 6px 16px rgba(0,0,0,0.2)">` : ''}
                        <div>
                            <h1 style="margin:0;font-size:34px;letter-spacing:0.5px">AGAS LUXE DRIVE</h1>
                            <p style="margin:6px 0 0;font-size:16px;">Executive Report</p>
                            <p style="margin:4px 0 0;font-size:12px;opacity:0.9">Generated: ${reportDate}</p>
                        </div>
                    </div>
                    <div style="text-align:center;padding:24px">
                        <img src="${coverImage}" alt="Cover" style="max-width:760px;border-radius:14px;box-shadow:0 12px 30px rgba(0,0,0,0.2)">
                    </div>
                    <div style="padding:0 24px">
                        <h2>Cars</h2>
                        <table border="1" cellspacing="0" cellpadding="5" style="border-collapse:collapse;">
                            <tr><th>ID</th><th>Make</th><th>Model</th><th>Year</th><th>Price</th><th>Mileage</th><th>Location</th><th>Status</th></tr>
                            ${carsRows}
                        </table>
                        <h2 style="margin-top:24px">Users</h2>
                        <table border="1" cellspacing="0" cellpadding="5" style="border-collapse:collapse;">
                            <tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Joined</th></tr>
                            ${usersRows}
                        </table>
                        <h2 style="margin-top:24px">Charts</h2>
                        ${chartsHtml}
                    </div>
                </body></html>`;

                const blob = new Blob([htmlDoc], { type: 'application/msword' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'agas_reports.doc';
                document.body.appendChild(a);
                a.click();
                URL.revokeObjectURL(a.href);
                document.body.removeChild(a);

                showNotification('Reports generated: Excel and Word downloaded.', 'success');
            } catch (err) {
                console.error('Failed to generate reports', err);
                showNotification('Failed to generate reports. Please check console for details.', 'error');
            }
        }

        function sendBulkNotifications() {
            const subject = prompt('Enter notification subject:');
            if (!subject) return;
            
            const message = prompt('Enter notification message:');
            if (!message) return;
            
            if (confirm(`Send this notification to all ${users.length} users?`)) {
                sendBulkNotificationsToUsers(subject, message);
            }
        }
    </script>
</body>
</html>
    
